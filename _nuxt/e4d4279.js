/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{276:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return wu})),n.d(e,"b",(function(){return mc})),n.d(e,"c",(function(){return tc})),n.d(e,"d",(function(){return Ka})),n.d(e,"e",(function(){return Hc})),n.d(e,"f",(function(){return gc})),n.d(e,"g",(function(){return C})),n.d(e,"h",(function(){return yc})),n.d(e,"i",(function(){return Wc})),n.d(e,"j",(function(){return Yc})),n.d(e,"k",(function(){return G})),n.d(e,"l",(function(){return Tu})),n.d(e,"m",(function(){return xa})),n.d(e,"n",(function(){return gt})),n.d(e,"o",(function(){return J})),n.d(e,"p",(function(){return Va})),n.d(e,"q",(function(){return q})),n.d(e,"r",(function(){return tt})),n.d(e,"s",(function(){return E})),n.d(e,"t",(function(){return La})),n.d(e,"u",(function(){return Ou})),n.d(e,"v",(function(){return Ku})),n.d(e,"w",(function(){return Bu})),n.d(e,"x",(function(){return ac})),n.d(e,"y",(function(){return za})),n.d(e,"z",(function(){return Qa})),n.d(e,"A",(function(){return Ba})),n.d(e,"B",(function(){return Ru})),n.d(e,"C",(function(){return ju})),n.d(e,"D",(function(){return hc})),n.d(e,"E",(function(){return Ha})),n.d(e,"F",(function(){return sc})),n.d(e,"G",(function(){return ic})),n.d(e,"H",(function(){return uc})),n.d(e,"I",(function(){return fu})),n.d(e,"J",(function(){return th})),n.d(e,"K",(function(){return nc})),n.d(e,"L",(function(){return Pu})),n.d(e,"M",(function(){return Eu})),n.d(e,"N",(function(){return Su})),n.d(e,"O",(function(){return Au})),n.d(e,"P",(function(){return Du})),n.d(e,"Q",(function(){return ku})),n.d(e,"R",(function(){return Cu})),n.d(e,"S",(function(){return $u})),n.d(e,"T",(function(){return au})),n.d(e,"U",(function(){return cu})),n.d(e,"V",(function(){return lc})),n.d(e,"W",(function(){return dc})),n.d(e,"X",(function(){return Lu})),n.d(e,"Y",(function(){return Mu})),n.d(e,"Z",(function(){return iu})),n.d(e,"ab",(function(){return eu})),n.d(e,"bb",(function(){return Ya})),n.d(e,"cb",(function(){return Wa})),n.d(e,"db",(function(){return qu})),n.d(e,"eb",(function(){return Uu})),n.d(e,"fb",(function(){return Nu})),n.d(e,"gb",(function(){return v})),n.d(e,"hb",(function(){return Jc})),n.d(e,"ib",(function(){return lu})),n.d(e,"jb",(function(){return hu})),n.d(e,"kb",(function(){return xu})),n.d(e,"lb",(function(){return cc})),n.d(e,"mb",(function(){return ru}));var r=n(270),o=n(269),c=n(271),h=n(267),l=n(277);const d="@firebase/firestore";class f{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}f.UNAUTHENTICATED=new f(null),f.GOOGLE_CREDENTIALS=new f("google-credentials-uid"),f.FIRST_PARTY=new f("first-party-uid"),f.MOCK_USER=new f("mock-user");let m="9.6.3";const y=new c.b("@firebase/firestore");function w(){return y.logLevel}function v(t){y.setLogLevel(t)}function T(t,...e){if(y.logLevel<=c.a.DEBUG){const n=e.map(_);y.debug(`Firestore (${m}): ${t}`,...n)}}function I(t,...e){if(y.logLevel<=c.a.ERROR){const n=e.map(_);y.error(`Firestore (${m}): ${t}`,...n)}}function E(t,...e){if(y.logLevel<=c.a.WARN){const n=e.map(_);y.warn(`Firestore (${m}): ${t}`,...n)}}function _(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function S(t="Unexpected state"){const e=`FIRESTORE (${m}) INTERNAL ASSERTION FAILED: `+t;throw I(e),new Error(e)}function A(t,e){t||S()}function q(t,e){t||S()}function D(t,e){return t}const k={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends h.c{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class N{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class x{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class R{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(f.UNAUTHENTICATED)))}shutdown(){}}class O{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class L{constructor(t){this.t=t,this.currentUser=f.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new N;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new N,t.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{T("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(T("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new N)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(T("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(A("string"==typeof e.accessToken),new x(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return A(null===t||"string"==typeof t),new f(t)}}class M{constructor(t,e,n){this.type="FirstParty",this.user=f.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);const s=t.auth.getAuthHeaderValueForFirstParty([]);s&&this.headers.set("Authorization",s),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class P{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new M(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(f.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class F{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class V{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null}start(t,e){this.o=n=>{t.enqueueRetryable((()=>(t=>(null!=t.error&&T("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`),e(t.token)))(n)))};const n=t=>{T("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.g.onInit((t=>n(t))),setTimeout((()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?n(t):T("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(A("string"==typeof t.token),new F(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class j{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.p(t),this.T=t=>e.writeSequenceNumber(t))}p(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.T&&this.T(t),t}}function U(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}j.I=-1;class B{static A(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=U(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function rt(t,e){return t<e?-1:t>e?1:0}function K(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}function $(t){return t+"\0"}class G{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new C(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new C(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new C(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new C(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return G.fromMillis(Date.now())}static fromDate(t){return G.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new G(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?rt(this.nanoseconds,t.nanoseconds):rt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class z{constructor(t){this.timestamp=t}static fromTimestamp(t){return new z(t)}static min(){return new z(new G(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Q(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function H(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function W(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class dt{constructor(t,e,n){void 0===e?e=0:e>t.length&&S(),void 0===n?n=t.length-e:n>t.length-e&&S(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===dt.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof dt?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Y extends dt{construct(t,e,n){return new Y(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new C(k.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Y(e)}static emptyPath(){return new Y([])}}const X=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class J extends dt{construct(t,e,n){return new J(t,e,n)}static isValidIdentifier(t){return X.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),J.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new J(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new C(k.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new C(k.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new C(k.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new C(k.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new J(e)}static emptyPath(){return new J([])}}class Z{constructor(t){this.fields=t,t.sort(J.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return K(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}function tt(){return"undefined"!=typeof atob}class et{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new et(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new et(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return rt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}et.EMPTY_BYTE_STRING=new et("");const nt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function st(t){if(A(!!t),"string"==typeof t){let e=0;const n=nt.exec(t);if(A(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:it(t.seconds),nanos:it(t.nanos)}}function it(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ot(t){return"string"==typeof t?et.fromBase64String(t):et.fromUint8Array(t)}function at(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ct(t){const e=t.mapValue.fields.__previous_value__;return at(e)?ct(e):e}function ut(t){const e=st(t.mapValue.fields.__local_write_time__.timestampValue);return new G(e.seconds,e.nanos)}function ht(t){return null==t}function lt(t){return 0===t&&1/t==-1/0}function ft(t){return"number"==typeof t&&Number.isInteger(t)&&!lt(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class gt{constructor(t){this.path=t}static fromPath(t){return new gt(Y.fromString(t))}static fromName(t){return new gt(Y.fromString(t).popFirst(5))}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Y.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new gt(new Y(t.slice()))}}function mt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?at(t)?4:10:S()}function pt(t,e){if(t===e)return!0;const n=mt(t);if(n!==mt(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ut(t).isEqual(ut(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=st(t.timestampValue),s=st(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ot(t.bytesValue).isEqual(ot(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return it(t.geoPointValue.latitude)===it(e.geoPointValue.latitude)&&it(t.geoPointValue.longitude)===it(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return it(t.integerValue)===it(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=it(t.doubleValue),s=it(e.doubleValue);return n===s?lt(n)===lt(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return K(t.arrayValue.values||[],e.arrayValue.values||[],pt);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(Q(n)!==Q(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!pt(n[t],s[t])))return!1;return!0}(t,e);default:return S()}}function yt(t,e){return void 0!==(t.values||[]).find((t=>pt(t,e)))}function wt(t,e){if(t===e)return 0;const n=mt(t),s=mt(e);if(n!==s)return rt(n,s);switch(n){case 0:return 0;case 1:return rt(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=it(t.integerValue||t.doubleValue),s=it(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return vt(t.timestampValue,e.timestampValue);case 4:return vt(ut(t),ut(e));case 5:return rt(t.stringValue,e.stringValue);case 6:return function(t,e){const n=ot(t),s=ot(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=rt(n[t],s[t]);if(0!==e)return e}return rt(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=rt(it(t.latitude),it(e.latitude));return 0!==n?n:rt(it(t.longitude),it(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=wt(n[t],s[t]);if(e)return e}return rt(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=rt(s[t],r[t]);if(0!==e)return e;const o=wt(n[s[t]],i[r[t]]);if(0!==o)return o}return rt(s.length,r.length)}(t.mapValue,e.mapValue);default:throw S()}}function vt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return rt(t,e);const n=st(t),s=st(e),i=rt(n.seconds,s.seconds);return 0!==i?i:rt(n.nanos,s.nanos)}function bt(t){return Tt(t)}function Tt(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=st(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ot(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,gt.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=Tt(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${Tt(t.fields[i])}`;return n+"}"}(t.mapValue):S();var e,n}function It(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Et(t){return!!t&&"integerValue"in t}function _t(t){return!!t&&"arrayValue"in t}function St(t){return!!t&&"nullValue"in t}function At(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Dt(t){return!!t&&"mapValue"in t}function kt(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return H(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=kt(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=kt(t.arrayValue.values[n]);return e}return Object.assign({},t)}class Ct{constructor(t){this.value=t}static empty(){return new Ct({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Dt(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=kt(e)}setAll(t){let e=J.emptyPath(),n={},s=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=i.popLast()}t?n[i.lastSegment()]=kt(t):s.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());Dt(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return pt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Dt(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){H(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Ct(kt(this.value))}}function Nt(t){const e=[];return H(t.fields,((t,n)=>{const s=new J([t]);if(Dt(n)){const t=Nt(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)})),new Z(e)}class xt{constructor(t,e,n,s,i){this.key=t,this.documentType=e,this.version=n,this.data=s,this.documentState=i}static newInvalidDocument(t){return new xt(t,0,z.min(),Ct.empty(),0)}static newFoundDocument(t,e,n){return new xt(t,1,e,n,0)}static newNoDocument(t,e){return new xt(t,2,e,Ct.empty(),0)}static newUnknownDocument(t,e){return new xt(t,3,e,Ct.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ct.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ct.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof xt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new xt(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Rt{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.R=null}}function Ot(t,e=null,n=[],s=[],i=null,r=null,o=null){return new Rt(t,e,n,s,i,r,o)}function Lt(t){const e=D(t);if(null===e.R){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>function(t){return t.field.canonicalString()+t.op.toString()+bt(t.value)}(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),ht(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Qt(e.startAt)),e.endAt&&(t+="|ub:",t+=Qt(e.endAt)),e.R=t}return e.R}function Mt(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Wt(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!pt(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Xt(t.startAt,e.startAt)&&Xt(t.endAt,e.endAt)}function Pt(t){return gt.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Ft extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.P(t,e,n):new Vt(t,e,n):"array-contains"===e?new Bt(t,n):"in"===e?new Kt(t,n):"not-in"===e?new $t(t,n):"array-contains-any"===e?new Gt(t,n):new Ft(t,e,n)}static P(t,e,n){return"in"===e?new qt(t,n):new jt(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.v(wt(e,this.value)):null!==e&&mt(this.value)===mt(e)&&this.v(wt(e,this.value))}v(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return S()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Vt extends Ft{constructor(t,e,n){super(t,e,n),this.key=gt.fromName(n.referenceValue)}matches(t){const e=gt.comparator(t.key,this.key);return this.v(e)}}class qt extends Ft{constructor(t,e){super(t,"in",e),this.keys=Ut("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class jt extends Ft{constructor(t,e){super(t,"not-in",e),this.keys=Ut("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Ut(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>gt.fromName(t.referenceValue)))}class Bt extends Ft{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return _t(e)&&yt(e.arrayValue,this.value)}}class Kt extends Ft{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&yt(this.value.arrayValue,e)}}class $t extends Ft{constructor(t,e){super(t,"not-in",e)}matches(t){if(yt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!yt(this.value.arrayValue,e)}}class Gt extends Ft{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!_t(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>yt(this.value.arrayValue,t)))}}class zt{constructor(t,e){this.position=t,this.before=e}}function Qt(t){return`${t.before?"b":"a"}:${t.position.map((t=>bt(t))).join(",")}`}class Ht{constructor(t,e="asc"){this.field=t,this.dir=e}}function Wt(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Yt(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.isKeyField()?gt.comparator(gt.fromName(o.referenceValue),n.key):wt(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return t.before?s<=0:s<0}function Xt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!pt(t.position[n],e.position[n]))return!1;return!0}class Jt{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=c,this.S=null,this.D=null,this.startAt,this.endAt}}function Zt(t,e,n,s,i,r,o,c){return new Jt(t,e,n,s,i,r,o,c)}function te(t){return new Jt(t)}function ee(t){return!ht(t.limit)&&"F"===t.limitType}function ne(t){return!ht(t.limit)&&"L"===t.limitType}function re(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function se(t){for(const e of t.filters)if(e.V())return e.field;return null}function ie(t){return null!==t.collectionGroup}function oe(t){const e=D(t);if(null===e.S){e.S=[];const t=se(e),n=re(e);if(null!==t&&null===n)t.isKeyField()||e.S.push(new Ht(t)),e.S.push(new Ht(J.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.S.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.S.push(new Ht(J.keyField(),t))}}}return e.S}function ae(t){const e=D(t);if(!e.D)if("F"===e.limitType)e.D=Ot(e.path,e.collectionGroup,oe(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of oe(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Ht(n.field,e))}const n=e.endAt?new zt(e.endAt.position,!e.endAt.before):null,s=e.startAt?new zt(e.startAt.position,!e.startAt.before):null;e.D=Ot(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.D}function ce(t,e,n){return new Jt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ue(t,e){return Mt(ae(t),ae(e))&&t.limitType===e.limitType}function he(t){return`${Lt(ae(t))}|lt:${t.limitType}`}function le(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${bt(e.value)}`;var e})).join(", ")}]`),ht(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: "+Qt(t.startAt)),t.endAt&&(e+=", endAt: "+Qt(t.endAt)),`Target(${e})`}(ae(t))}; limitType=${t.limitType})`}function de(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):gt.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Yt(t.startAt,oe(t),e))&&(!t.endAt||!Yt(t.endAt,oe(t),e))}(t,e)}function fe(t){return(e,n)=>{let s=!1;for(const i of oe(t)){const t=ge(i,e,n);if(0!==t)return t;s=s||i.field.isKeyField()}return 0}}function ge(t,e,n){const s=t.field.isKeyField()?gt.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),i=n.data.field(t);return null!==s&&null!==i?wt(s,i):S()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return S()}}function me(t,e){if(t.C){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:lt(e)?"-0":e}}function pe(t){return{integerValue:""+t}}function ye(t,e){return ft(e)?pe(e):me(t,e)}class we{constructor(){this._=void 0}}function ve(t,e,n){return t instanceof Ie?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ee?_e(t,e):t instanceof Se?Ae(t,e):function(t,e){const n=Te(t,e),s=ke(n)+ke(t.N);return Et(n)&&Et(t.N)?pe(s):me(t.k,s)}(t,e)}function be(t,e,n){return t instanceof Ee?_e(t,e):t instanceof Se?Ae(t,e):n}function Te(t,e){return t instanceof De?Et(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Ie extends we{}class Ee extends we{constructor(t){super(),this.elements=t}}function _e(t,e){const n=Ce(e);for(const e of t.elements)n.some((t=>pt(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Se extends we{constructor(t){super(),this.elements=t}}function Ae(t,e){let n=Ce(e);for(const e of t.elements)n=n.filter((t=>!pt(t,e)));return{arrayValue:{values:n}}}class De extends we{constructor(t,e){super(),this.k=t,this.N=e}}function ke(t){return it(t.integerValue||t.doubleValue)}function Ce(t){return _t(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Ne{constructor(t,e){this.field=t,this.transform=e}}class xe{constructor(t,e){this.version=t,this.transformResults=e}}class Re{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Re}static exists(t){return new Re(void 0,t)}static updateTime(t){return new Re(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Oe(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Le{}function Me(t,e,n){t instanceof je?function(t,e,n){const s=t.value.clone(),i=Ke(t.fieldTransforms,e,n.transformResults);s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof Ue?function(t,e,n){if(!Oe(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=Ke(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Be(t)),i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Pe(t,e,n){t instanceof je?function(t,e,n){if(!Oe(t.precondition,e))return;const s=t.value.clone(),i=$e(t.fieldTransforms,n,e);s.setAll(i),e.convertToFoundDocument(qe(e),s).setHasLocalMutations()}(t,e,n):t instanceof Ue?function(t,e,n){if(!Oe(t.precondition,e))return;const s=$e(t.fieldTransforms,n,e),i=e.data;i.setAll(Be(t)),i.setAll(s),e.convertToFoundDocument(qe(e),i).setHasLocalMutations()}(t,e,n):function(t,e){Oe(t.precondition,e)&&e.convertToNoDocument(z.min())}(t,e)}function Fe(t,e){let n=null;for(const s of t.fieldTransforms){const t=e.data.field(s.field),i=Te(s.transform,t||null);null!=i&&(null==n&&(n=Ct.empty()),n.set(s.field,i))}return n||null}function Ve(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&K(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ee&&e instanceof Ee||t instanceof Se&&e instanceof Se?K(t.elements,e.elements,pt):t instanceof De&&e instanceof De?pt(t.N,e.N):t instanceof Ie&&e instanceof Ie}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function qe(t){return t.isFoundDocument()?t.version:z.min()}class je extends Le{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}}class Ue extends Le{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}}function Be(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function Ke(t,e,n){const s=new Map;A(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,c=e.data.field(r.field);s.set(r.field,be(o,c,n[i]))}return s}function $e(t,e,n){const s=new Map;for(const i of t){const t=i.transform,r=n.data.field(i.field);s.set(i.field,ve(t,r,e))}return s}class Ge extends Le{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class ze extends Le{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}class Qe{constructor(t){this.count=t}}var He,We;function Ye(t){switch(t){default:return S();case k.CANCELLED:case k.UNKNOWN:case k.DEADLINE_EXCEEDED:case k.RESOURCE_EXHAUSTED:case k.INTERNAL:case k.UNAVAILABLE:case k.UNAUTHENTICATED:return!1;case k.INVALID_ARGUMENT:case k.NOT_FOUND:case k.ALREADY_EXISTS:case k.PERMISSION_DENIED:case k.FAILED_PRECONDITION:case k.ABORTED:case k.OUT_OF_RANGE:case k.UNIMPLEMENTED:case k.DATA_LOSS:return!0}}function Xe(t){if(void 0===t)return I("GRPC error has no .code"),k.UNKNOWN;switch(t){case He.OK:return k.OK;case He.CANCELLED:return k.CANCELLED;case He.UNKNOWN:return k.UNKNOWN;case He.DEADLINE_EXCEEDED:return k.DEADLINE_EXCEEDED;case He.RESOURCE_EXHAUSTED:return k.RESOURCE_EXHAUSTED;case He.INTERNAL:return k.INTERNAL;case He.UNAVAILABLE:return k.UNAVAILABLE;case He.UNAUTHENTICATED:return k.UNAUTHENTICATED;case He.INVALID_ARGUMENT:return k.INVALID_ARGUMENT;case He.NOT_FOUND:return k.NOT_FOUND;case He.ALREADY_EXISTS:return k.ALREADY_EXISTS;case He.PERMISSION_DENIED:return k.PERMISSION_DENIED;case He.FAILED_PRECONDITION:return k.FAILED_PRECONDITION;case He.ABORTED:return k.ABORTED;case He.OUT_OF_RANGE:return k.OUT_OF_RANGE;case He.UNIMPLEMENTED:return k.UNIMPLEMENTED;case He.DATA_LOSS:return k.DATA_LOSS;default:return S()}}(We=He||(He={}))[We.OK=0]="OK",We[We.CANCELLED=1]="CANCELLED",We[We.UNKNOWN=2]="UNKNOWN",We[We.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",We[We.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",We[We.NOT_FOUND=5]="NOT_FOUND",We[We.ALREADY_EXISTS=6]="ALREADY_EXISTS",We[We.PERMISSION_DENIED=7]="PERMISSION_DENIED",We[We.UNAUTHENTICATED=16]="UNAUTHENTICATED",We[We.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",We[We.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",We[We.ABORTED=10]="ABORTED",We[We.OUT_OF_RANGE=11]="OUT_OF_RANGE",We[We.UNIMPLEMENTED=12]="UNIMPLEMENTED",We[We.INTERNAL=13]="INTERNAL",We[We.UNAVAILABLE=14]="UNAVAILABLE",We[We.DATA_LOSS=15]="DATA_LOSS";class Je{constructor(t,e){this.comparator=t,this.root=e||tn.EMPTY}insert(t,e){return new Je(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,tn.BLACK,null,null))}remove(t){return new Je(this.comparator,this.root.remove(t,this.comparator).copy(null,null,tn.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ze(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ze(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ze(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ze(this.root,t,this.comparator,!0)}}class Ze{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class tn{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:tn.RED,this.left=null!=s?s:tn.EMPTY,this.right=null!=i?i:tn.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new tn(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return tn.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return tn.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,tn.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,tn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw S();if(this.right.isRed())throw S();const t=this.left.check();if(t!==this.right.check())throw S();return t+(this.isRed()?0:1)}}tn.EMPTY=null,tn.RED=!0,tn.BLACK=!1,tn.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(t,e,n,s,i){return this}insert(t,e,n){return new tn(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class en{constructor(t){this.comparator=t,this.data=new Je(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new nn(this.data.getIterator())}getIteratorFrom(t){return new nn(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof en))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new en(this.comparator);return e.data=t,e}}class nn{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const rn=new Je(gt.comparator);function sn(){return rn}const on=new Je(gt.comparator);function an(){return on}const cn=new Je(gt.comparator);function un(){return cn}const hn=new en(gt.comparator);function ln(...t){let e=hn;for(const n of t)e=e.add(n);return e}const dn=new en(rt);function fn(){return dn}class gn{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,mn.createSynthesizedTargetChangeForCurrentChange(t,e)),new gn(z.min(),n,fn(),sn(),ln())}}class mn{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e){return new mn(et.EMPTY_BYTE_STRING,e,ln(),ln(),ln())}}class pn{constructor(t,e,n,s){this.$=t,this.removedTargetIds=e,this.key=n,this.O=s}}class yn{constructor(t,e){this.targetId=t,this.M=e}}class wn{constructor(t,e,n=et.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class vn{constructor(){this.F=0,this.L=In(),this.B=et.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.F}get j(){return this.q}W(t){t.approximateByteSize()>0&&(this.q=!0,this.B=t)}G(){let t=ln(),e=ln(),n=ln();return this.L.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:S()}})),new mn(this.B,this.U,t,e,n)}H(){this.q=!1,this.L=In()}J(t,e){this.q=!0,this.L=this.L.insert(t,e)}Y(t){this.q=!0,this.L=this.L.remove(t)}X(){this.F+=1}Z(){this.F-=1}tt(){this.q=!0,this.U=!0}}class bn{constructor(t){this.et=t,this.nt=new Map,this.st=sn(),this.it=Tn(),this.rt=new en(rt)}ot(t){for(const e of t.$)t.O&&t.O.isFoundDocument()?this.ct(e,t.O):this.at(e,t.key,t.O);for(const e of t.removedTargetIds)this.at(e,t.key,t.O)}ut(t){this.forEachTarget(t,(e=>{const n=this.ht(e);switch(t.state){case 0:this.lt(e)&&n.W(t.resumeToken);break;case 1:n.Z(),n.K||n.H(),n.W(t.resumeToken);break;case 2:n.Z(),n.K||this.removeTarget(e);break;case 3:this.lt(e)&&(n.tt(),n.W(t.resumeToken));break;case 4:this.lt(e)&&(this.ft(e),n.W(t.resumeToken));break;default:S()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.nt.forEach(((t,n)=>{this.lt(n)&&e(n)}))}dt(t){const e=t.targetId,n=t.M.count,s=this.wt(e);if(s){const t=s.target;if(Pt(t))if(0===n){const n=new gt(t.path);this.at(e,n,xt.newNoDocument(n,z.min()))}else A(1===n);else this._t(e)!==n&&(this.ft(e),this.rt=this.rt.add(e))}}gt(t){const e=new Map;this.nt.forEach(((n,s)=>{const i=this.wt(s);if(i){if(n.current&&Pt(i.target)){const e=new gt(i.target.path);null!==this.st.get(e)||this.yt(s,e)||this.at(s,e,xt.newNoDocument(e,t))}n.j&&(e.set(s,n.G()),n.H())}}));let n=ln();this.it.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.wt(t);return!e||2===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))}));const s=new gn(t,e,this.rt,this.st,n);return this.st=sn(),this.it=Tn(),this.rt=new en(rt),s}ct(t,e){if(!this.lt(t))return;const n=this.yt(t,e.key)?2:0;this.ht(t).J(e.key,n),this.st=this.st.insert(e.key,e),this.it=this.it.insert(e.key,this.Tt(e.key).add(t))}at(t,e,n){if(!this.lt(t))return;const s=this.ht(t);this.yt(t,e)?s.J(e,1):s.Y(e),this.it=this.it.insert(e,this.Tt(e).delete(t)),n&&(this.st=this.st.insert(e,n))}removeTarget(t){this.nt.delete(t)}_t(t){const e=this.ht(t).G();return this.et.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}X(t){this.ht(t).X()}ht(t){let e=this.nt.get(t);return e||(e=new vn,this.nt.set(t,e)),e}Tt(t){let e=this.it.get(t);return e||(e=new en(rt),this.it=this.it.insert(t,e)),e}lt(t){const e=null!==this.wt(t);return e||T("WatchChangeAggregator","Detected inactive target",t),e}wt(t){const e=this.nt.get(t);return e&&e.K?null:this.et.Et(t)}ft(t){this.nt.set(t,new vn),this.et.getRemoteKeysForTarget(t).forEach((e=>{this.at(t,e,null)}))}yt(t,e){return this.et.getRemoteKeysForTarget(t).has(e)}}function Tn(){return new Je(gt.comparator)}function In(){return new Je(gt.comparator)}const En={asc:"ASCENDING",desc:"DESCENDING"},_n={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Sn{constructor(t,e){this.databaseId=t,this.C=e}}function An(t,e){return t.C?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Dn(t,e){return t.C?e.toBase64():e.toUint8Array()}function kn(t,e){return An(t,e.toTimestamp())}function Cn(t){return A(!!t),z.fromTimestamp(function(t){const e=st(t);return new G(e.seconds,e.nanos)}(t))}function Nn(t,e){return function(t){return new Y(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function xn(t){const e=Y.fromString(t);return A(nr(e)),e}function Rn(t,e){return Nn(t.databaseId,e.path)}function On(t,e){const n=xn(e);if(n.get(1)!==t.databaseId.projectId)throw new C(k.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new C(k.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new gt(Fn(n))}function Ln(t,e){return Nn(t.databaseId,e)}function Mn(t){const e=xn(t);return 4===e.length?Y.emptyPath():Fn(e)}function Pn(t){return new Y(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Fn(t){return A(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Vn(t,e,n){return{name:Rn(t,e),fields:n.value.mapValue.fields}}function qn(t,e,n){const s=On(t,e.name),i=Cn(e.updateTime),r=new Ct({mapValue:{fields:e.fields}}),o=xt.newFoundDocument(s,i,r);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function jn(t,e){let n;if(e instanceof je)n={update:Vn(t,e.key,e.value)};else if(e instanceof Ge)n={delete:Rn(t,e.key)};else if(e instanceof Ue)n={update:Vn(t,e.key,e.data),updateMask:er(e.fieldMask)};else{if(!(e instanceof ze))return S();n={verify:Rn(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ie)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ee)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Se)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof De)return{fieldPath:e.field.canonicalString(),increment:n.N};throw S()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:kn(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:S()}(t,e.precondition)),n}function Un(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Re.updateTime(Cn(t.updateTime)):void 0!==t.exists?Re.exists(t.exists):Re.none()}(e.currentDocument):Re.none(),s=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)A("REQUEST_TIME"===e.setToServerValue),n=new Ie;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Ee(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Se(t)}else"increment"in e?n=new De(t,e.increment):S();const s=J.fromServerFormat(e.fieldPath);return new Ne(s,n)}(t,e))):[];if(e.update){e.update.name;const i=On(t,e.update.name),r=new Ct({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new Z(e.map((t=>J.fromServerFormat(t))))}(e.updateMask);return new Ue(i,r,t,n,s)}return new je(i,r,n,s)}if(e.delete){const s=On(t,e.delete);return new Ge(s,n)}if(e.verify){const s=On(t,e.verify);return new ze(s,n)}return S()}function Bn(t,e){return{documents:[Ln(t,e.path)]}}function Kn(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=Ln(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ln(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const i=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(At(t.value))return{unaryFilter:{field:Yn(t.field),op:"IS_NAN"}};if(St(t.value))return{unaryFilter:{field:Yn(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(At(t.value))return{unaryFilter:{field:Yn(t.field),op:"IS_NOT_NAN"}};if(St(t.value))return{unaryFilter:{field:Yn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yn(t.field),op:Wn(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Yn(t.field),direction:Hn(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.C||ht(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=zn(e.startAt)),e.endAt&&(n.structuredQuery.endAt=zn(e.endAt)),n}function $n(t){let e=Mn(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){A(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=Gn(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new Ht(Xn(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let c=null;n.limit&&(c=function(t){let e;return e="object"==typeof t?t.value:t,ht(e)?null:e}(n.limit));let a=null;n.startAt&&(a=Qn(n.startAt));let u=null;return n.endAt&&(u=Qn(n.endAt)),Zt(e,i,o,r,c,"F",a,u)}function Gn(t){return t?void 0!==t.unaryFilter?[Zn(t)]:void 0!==t.fieldFilter?[Jn(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>Gn(t))).reduce(((t,e)=>t.concat(e))):S():[]}function zn(t){return{before:t.before,values:t.position}}function Qn(t){const e=!!t.before,n=t.values||[];return new zt(n,e)}function Hn(t){return En[t]}function Wn(t){return _n[t]}function Yn(t){return{fieldPath:t.canonicalString()}}function Xn(t){return J.fromServerFormat(t.fieldPath)}function Jn(t){return Ft.create(Xn(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(t.fieldFilter.op),t.fieldFilter.value)}function Zn(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Xn(t.unaryFilter.field);return Ft.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Xn(t.unaryFilter.field);return Ft.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Xn(t.unaryFilter.field);return Ft.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Xn(t.unaryFilter.field);return Ft.create(i,"!=",{nullValue:"NULL_VALUE"});default:return S()}}function er(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function nr(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function rr(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=ir(e)),e=sr(t.get(n),e);return ir(e)}function sr(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function ir(t){return t+""}function or(t){const e=t.length;if(A(e>=2),2===e)return A(""===t.charAt(0)&&""===t.charAt(1)),Y.emptyPath();const n=e-2,s=[];let i="";for(let r=0;r<e;){const e=t.indexOf("",r);switch((e<0||e>n)&&S(),t.charAt(e+1)){case"":const n=t.substring(r,e);let o;0===i.length?o=n:(i+=n,o=i,i=""),s.push(o);break;case"":i+=t.substring(r,e),i+="\0";break;case"":i+=t.substring(r,e+1);break;default:S()}r=e+2}return new Y(s)}class ar{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class cr{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}cr.store="owner",cr.key="owner";class ur{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}ur.store="mutationQueues",ur.keyPath="userId";class lr{constructor(t,e,n,s,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=i}}lr.store="mutations",lr.keyPath="batchId",lr.userMutationsIndex="userMutationsIndex",lr.userMutationsKeyPath=["userId","batchId"];class dr{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,rr(e)]}static key(t,e,n){return[t,rr(e),n]}}dr.store="documentMutations",dr.PLACEHOLDER=new dr;class fr{constructor(t,e){this.path=t,this.readTime=e}}class gr{constructor(t,e){this.path=t,this.version=e}}class mr{constructor(t,e,n,s,i,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=r}}mr.store="remoteDocuments",mr.readTimeIndex="readTimeIndex",mr.readTimeIndexPath="readTime",mr.collectionReadTimeIndex="collectionReadTimeIndex",mr.collectionReadTimeIndexPath=["parentPath","readTime"];class pr{constructor(t){this.byteSize=t}}pr.store="remoteDocumentGlobal",pr.key="remoteDocumentGlobalKey";class yr{constructor(t,e,n,s,i,r,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=r,this.query=o}}yr.store="targets",yr.keyPath="targetId",yr.queryTargetsIndexName="queryTargetsIndex",yr.queryTargetsKeyPath=["canonicalId","targetId"];class wr{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}wr.store="targetDocuments",wr.keyPath=["targetId","path"],wr.documentTargetsIndex="documentTargetsIndex",wr.documentTargetsKeyPath=["path","targetId"];class vr{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}vr.key="targetGlobalKey",vr.store="targetGlobal";class Tr{constructor(t,e){this.collectionId=t,this.parent=e}}Tr.store="collectionParents",Tr.keyPath=["collectionId","parent"];class Ir{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}Ir.store="clientMetadata",Ir.keyPath="clientId";class Er{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}Er.store="bundles",Er.keyPath="bundleId";class _r{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}_r.store="namedQueries",_r.keyPath="name";const Sr=[ur.store,lr.store,dr.store,mr.store,yr.store,cr.store,vr.store,wr.store,Ir.store,pr.store,Tr.store,Er.store,_r.store],Ar="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Dr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}class kr{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new kr(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof kr?e:kr.resolve(e)}catch(t){return kr.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):kr.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):kr.reject(e)}static resolve(t){return new kr(((e,n)=>{e(t)}))}static reject(t){return new kr(((e,n)=>{n(t)}))}static waitFor(t){return new kr(((e,n)=>{let s=0,i=0,r=!1;t.forEach((t=>{++s,t.next((()=>{++i,r&&i===s&&e()}),(t=>n(t)))})),r=!0,i===s&&e()}))}static or(t){let e=kr.resolve(!1);for(const n of t)e=e.next((t=>t?kr.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}}class Cr{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.It=new N,this.transaction.oncomplete=()=>{this.It.resolve()},this.transaction.onabort=()=>{e.error?this.It.reject(new Rr(t,e.error)):this.It.resolve()},this.transaction.onerror=e=>{const n=Fr(e.target.error);this.It.reject(new Rr(t,n))}}static open(t,e,n,s){try{return new Cr(e,t.transaction(s,n))}catch(t){throw new Rr(e,t)}}get At(){return this.It.promise}abort(t){t&&this.It.reject(t),this.aborted||(T("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new Lr(e)}}class Nr{constructor(t,e,n){this.name=t,this.version=e,this.Rt=n,12.2===Nr.bt(Object(h.j)())&&I("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return T("SimpleDb","Removing database:",t),Mr(window.indexedDB.deleteDatabase(t)).toPromise()}static Pt(){if(!Object(h.o)())return!1;if(Nr.vt())return!0;const t=Object(h.j)(),e=Nr.bt(t),n=0<e&&e<10,s=Nr.Vt(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static vt(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.St)}static Dt(t,e){return t.store(e)}static bt(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Vt(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Ct(t){return this.db||(T("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=t=>{const n=t.target.result;e(n)},s.onblocked=()=>{n(new Rr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=e=>{const s=e.target.error;"VersionError"===s.name?n(new C(k.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===s.name?n(new C(k.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):n(new Rr(t,s))},s.onupgradeneeded=t=>{T("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.Rt.Nt(e,s.transaction,t.oldVersion,this.version).next((()=>{T("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.kt&&(this.db.onversionchange=t=>this.kt(t)),this.db}xt(t){this.kt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const i="readonly"===e;let r=0;for(;;){++r;try{this.db=await this.Ct(t);const e=Cr.open(this.db,t,i?"readonly":"readwrite",n),r=s(e).catch((t=>(e.abort(t),kr.reject(t)))).toPromise();return r.catch((()=>{})),await e.At,r}catch(t){const e="FirebaseError"!==t.name&&r<3;if(T("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class xr{constructor(t){this.$t=t,this.Ot=!1,this.Mt=null}get isDone(){return this.Ot}get Ft(){return this.Mt}set cursor(t){this.$t=t}done(){this.Ot=!0}Lt(t){this.Mt=t}delete(){return Mr(this.$t.delete())}}class Rr extends C{constructor(t,e){super(k.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Or(t){return"IndexedDbTransactionError"===t.name}class Lr{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(T("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(T("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Mr(n)}add(t){return T("SimpleDb","ADD",this.store.name,t,t),Mr(this.store.add(t))}get(t){return Mr(this.store.get(t)).next((e=>(void 0===e&&(e=null),T("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return T("SimpleDb","DELETE",this.store.name,t),Mr(this.store.delete(t))}count(){return T("SimpleDb","COUNT",this.store.name),Mr(this.store.count())}Bt(t,e){const n=this.cursor(this.options(t,e)),s=[];return this.Ut(n,((t,e)=>{s.push(e)})).next((()=>s))}qt(t,e){T("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.Kt=!1;const s=this.cursor(n);return this.Ut(s,((t,e,n)=>n.delete()))}jt(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.Ut(s,e)}Qt(t){const e=this.cursor({});return new kr(((n,s)=>{e.onerror=t=>{const e=Fr(t.target.error);s(e)},e.onsuccess=e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next((t=>{t?s.continue():n()})):n()}}))}Ut(t,e){const n=[];return new kr(((s,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void s();const r=new xr(i),o=e(i.primaryKey,i.value,r);if(o instanceof kr){const t=o.catch((t=>(r.done(),kr.reject(t))));n.push(t)}r.isDone?s():null===r.Ft?i.continue():i.continue(r.Ft)}})).next((()=>kr.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.Kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Mr(t){return new kr(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Fr(t.target.error);n(e)}}))}let Pr=!1;function Fr(t){const e=Nr.bt(Object(h.j)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Pr||(Pr=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Vr extends Dr{constructor(t,e){super(),this.Wt=t,this.currentSequenceNumber=e}}function qr(t,e){const n=D(t);return Nr.Dt(n.Wt,e)}class jr{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&Me(s,t,n[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&Pe(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&Pe(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach((e=>{const n=t.get(e.key),s=n;this.applyToLocalView(s),n.isValidDocument()||s.convertToNoDocument(z.min())}))}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ln())}isEqual(t){return this.batchId===t.batchId&&K(this.mutations,t.mutations,((t,e)=>Ve(t,e)))&&K(this.baseMutations,t.baseMutations,((t,e)=>Ve(t,e)))}}class Ur{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){A(t.mutations.length===n.length);let s=un();const i=t.mutations;for(let t=0;t<i.length;t++)s=s.insert(i[t].key,n[t].version);return new Ur(t,e,n,s)}}class Br{constructor(t,e,n,s,i=z.min(),r=z.min(),o=et.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(t){return new Br(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Br(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Br(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class Kr{constructor(t){this.Gt=t}}function $r(t,e){if(e.document)return qn(t.Gt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=gt.fromSegments(e.noDocument.path),n=Hr(e.noDocument.readTime),s=xt.newNoDocument(t,n);return e.hasCommittedMutations?s.setHasCommittedMutations():s}if(e.unknownDocument){const t=gt.fromSegments(e.unknownDocument.path),n=Hr(e.unknownDocument.version);return xt.newUnknownDocument(t,n)}return S()}function li(t,e,n){const s=Gr(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){const n=function(t,e){return{name:Rn(t,e.key),fields:e.data.value.mapValue.fields,updateTime:An(t,e.version.toTimestamp())}}(t.Gt,e),r=e.hasCommittedMutations;return new mr(null,null,n,r,s,i)}if(e.isNoDocument()){const t=e.key.path.toArray(),n=Qr(e.version),r=e.hasCommittedMutations;return new mr(null,new fr(t,n),null,r,s,i)}if(e.isUnknownDocument()){const t=e.key.path.toArray(),n=Qr(e.version);return new mr(new gr(t,n),null,null,!0,s,i)}return S()}function Gr(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function zr(t){const e=new G(t[0],t[1]);return z.fromTimestamp(e)}function Qr(t){const e=t.toTimestamp();return new ar(e.seconds,e.nanoseconds)}function Hr(t){const e=new G(t.seconds,t.nanoseconds);return z.fromTimestamp(e)}function Wr(t,e){const n=(e.baseMutations||[]).map((e=>Un(t.Gt,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const s=e.mutations[t+1];n.updateTransforms=s.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const s=e.mutations.map((e=>Un(t.Gt,e))),i=G.fromMillis(e.localWriteTimeMs);return new jr(e.batchId,i,n,s)}function Yr(t){const e=Hr(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Hr(t.lastLimboFreeSnapshotVersion):z.min();let s;var i;return void 0!==t.query.documents?(A(1===(i=t.query).documents.length),s=ae(te(Mn(i.documents[0])))):s=function(t){return ae($n(t))}(t.query),new Br(s,t.targetId,0,t.lastListenSequenceNumber,e,n,et.fromBase64String(t.resumeToken))}function Xr(t,e){const n=Qr(e.snapshotVersion),s=Qr(e.lastLimboFreeSnapshotVersion);let i;i=Pt(e.target)?Bn(t.Gt,e.target):Kn(t.Gt,e.target);const r=e.resumeToken.toBase64();return new yr(e.targetId,Lt(e.target),n,r,e.sequenceNumber,s,i)}function Jr(t){const e=$n({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?ce(e,e.limit,"L"):e}class Zr{getBundleMetadata(t,e){return ts(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:Hr(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return ts(t).put({bundleId:(n=e).id,createTime:Qr(Cn(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return es(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:Jr(e.bundledQuery),readTime:Hr(e.readTime)};var e}))}saveNamedQuery(t,e){return es(t).put(function(t){return{name:t.name,readTime:Qr(Cn(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function ts(t){return qr(t,Er.store)}function es(t){return qr(t,_r.store)}class ns{constructor(){this.zt=new rs}addToCollectionParentIndex(t,e){return this.zt.add(e),kr.resolve()}getCollectionParents(t,e){return kr.resolve(this.zt.getEntries(e))}}class rs{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new en(Y.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new en(Y.comparator)).toArray()}}class ss{constructor(){this.Ht=new rs}addToCollectionParentIndex(t,e){if(!this.Ht.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener((()=>{this.Ht.add(e)}));const i={collectionId:n,parent:rr(s)};return is(t).put(i)}return kr.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[$(e),""],!1,!0);return is(t).Bt(s).next((t=>{for(const s of t){if(s.collectionId!==e)break;n.push(or(s.parent))}return n}))}}function is(t){return qr(t,Tr.store)}const os={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class as{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new as(t,as.DEFAULT_COLLECTION_PERCENTILE,as.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function cs(t,e,n){const s=t.store(lr.store),i=t.store(dr.store),r=[],o=IDBKeyRange.only(n.batchId);let c=0;const a=s.jt({range:o},((t,e,n)=>(c++,n.delete())));r.push(a.next((()=>{A(1===c)})));const u=[];for(const t of n.mutations){const s=dr.key(e,t.key.path,n.batchId);r.push(i.delete(s)),u.push(t.key)}return kr.waitFor(r).next((()=>u))}function us(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw S();e=t.noDocument}return JSON.stringify(e).length}as.DEFAULT_COLLECTION_PERCENTILE=10,as.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,as.DEFAULT=new as(41943040,as.DEFAULT_COLLECTION_PERCENTILE,as.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),as.DISABLED=new as(-1,0,0);class hs{constructor(t,e,n,s){this.userId=t,this.k=e,this.Jt=n,this.referenceDelegate=s,this.Yt={}}static Xt(t,e,n,s){A(""!==t.uid);const i=t.isAuthenticated()?t.uid:"";return new hs(i,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ds(t).jt({index:lr.userMutationsIndex,range:n},((t,n,s)=>{e=!1,s.done()})).next((()=>e))}addMutationBatch(t,e,n,s){const i=fs(t),r=ds(t);return r.add({}).next((o=>{A("number"==typeof o);const c=new jr(o,e,n,s),a=function(t,e,n){const s=n.baseMutations.map((e=>jn(t.Gt,e))),i=n.mutations.map((e=>jn(t.Gt,e)));return new lr(e,n.batchId,n.localWriteTime.toMillis(),s,i)}(this.k,this.userId,c),u=[];let h=new en(((t,e)=>rt(t.canonicalString(),e.canonicalString())));for(const t of s){const e=dr.key(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),u.push(r.put(a)),u.push(i.put(e,dr.PLACEHOLDER))}return h.forEach((e=>{u.push(this.Jt.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.Yt[o]=c.keys()})),kr.waitFor(u).next((()=>c))}))}lookupMutationBatch(t,e){return ds(t).get(e).next((t=>t?(A(t.userId===this.userId),Wr(this.k,t)):null))}Zt(t,e){return this.Yt[e]?kr.resolve(this.Yt[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.Yt[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return ds(t).jt({index:lr.userMutationsIndex,range:s},((t,e,s)=>{e.userId===this.userId&&(A(e.batchId>=n),i=Wr(this.k,e)),s.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return ds(t).jt({index:lr.userMutationsIndex,range:e,reverse:!0},((t,e,s)=>{n=e.batchId,s.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ds(t).Bt(lr.userMutationsIndex,e).next((t=>t.map((t=>Wr(this.k,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=dr.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return fs(t).jt({range:s},((n,s,r)=>{const[o,c,a]=n,u=or(c);if(o===this.userId&&e.path.isEqual(u))return ds(t).get(a).next((t=>{if(!t)throw S();A(t.userId===this.userId),i.push(Wr(this.k,t))}));r.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new en(rt);const s=[];return e.forEach((e=>{const i=dr.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=fs(t).jt({range:r},((t,s,i)=>{const[r,o,c]=t,a=or(o);r===this.userId&&e.path.isEqual(a)?n=n.add(c):i.done()}));s.push(o)})),kr.waitFor(s).next((()=>this.te(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,i=dr.prefixForPath(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new en(rt);return fs(t).jt({range:r},((t,e,i)=>{const[r,c,a]=t,u=or(c);r===this.userId&&n.isPrefixOf(u)?u.length===s&&(o=o.add(a)):i.done()})).next((()=>this.te(t,o)))}te(t,e){const n=[],s=[];return e.forEach((e=>{s.push(ds(t).get(e).next((t=>{if(null===t)throw S();A(t.userId===this.userId),n.push(Wr(this.k,t))})))})),kr.waitFor(s).next((()=>n))}removeMutationBatch(t,e){return cs(t.Wt,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.ee(e.batchId)})),kr.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}ee(t){delete this.Yt[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return kr.resolve();const n=IDBKeyRange.lowerBound(dr.prefixForUser(this.userId)),s=[];return fs(t).jt({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=or(t[1]);s.push(e)}else n.done()})).next((()=>{A(0===s.length)}))}))}containsKey(t,e){return ls(t,this.userId,e)}ne(t){return gs(t).get(this.userId).next((t=>t||new ur(this.userId,-1,"")))}}function ls(t,e,n){const s=dr.prefixForPath(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return fs(t).jt({range:r,Kt:!0},((t,n,s)=>{const[r,c,a]=t;r===e&&c===i&&(o=!0),s.done()})).next((()=>o))}function ds(t){return qr(t,lr.store)}function fs(t){return qr(t,dr.store)}function gs(t){return qr(t,ur.store)}class ms{constructor(t){this.se=t}next(){return this.se+=2,this.se}static ie(){return new ms(0)}static re(){return new ms(-1)}}class ps{constructor(t,e){this.referenceDelegate=t,this.k=e}allocateTargetId(t){return this.oe(t).next((e=>{const n=new ms(e.highestTargetId);return e.highestTargetId=n.next(),this.ce(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.oe(t).next((t=>z.fromTimestamp(new G(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.oe(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.oe(t).next((s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.ce(t,s))))}addTargetData(t,e){return this.ae(t,e).next((()=>this.oe(t).next((n=>(n.targetCount+=1,this.ue(e,n),this.ce(t,n))))))}updateTargetData(t,e){return this.ae(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>ys(t).delete(e.targetId))).next((()=>this.oe(t))).next((e=>(A(e.targetCount>0),e.targetCount-=1,this.ce(t,e))))}removeTargets(t,e,n){let s=0;const i=[];return ys(t).jt(((r,o)=>{const c=Yr(o);c.sequenceNumber<=e&&null===n.get(c.targetId)&&(s++,i.push(this.removeTargetData(t,c)))})).next((()=>kr.waitFor(i))).next((()=>s))}forEachTarget(t,e){return ys(t).jt(((t,n)=>{const s=Yr(n);e(s)}))}oe(t){return ws(t).get(vr.key).next((t=>(A(null!==t),t)))}ce(t,e){return ws(t).put(vr.key,e)}ae(t,e){return ys(t).put(Xr(this.k,e))}ue(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.oe(t).next((t=>t.targetCount))}getTargetData(t,e){const n=Lt(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return ys(t).jt({range:s,index:yr.queryTargetsIndexName},((t,n,s)=>{const r=Yr(n);Mt(e,r.target)&&(i=r,s.done())})).next((()=>i))}addMatchingKeys(t,e,n){const s=[],i=vs(t);return e.forEach((e=>{const r=rr(e.path);s.push(i.put(new wr(n,r))),s.push(this.referenceDelegate.addReference(t,n,e))})),kr.waitFor(s)}removeMatchingKeys(t,e,n){const s=vs(t);return kr.forEach(e,(e=>{const i=rr(e.path);return kr.waitFor([s.delete([n,i]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=vs(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=vs(t);let i=ln();return s.jt({range:n,Kt:!0},((t,e,n)=>{const s=or(t[1]),r=new gt(s);i=i.add(r)})).next((()=>i))}containsKey(t,e){const n=rr(e.path),s=IDBKeyRange.bound([n],[$(n)],!1,!0);let i=0;return vs(t).jt({index:wr.documentTargetsIndex,Kt:!0,range:s},(([t,e],n,s)=>{0!==t&&(i++,s.done())})).next((()=>i>0))}Et(t,e){return ys(t).get(e).next((t=>t?Yr(t):null))}}function ys(t){return qr(t,yr.store)}function ws(t){return qr(t,vr.store)}function vs(t){return qr(t,wr.store)}async function bs(t){if(t.code!==k.FAILED_PRECONDITION||t.message!==Ar)throw t;T("LocalStore","Unexpectedly lost primary lease")}function Ts([t,e],[n,s]){const i=rt(t,n);return 0===i?rt(e,s):i}class Is{constructor(t){this.he=t,this.buffer=new en(Ts),this.le=0}fe(){return++this.le}de(t){const e=[t,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Ts(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Es{constructor(t,e){this.garbageCollector=t,this.asyncQueue=e,this.we=!1,this._e=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.me(t)}stop(){this._e&&(this._e.cancel(),this._e=null)}get started(){return null!==this._e}me(t){const e=this.we?3e5:6e4;T("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this._e=null,this.we=!0;try{await t.collectGarbage(this.garbageCollector)}catch(t){Or(t)?T("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await bs(t)}await this.me(t)}))}}class _s{constructor(t,e){this.ge=t,this.params=e}calculateTargetCount(t,e){return this.ge.ye(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return kr.resolve(j.I);const n=new Is(e);return this.ge.forEachTarget(t,(t=>n.de(t.sequenceNumber))).next((()=>this.ge.pe(t,(t=>n.de(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.ge.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.ge.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(T("LruGarbageCollector","Garbage collection skipped; disabled"),kr.resolve(os)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(T("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),os):this.Te(t,e)))}getCacheSize(t){return this.ge.getCacheSize(t)}Te(t,e){let n,s,i,r,o,a,u;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(T("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),s=this.params.maximumSequenceNumbersToCollect):s=e,r=Date.now(),this.nthSequenceNumber(t,s)))).next((s=>(n=s,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(u=Date.now(),w()<=c.a.DEBUG&&T("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-h}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(u-a)+"ms\n"+`Total Duration: ${u-h}ms`),kr.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:t}))))}}class Ss{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new _s(t,e)}(this,e)}ye(t){const e=this.Ee(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}Ee(t){let e=0;return this.pe(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}pe(t,e){return this.Ie(t,((t,n)=>e(n)))}addReference(t,e,n){return As(t,n)}removeReference(t,e,n){return As(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return As(t,e)}Ae(t,e){return function(t,e){let n=!1;return gs(t).Qt((s=>ls(t,s,e).next((t=>(t&&(n=!0),kr.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Ie(t,((r,o)=>{if(o<=e){const e=this.Ae(t,r).next((e=>{if(!e)return i++,n.getEntry(t,r).next((()=>(n.removeEntry(r),vs(t).delete([0,rr(r.path)]))))}));s.push(e)}})).next((()=>kr.waitFor(s))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return As(t,e)}Ie(t,e){const n=vs(t);let s,i=j.I;return n.jt({index:wr.documentTargetsIndex},(([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==j.I&&e(new gt(or(s)),i),i=o,s=r):i=j.I})).next((()=>{i!==j.I&&e(new gt(or(s)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function As(t,e){return vs(t).put(function(t,e){return new wr(0,rr(t.path),e)}(e,t.currentSequenceNumber))}class Ds{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.inner[n]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),!0;return!1}forEach(t){H(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return W(this.inner)}}class ks{constructor(){this.changes=new Ds((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}getReadTime(t){const e=this.changes.get(t);return e?e.readTime:z.min()}addEntry(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})}removeEntry(t,e=null){this.assertNotApplied(),this.changes.set(t,{document:xt.newInvalidDocument(t),readTime:e})}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?kr.resolve(n.document):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Cs{constructor(t,e){this.k=t,this.Jt=e}addEntry(t,e,n){return Rs(t).put(tr(e),n)}removeEntry(t,e){const n=Rs(t),s=tr(e);return n.delete(s)}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.Re(t,n))))}getEntry(t,e){return Rs(t).get(tr(e)).next((t=>this.be(e,t)))}Pe(t,e){return Rs(t).get(tr(e)).next((t=>({document:this.be(e,t),size:us(t)})))}getEntries(t,e){let n=sn();return this.ve(t,e,((t,e)=>{const s=this.be(t,e);n=n.insert(t,s)})).next((()=>n))}Ve(t,e){let n=sn(),s=new Je(gt.comparator);return this.ve(t,e,((t,e)=>{const i=this.be(t,e);n=n.insert(t,i),s=s.insert(t,us(e))})).next((()=>({documents:n,Se:s})))}ve(t,e,n){if(e.isEmpty())return kr.resolve();const s=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator();let r=i.getNext();return Rs(t).jt({range:s},((t,e,s)=>{const o=gt.fromSegments(t);for(;r&&gt.comparator(r,o)<0;)n(r,null),r=i.getNext();r&&r.isEqual(o)&&(n(r,e),r=i.hasNext()?i.getNext():null),r?s.Lt(r.path.toArray()):s.done()})).next((()=>{for(;r;)n(r,null),r=i.hasNext()?i.getNext():null}))}getDocumentsMatchingQuery(t,e,n){let s=sn();const i=e.path.length+1,r={};if(n.isEqual(z.min())){const t=e.path.toArray();r.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.toArray(),s=Gr(n);r.range=IDBKeyRange.lowerBound([t,s],!0),r.index=mr.collectionReadTimeIndex}return Rs(t).jt(r,((t,n,r)=>{if(t.length!==i)return;const o=$r(this.k,n);e.path.isPrefixOf(o.key.path)?de(e,o)&&(s=s.insert(o.key,o)):r.done()})).next((()=>s))}newChangeBuffer(t){return new Ns(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return xs(t).get(pr.key).next((t=>(A(!!t),t)))}Re(t,e){return xs(t).put(pr.key,e)}be(t,e){if(e){const t=$r(this.k,e);if(!t.isNoDocument()||!t.version.isEqual(z.min()))return t}return xt.newInvalidDocument(t)}}class Ns extends ks{constructor(t,e){super(),this.De=t,this.trackRemovals=e,this.Ce=new Ds((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,s=new en(((t,e)=>rt(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((i,r)=>{const o=this.Ce.get(i);if(r.document.isValidDocument()){const c=li(this.De.k,r.document,this.getReadTime(i));s=s.add(i.path.popLast());const a=us(c);n+=a-o,e.push(this.De.addEntry(t,i,c))}else if(n-=o,this.trackRemovals){const n=li(this.De.k,xt.newNoDocument(i,z.min()),this.getReadTime(i));e.push(this.De.addEntry(t,i,n))}else e.push(this.De.removeEntry(t,i))})),s.forEach((n=>{e.push(this.De.Jt.addToCollectionParentIndex(t,n))})),e.push(this.De.updateMetadata(t,n)),kr.waitFor(e)}getFromCache(t,e){return this.De.Pe(t,e).next((t=>(this.Ce.set(e,t.size),t.document)))}getAllFromCache(t,e){return this.De.Ve(t,e).next((({documents:t,Se:e})=>(e.forEach(((t,e)=>{this.Ce.set(t,e)})),t)))}}function xs(t){return qr(t,pr.store)}function Rs(t){return qr(t,mr.store)}function tr(t){return t.path.toArray()}class Os{constructor(t){this.k=t}Nt(t,e,n,s){A(n<s&&n>=0&&s<=11);const i=new Cr("createOrUpgrade",e);n<1&&s>=1&&(function(t){t.createObjectStore(cr.store)}(t),function(t){t.createObjectStore(ur.store,{keyPath:ur.keyPath}),t.createObjectStore(lr.store,{keyPath:lr.keyPath,autoIncrement:!0}).createIndex(lr.userMutationsIndex,lr.userMutationsKeyPath,{unique:!0}),t.createObjectStore(dr.store)}(t),Ls(t),function(t){t.createObjectStore(mr.store)}(t));let r=kr.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore(wr.store),t.deleteObjectStore(yr.store),t.deleteObjectStore(vr.store)}(t),Ls(t)),r=r.next((()=>function(t){const e=t.store(vr.store),n=new vr(0,0,z.min().toTimestamp(),0);return e.put(vr.key,n)}(i)))),n<4&&s>=4&&(0!==n&&(r=r.next((()=>function(t,e){return e.store(lr.store).Bt().next((n=>{t.deleteObjectStore(lr.store),t.createObjectStore(lr.store,{keyPath:lr.keyPath,autoIncrement:!0}).createIndex(lr.userMutationsIndex,lr.userMutationsKeyPath,{unique:!0});const s=e.store(lr.store),i=n.map((t=>s.put(t)));return kr.waitFor(i)}))}(t,i)))),r=r.next((()=>{!function(t){t.createObjectStore(Ir.store,{keyPath:Ir.keyPath})}(t)}))),n<5&&s>=5&&(r=r.next((()=>this.Ne(i)))),n<6&&s>=6&&(r=r.next((()=>(function(t){t.createObjectStore(pr.store)}(t),this.ke(i))))),n<7&&s>=7&&(r=r.next((()=>this.xe(i)))),n<8&&s>=8&&(r=r.next((()=>this.$e(t,i)))),n<9&&s>=9&&(r=r.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(mr.store);e.createIndex(mr.readTimeIndex,mr.readTimeIndexPath,{unique:!1}),e.createIndex(mr.collectionReadTimeIndex,mr.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&s>=10&&(r=r.next((()=>this.Oe(i)))),n<11&&s>=11&&(r=r.next((()=>{!function(t){t.createObjectStore(Er.store,{keyPath:Er.keyPath})}(t),function(t){t.createObjectStore(_r.store,{keyPath:_r.keyPath})}(t)}))),r}ke(t){let e=0;return t.store(mr.store).jt(((t,n)=>{e+=us(n)})).next((()=>{const n=new pr(e);return t.store(pr.store).put(pr.key,n)}))}Ne(t){const e=t.store(ur.store),n=t.store(lr.store);return e.Bt().next((e=>kr.forEach(e,(e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.Bt(lr.userMutationsIndex,s).next((n=>kr.forEach(n,(n=>{A(n.userId===e.userId);const s=Wr(this.k,n);return cs(t,e.userId,s).next((()=>{}))}))))}))))}xe(t){const e=t.store(wr.store),n=t.store(mr.store);return t.store(vr.store).get(vr.key).next((t=>{const s=[];return n.jt(((n,i)=>{const r=new Y(n),o=function(t){return[0,rr(t)]}(r);s.push(e.get(o).next((n=>n?kr.resolve():(n=>e.put(new wr(0,rr(n),t.highestListenSequenceNumber)))(r))))})).next((()=>kr.waitFor(s)))}))}$e(t,e){t.createObjectStore(Tr.store,{keyPath:Tr.keyPath});const n=e.store(Tr.store),s=new rs,i=t=>{if(s.add(t)){const e=t.lastSegment(),s=t.popLast();return n.put({collectionId:e,parent:rr(s)})}};return e.store(mr.store).jt({Kt:!0},((t,e)=>{const n=new Y(t);return i(n.popLast())})).next((()=>e.store(dr.store).jt({Kt:!0},(([t,e,n],s)=>{const r=or(e);return i(r.popLast())}))))}Oe(t){const e=t.store(yr.store);return e.jt(((t,n)=>{const s=Yr(n),i=Xr(this.k,s);return e.put(i)}))}}function Ls(t){t.createObjectStore(wr.store,{keyPath:wr.keyPath}).createIndex(wr.documentTargetsIndex,wr.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(yr.store,{keyPath:yr.keyPath}).createIndex(yr.queryTargetsIndexName,yr.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(vr.store)}const Ms="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Ps{constructor(t,e,n,s,i,r,o,c,a,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Me=i,this.window=r,this.document=o,this.Fe=a,this.Le=u,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=t=>Promise.resolve(),!Ps.Pt())throw new C(k.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ss(this,s),this.Ge=e+"main",this.k=new Kr(c),this.ze=new Nr(this.Ge,11,new Os(this.k)),this.He=new ps(this.referenceDelegate,this.k),this.Jt=new ss,this.Je=function(t,e){return new Cs(t,e)}(this.k,this.Jt),this.Ye=new Zr,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,!1===u&&I("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ze().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(k.FAILED_PRECONDITION,Ms);return this.tn(),this.en(),this.nn(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.He.getHighestSequenceNumber(t)))})).then((t=>{this.Be=new j(t,this.Fe)})).then((()=>{this.Ue=!0})).catch((t=>(this.ze&&this.ze.close(),Promise.reject(t))))}sn(t){return this.We=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ze.xt((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Me.enqueueAndForget((async()=>{this.started&&await this.Ze()})))}Ze(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>Vs(t).put(new Ir(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next((()=>{if(this.isPrimary)return this.rn(t).next((t=>{t||(this.isPrimary=!1,this.Me.enqueueRetryable((()=>this.We(!1))))}))})).next((()=>this.on(t))).next((e=>this.isPrimary&&!e?this.cn(t).next((()=>!1)):!!e&&this.an(t).next((()=>!0)))))).catch((t=>{if(Or(t))return T("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return T("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Me.enqueueRetryable((()=>this.We(t))),this.isPrimary=t}))}rn(t){return Fs(t).get(cr.key).next((t=>kr.resolve(this.un(t))))}hn(t){return Vs(t).delete(this.clientId)}async ln(){if(this.isPrimary&&!this.fn(this.Qe,18e5)){this.Qe=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=qr(t,Ir.store);return e.Bt().next((t=>{const n=this.dn(t,18e5),s=t.filter((t=>-1===n.indexOf(t)));return kr.forEach(s,(t=>e.delete(t.clientId))).next((()=>s))}))})).catch((()=>[]));if(this.Xe)for(const e of t)this.Xe.removeItem(this.wn(e.clientId))}}nn(){this.je=this.Me.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Ze().then((()=>this.ln())).then((()=>this.nn()))))}un(t){return!!t&&t.ownerId===this.clientId}on(t){return this.Le?kr.resolve(!0):Fs(t).get(cr.key).next((e=>{if(null!==e&&this.fn(e.leaseTimestampMs,5e3)&&!this._n(e.ownerId)){if(this.un(e)&&this.networkEnabled)return!0;if(!this.un(e)){if(!e.allowTabSynchronization)throw new C(k.FAILED_PRECONDITION,Ms);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vs(t).Bt().next((t=>void 0===this.dn(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&T("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.Ue=!1,this.mn(),this.je&&(this.je.cancel(),this.je=null),this.gn(),this.yn(),await this.ze.runTransaction("shutdown","readwrite",[cr.store,Ir.store],(t=>{const e=new Vr(t,j.I);return this.cn(e).next((()=>this.hn(e)))})),this.ze.close(),this.pn()}dn(t,e){return t.filter((t=>this.fn(t.updateTimeMs,e)&&!this._n(t.clientId)))}Tn(){return this.runTransaction("getActiveClients","readonly",(t=>Vs(t).Bt().next((t=>this.dn(t,18e5).map((t=>t.clientId))))))}get started(){return this.Ue}getMutationQueue(t){return hs.Xt(t,this.k,this.Jt,this.referenceDelegate)}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getIndexManager(){return this.Jt}getBundleCache(){return this.Ye}runTransaction(t,e,n){T("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite";let i;return this.ze.runTransaction(t,s,Sr,(s=>(i=new Vr(s,this.Be?this.Be.next():j.I),"readwrite-primary"===e?this.rn(i).next((t=>!!t||this.on(i))).next((e=>{if(!e)throw I(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Me.enqueueRetryable((()=>this.We(!1))),new C(k.FAILED_PRECONDITION,Ar);return n(i)})).next((t=>this.an(i).next((()=>t)))):this.En(i).next((()=>n(i)))))).then((t=>(i.raiseOnCommittedEvent(),t)))}En(t){return Fs(t).get(cr.key).next((t=>{if(null!==t&&this.fn(t.leaseTimestampMs,5e3)&&!this._n(t.ownerId)&&!this.un(t)&&!(this.Le||this.allowTabSynchronization&&t.allowTabSynchronization))throw new C(k.FAILED_PRECONDITION,Ms)}))}an(t){const e=new cr(this.clientId,this.allowTabSynchronization,Date.now());return Fs(t).put(cr.key,e)}static Pt(){return Nr.Pt()}cn(t){const e=Fs(t);return e.get(cr.key).next((t=>this.un(t)?(T("IndexedDbPersistence","Releasing primary lease."),e.delete(cr.key)):kr.resolve()))}fn(t,e){const n=Date.now();return!(t<n-e||t>n&&(I(`Detected an update time that is in the future: ${t} > ${n}`),1))}tn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ke=()=>{this.Me.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Ze())))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground="visible"===this.document.visibilityState)}gn(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}en(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.qe=()=>{this.mn(),Object(h.r)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Me.enterRestrictedMode(!0),this.Me.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.qe))}yn(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}_n(t){var e;try{const n=null!==(null===(e=this.Xe)||void 0===e?void 0:e.getItem(this.wn(t)));return T("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return I("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}mn(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(t){I("Failed to set zombie client id.",t)}}pn(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(t){}}wn(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Fs(t){return qr(t,cr.store)}function Vs(t){return qr(t,Ir.store)}function qs(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class js{constructor(t,e){this.progress=t,this.In=e}}class Us{constructor(t,e,n){this.Je=t,this.An=e,this.Jt=n}Rn(t,e){return this.An.getAllMutationBatchesAffectingDocumentKey(t,e).next((n=>this.bn(t,e,n)))}bn(t,e,n){return this.Je.getEntry(t,e).next((t=>{for(const e of n)e.applyToLocalView(t);return t}))}Pn(t,e){t.forEach(((t,n)=>{for(const t of e)t.applyToLocalView(n)}))}vn(t,e){return this.Je.getEntries(t,e).next((e=>this.Vn(t,e).next((()=>e))))}Vn(t,e){return this.An.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>this.Pn(e,t)))}getDocumentsMatchingQuery(t,e,n){return function(t){return gt.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Sn(t,e.path):ie(e)?this.Dn(t,e,n):this.Cn(t,e,n)}Sn(t,e){return this.Rn(t,new gt(e)).next((t=>{let e=an();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}Dn(t,e,n){const s=e.collectionGroup;let i=an();return this.Jt.getCollectionParents(t,s).next((r=>kr.forEach(r,(r=>{const o=function(t,e){return new Jt(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(s));return this.Cn(t,o,n).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}Cn(t,e,n){let s,i;return this.Je.getDocumentsMatchingQuery(t,e,n).next((n=>(s=n,this.An.getAllMutationBatchesAffectingQuery(t,e)))).next((e=>(i=e,this.Nn(t,i,s).next((t=>{s=t;for(const t of i)for(const e of t.mutations){const n=e.key;let i=s.get(n);null==i&&(i=xt.newInvalidDocument(n),s=s.insert(n,i)),Pe(e,i,t.localWriteTime),i.isFoundDocument()||(s=s.remove(n))}}))))).next((()=>(s.forEach(((t,n)=>{de(e,n)||(s=s.remove(t))})),s)))}Nn(t,e,n){let s=ln();for(const t of e)for(const e of t.mutations)e instanceof Ue&&null===n.get(e.key)&&(s=s.add(e.key));let i=n;return this.Je.getEntries(t,s).next((t=>(t.forEach(((t,e)=>{e.isFoundDocument()&&(i=i.insert(t,e))})),i)))}}class hr{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.kn=n,this.xn=s}static $n(t,e){let n=ln(),s=ln();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new hr(t,e.fromCache,n,s)}}class Bs{On(t){this.Mn=t}getDocumentsMatchingQuery(t,e,n,s){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(z.min())?this.Fn(t,e):this.Mn.vn(t,s).next((i=>{const r=this.Ln(e,i);return(ee(e)||ne(e))&&this.Bn(e.limitType,r,s,n)?this.Fn(t,e):(w()<=c.a.DEBUG&&T("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),le(e)),this.Mn.getDocumentsMatchingQuery(t,e,n).next((t=>(r.forEach((e=>{t=t.insert(e.key,e)})),t))))}))}Ln(t,e){let n=new en(fe(t));return e.forEach(((e,s)=>{de(t,s)&&(n=n.add(s))})),n}Bn(t,e,n,s){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Fn(t,e){return w()<=c.a.DEBUG&&T("QueryEngine","Using full collection scan to execute query:",le(e)),this.Mn.getDocumentsMatchingQuery(t,e,z.min())}}class Ks{constructor(t,e,n,s){this.persistence=t,this.Un=e,this.k=s,this.qn=new Je(rt),this.Kn=new Ds((t=>Lt(t)),Mt),this.jn=z.min(),this.An=t.getMutationQueue(n),this.Qn=t.getRemoteDocumentCache(),this.He=t.getTargetCache(),this.Wn=new Us(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=t.getBundleCache(),this.Un.On(this.Wn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.qn)))}}function $s(t,e,n,s){return new Ks(t,e,n,s)}async function Gs(t,e){const n=D(t);let s=n.An,i=n.Wn;const r=await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.An.getAllMutationBatches(t).next((o=>(r=o,s=n.persistence.getMutationQueue(e),i=new Us(n.Qn,s,n.persistence.getIndexManager()),s.getAllMutationBatches(t)))).next((e=>{const n=[],s=[];let o=ln();for(const t of r){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i.vn(t,o).next((t=>({Gn:t,removedBatchIds:n,addedBatchIds:s})))}))}));return n.An=s,n.Wn=i,n.Un.On(n.Wn),r}function zs(t){const e=D(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.He.getLastRemoteSnapshotVersion(t)))}function Qs(t,e,n,s,i){let r=ln();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=sn();return n.forEach(((n,o)=>{const c=t.get(n),a=(null==i?void 0:i.get(n))||s;o.isNoDocument()&&o.version.isEqual(z.min())?(e.removeEntry(n,a),r=r.insert(n,o)):!c.isValidDocument()||o.version.compareTo(c.version)>0||0===o.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(o,a),r=r.insert(n,o)):T("LocalStore","Ignoring outdated watch update for ",n,". Current version:",c.version," Watch version:",o.version)})),r}))}function Hs(t,e){const n=D(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.An.getNextMutationBatchAfterBatchId(t,e))))}function Ws(t,e){const n=D(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.He.getTargetData(t,e).next((i=>i?(s=i,kr.resolve(s)):n.He.allocateTargetId(t).next((i=>(s=new Br(e,i,0,t.currentSequenceNumber),n.He.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.qn.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.qn=n.qn.insert(t.targetId,t),n.Kn.set(e,t.targetId)),t}))}async function Ys(t,e,n){const s=D(t),i=s.qn.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(t=>s.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!Or(t))throw t;T("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.qn=s.qn.remove(e),s.Kn.delete(i.target)}function Xs(t,e,n){const s=D(t);let i=z.min(),r=ln();return s.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const s=D(t),i=s.Kn.get(n);return void 0!==i?kr.resolve(s.qn.get(i)):s.He.getTargetData(e,n)}(s,t,ae(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.He.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>s.Un.getDocumentsMatchingQuery(t,e,n?i:z.min(),n?r:ln()))).next((t=>({documents:t,zn:r})))))}function Js(t,e){const n=D(t),s=D(n.He),i=n.qn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(t=>s.Et(t,e).next((t=>t?t.target:null))))}function Zs(t){const e=D(t);return e.persistence.runTransaction("Get new document changes","readonly",(t=>function(t,e,n){const s=D(t);let i=sn(),r=Gr(n);const o=Rs(e),c=IDBKeyRange.lowerBound(r,!0);return o.jt({index:mr.readTimeIndex,range:c},((t,e)=>{const n=$r(s.k,e);i=i.insert(n.key,n),r=e.readTime})).next((()=>({In:i,readTime:zr(r)})))}(e.Qn,t,e.jn))).then((({In:t,readTime:n})=>(e.jn=n,t)))}async function ti(t,e,n=ln()){const s=await Ws(t,ae(Jr(e.bundledQuery))),i=D(t);return i.persistence.runTransaction("Save named query","readwrite",(t=>{const r=Cn(e.readTime);if(s.snapshotVersion.compareTo(r)>=0)return i.Ye.saveNamedQuery(t,e);const o=s.withResumeToken(et.EMPTY_BYTE_STRING,r);return i.qn=i.qn.insert(o.targetId,o),i.He.updateTargetData(t,o).next((()=>i.He.removeMatchingKeysForTargetId(t,s.targetId))).next((()=>i.He.addMatchingKeys(t,n,s.targetId))).next((()=>i.Ye.saveNamedQuery(t,e)))}))}class ei{constructor(t){this.k=t,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(t,e){return kr.resolve(this.Xn.get(e))}saveBundleMetadata(t,e){var n;return this.Xn.set(e.id,{id:(n=e).id,version:n.version,createTime:Cn(n.createTime)}),kr.resolve()}getNamedQuery(t,e){return kr.resolve(this.Zn.get(e))}saveNamedQuery(t,e){return this.Zn.set(e.name,function(t){return{name:t.name,query:Jr(t.bundledQuery),readTime:Cn(t.readTime)}}(e)),kr.resolve()}}class ni{constructor(){this.ts=new en(ri.es),this.ns=new en(ri.ss)}isEmpty(){return this.ts.isEmpty()}addReference(t,e){const n=new ri(t,e);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}rs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.os(new ri(t,e))}cs(t,e){t.forEach((t=>this.removeReference(t,e)))}us(t){const e=new gt(new Y([])),n=new ri(e,t),s=new ri(e,t+1),i=[];return this.ns.forEachInRange([n,s],(t=>{this.os(t),i.push(t.key)})),i}hs(){this.ts.forEach((t=>this.os(t)))}os(t){this.ts=this.ts.delete(t),this.ns=this.ns.delete(t)}ls(t){const e=new gt(new Y([])),n=new ri(e,t),s=new ri(e,t+1);let i=ln();return this.ns.forEachInRange([n,s],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new ri(t,0),n=this.ts.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class ri{constructor(t,e){this.key=t,this.fs=e}static es(t,e){return gt.comparator(t.key,e.key)||rt(t.fs,e.fs)}static ss(t,e){return rt(t.fs,e.fs)||gt.comparator(t.key,e.key)}}class si{constructor(t,e){this.Jt=t,this.referenceDelegate=e,this.An=[],this.ds=1,this.ws=new en(ri.es)}checkEmpty(t){return kr.resolve(0===this.An.length)}addMutationBatch(t,e,n,s){const i=this.ds;this.ds++,this.An.length>0&&this.An[this.An.length-1];const r=new jr(i,e,n,s);this.An.push(r);for(const e of s)this.ws=this.ws.add(new ri(e.key,i)),this.Jt.addToCollectionParentIndex(t,e.key.path.popLast());return kr.resolve(r)}lookupMutationBatch(t,e){return kr.resolve(this._s(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.gs(n),i=s<0?0:s;return kr.resolve(this.An.length>i?this.An[i]:null)}getHighestUnacknowledgedBatchId(){return kr.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(t){return kr.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new ri(e,0),s=new ri(e,Number.POSITIVE_INFINITY),i=[];return this.ws.forEachInRange([n,s],(t=>{const e=this._s(t.fs);i.push(e)})),kr.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new en(rt);return e.forEach((t=>{const e=new ri(t,0),s=new ri(t,Number.POSITIVE_INFINITY);this.ws.forEachInRange([e,s],(t=>{n=n.add(t.fs)}))})),kr.resolve(this.ys(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;gt.isDocumentKey(i)||(i=i.child(""));const r=new ri(new gt(i),0);let o=new en(rt);return this.ws.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.fs)),!0)}),r),kr.resolve(this.ys(o))}ys(t){const e=[];return t.forEach((t=>{const n=this._s(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){A(0===this.ps(e.batchId,"removed")),this.An.shift();let n=this.ws;return kr.forEach(e.mutations,(s=>{const i=new ri(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.ws=n}))}ee(t){}containsKey(t,e){const n=new ri(e,0),s=this.ws.firstAfterOrEqual(n);return kr.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.An.length,kr.resolve()}ps(t,e){return this.gs(t)}gs(t){return 0===this.An.length?0:t-this.An[0].batchId}_s(t){const e=this.gs(t);return e<0||e>=this.An.length?null:this.An[e]}}class ii{constructor(t,e){this.Jt=t,this.Ts=e,this.docs=new Je(gt.comparator),this.size=0}addEntry(t,e,n){const s=e.key,i=this.docs.get(s),r=i?i.size:0,o=this.Ts(e);return this.docs=this.docs.insert(s,{document:e.mutableCopy(),size:o,readTime:n}),this.size+=o-r,this.Jt.addToCollectionParentIndex(t,s.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return kr.resolve(n?n.document.mutableCopy():xt.newInvalidDocument(e))}getEntries(t,e){let n=sn();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():xt.newInvalidDocument(t))})),kr.resolve(n)}getDocumentsMatchingQuery(t,e,n){let s=sn();const i=new gt(e.path.child("")),r=this.docs.getIteratorFrom(i);for(;r.hasNext();){const{key:t,value:{document:i,readTime:o}}=r.getNext();if(!e.path.isPrefixOf(t.path))break;o.compareTo(n)<=0||de(e,i)&&(s=s.insert(i.key,i.mutableCopy()))}return kr.resolve(s)}Es(t,e){return kr.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new oi(this)}getSize(t){return kr.resolve(this.size)}}class oi extends ks{constructor(t){super(),this.De=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.document.isValidDocument()?e.push(this.De.addEntry(t,s.document,this.getReadTime(n))):this.De.removeEntry(n)})),kr.waitFor(e)}getFromCache(t,e){return this.De.getEntry(t,e)}getAllFromCache(t,e){return this.De.getEntries(t,e)}}class ai{constructor(t){this.persistence=t,this.Is=new Ds((t=>Lt(t)),Mt),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.As=0,this.Rs=new ni,this.targetCount=0,this.bs=ms.ie()}forEachTarget(t,e){return this.Is.forEach(((t,n)=>e(n))),kr.resolve()}getLastRemoteSnapshotVersion(t){return kr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return kr.resolve(this.As)}allocateTargetId(t){return this.highestTargetId=this.bs.next(),kr.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.As&&(this.As=e),kr.resolve()}ae(t){this.Is.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.bs=new ms(e),this.highestTargetId=e),t.sequenceNumber>this.As&&(this.As=t.sequenceNumber)}addTargetData(t,e){return this.ae(e),this.targetCount+=1,kr.resolve()}updateTargetData(t,e){return this.ae(e),kr.resolve()}removeTargetData(t,e){return this.Is.delete(e.target),this.Rs.us(e.targetId),this.targetCount-=1,kr.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.Is.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Is.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),kr.waitFor(i).next((()=>s))}getTargetCount(t){return kr.resolve(this.targetCount)}getTargetData(t,e){const n=this.Is.get(e)||null;return kr.resolve(n)}addMatchingKeys(t,e,n){return this.Rs.rs(e,n),kr.resolve()}removeMatchingKeys(t,e,n){this.Rs.cs(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((e=>{i.push(s.markPotentiallyOrphaned(t,e))})),kr.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Rs.us(e),kr.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Rs.ls(e);return kr.resolve(n)}containsKey(t,e){return kr.resolve(this.Rs.containsKey(e))}}class ci{constructor(t,e){this.Ps={},this.Be=new j(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=t(this),this.He=new ai(this),this.Jt=new ns,this.Je=function(t,e){return new ii(t,e)}(this.Jt,(t=>this.referenceDelegate.vs(t))),this.k=new Kr(e),this.Ye=new ei(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(t){let e=this.Ps[t.toKey()];return e||(e=new si(this.Jt,this.referenceDelegate),this.Ps[t.toKey()]=e),e}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(t,e,n){T("MemoryPersistence","Starting transaction:",t);const s=new ui(this.Be.next());return this.referenceDelegate.Vs(),n(s).next((t=>this.referenceDelegate.Ss(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}Ds(t,e){return kr.or(Object.values(this.Ps).map((n=>()=>n.containsKey(t,e))))}}class ui extends Dr{constructor(t){super(),this.currentSequenceNumber=t}}class hi{constructor(t){this.persistence=t,this.Cs=new ni,this.Ns=null}static ks(t){return new hi(t)}get xs(){if(this.Ns)return this.Ns;throw S()}addReference(t,e,n){return this.Cs.addReference(n,e),this.xs.delete(n.toString()),kr.resolve()}removeReference(t,e,n){return this.Cs.removeReference(n,e),this.xs.add(n.toString()),kr.resolve()}markPotentiallyOrphaned(t,e){return this.xs.add(e.toString()),kr.resolve()}removeTarget(t,e){this.Cs.us(e.targetId).forEach((t=>this.xs.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.xs.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Vs(){this.Ns=new Set}Ss(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return kr.forEach(this.xs,(n=>{const s=gt.fromPath(n);return this.$s(t,s).next((t=>{t||e.removeEntry(s)}))})).next((()=>(this.Ns=null,e.apply(t))))}updateLimboDocument(t,e){return this.$s(t,e).next((t=>{t?this.xs.delete(e.toString()):this.xs.add(e.toString())}))}vs(t){return 0}$s(t,e){return kr.or([()=>kr.resolve(this.Cs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ds(t,e)])}}function di(t,e){return`firestore_clients_${t}_${e}`}function fi(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}function gi(t,e){return`firestore_targets_${t}_${e}`}class mi{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Os(t,e,n){const s=JSON.parse(n);let i,r="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return r&&s.error&&(r="string"==typeof s.error.message&&"string"==typeof s.error.code,r&&(i=new C(s.error.code,s.error.message))),r?new mi(t,e,s.state,i):(I("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Ms(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class pi{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Os(t,e){const n=JSON.parse(e);let s,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(s=new C(n.error.code,n.error.message))),i?new pi(t,n.state,s):(I("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Ms(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class yi{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Os(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=fn();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=ft(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new yi(t,i):(I("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class wi{constructor(t,e){this.clientId=t,this.onlineState=e}static Os(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new wi(e.clientId,e.onlineState):(I("SharedClientState",`Failed to parse online state: ${t}`),null)}}class vi{constructor(){this.activeTargetIds=fn()}Fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ls(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ms(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class bi{constructor(t,e,n,s,i){this.window=t,this.Me=e,this.persistenceKey=n,this.Bs=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Us=this.qs.bind(this),this.Ks=new Je(rt),this.started=!1,this.js=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Qs=di(this.persistenceKey,this.Bs),this.Ws=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.Ks=this.Ks.insert(this.Bs,new vi),this.Gs=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.zs=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.Hs=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.Js=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.Ys=function(t){return`firestore_bundle_loaded_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.Us)}static Pt(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.Tn();for(const e of t){if(e===this.Bs)continue;const t=this.getItem(di(this.persistenceKey,e));if(t){const n=yi.Os(e,t);n&&(this.Ks=this.Ks.insert(n.clientId,n))}}this.Xs();const e=this.storage.getItem(this.Js);if(e){const t=this.Zs(e);t&&this.ti(t)}for(const t of this.js)this.qs(t);this.js=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.Ws,JSON.stringify(t))}getAllActiveQueryTargets(){return this.ei(this.Ks)}isActiveQueryTarget(t){let e=!1;return this.Ks.forEach(((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.ni(t,"pending")}updateMutationState(t,e,n){this.ni(t,e,n),this.si(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(gi(this.persistenceKey,t));if(n){const s=pi.Os(t,n);s&&(e=s.state)}}return this.ii.Fs(t),this.Xs(),e}removeLocalQueryTarget(t){this.ii.Ls(t),this.Xs()}isLocalQueryTarget(t){return this.ii.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(gi(this.persistenceKey,t))}updateQueryState(t,e,n){this.ri(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.si(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.oi(t)}notifyBundleLoaded(){this.ci()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Us),this.removeItem(this.Qs),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return T("SharedClientState","READ",t,e),e}setItem(t,e){T("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){T("SharedClientState","REMOVE",t),this.storage.removeItem(t)}qs(t){const e=t;if(e.storageArea===this.storage){if(T("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Qs)return void I("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Me.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this.Gs.test(e.key)){if(null==e.newValue){const t=this.ai(e.key);return this.ui(t,null)}{const t=this.hi(e.key,e.newValue);if(t)return this.ui(t.clientId,t)}}else if(this.zs.test(e.key)){if(null!==e.newValue){const t=this.li(e.key,e.newValue);if(t)return this.fi(t)}}else if(this.Hs.test(e.key)){if(null!==e.newValue){const t=this.di(e.key,e.newValue);if(t)return this.wi(t)}}else if(e.key===this.Js){if(null!==e.newValue){const t=this.Zs(e.newValue);if(t)return this.ti(t)}}else if(e.key===this.Ws){const t=function(t){let e=j.I;if(null!=t)try{const n=JSON.parse(t);A("number"==typeof n),e=n}catch(t){I("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==j.I&&this.sequenceNumberHandler(t)}else if(e.key===this.Ys)return this.syncEngine._i()}else this.js.push(e)}))}}get ii(){return this.Ks.get(this.Bs)}Xs(){this.setItem(this.Qs,this.ii.Ms())}ni(t,e,n){const s=new mi(this.currentUser,t,e,n),i=fi(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Ms())}si(t){const e=fi(this.persistenceKey,this.currentUser,t);this.removeItem(e)}oi(t){const e={clientId:this.Bs,onlineState:t};this.storage.setItem(this.Js,JSON.stringify(e))}ri(t,e,n){const s=gi(this.persistenceKey,t),i=new pi(t,e,n);this.setItem(s,i.Ms())}ci(){this.setItem(this.Ys,"value-not-used")}ai(t){const e=this.Gs.exec(t);return e?e[1]:null}hi(t,e){const n=this.ai(t);return yi.Os(n,e)}li(t,e){const n=this.zs.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return mi.Os(new f(i),s,e)}di(t,e){const n=this.Hs.exec(t),s=Number(n[1]);return pi.Os(s,e)}Zs(t){return wi.Os(t)}async fi(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.mi(t.batchId,t.state,t.error);T("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}wi(t){return this.syncEngine.gi(t.targetId,t.state,t.error)}ui(t,e){const n=e?this.Ks.insert(t,e):this.Ks.remove(t),s=this.ei(this.Ks),i=this.ei(n),r=[],o=[];return i.forEach((t=>{s.has(t)||r.push(t)})),s.forEach((t=>{i.has(t)||o.push(t)})),this.syncEngine.yi(r,o).then((()=>{this.Ks=n}))}ti(t){this.Ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}ei(t){let e=fn();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class Ti{constructor(){this.pi=new vi,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.pi.Fs(t),this.Ti[t]||"not-current"}updateQueryState(t,e,n){this.Ti[t]=e}removeLocalQueryTarget(t){this.pi.Ls(t)}isLocalQueryTarget(t){return this.pi.activeTargetIds.has(t)}clearQueryState(t){delete this.Ti[t]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(t){return this.pi.activeTargetIds.has(t)}start(){return this.pi=new vi,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}class Ii{Ei(t){}shutdown(){}}class Ei{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.bi(),this.Pi=[],this.vi()}Ei(t){this.Pi.push(t)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){T("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Pi)t(0)}bi(){T("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Pi)t(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const _i={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Si{constructor(t){this.Vi=t.Vi,this.Si=t.Si}Di(t){this.Ci=t}Ni(t){this.ki=t}onMessage(t){this.xi=t}close(){this.Si()}send(t){this.Vi(t)}$i(){this.Ci()}Oi(t){this.ki(t)}Mi(t){this.xi(t)}}class Ai extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.Fi=e+"://"+t.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(t,e,n,s,i){const r=this.Ui(t,e);T("RestConnection","Sending: ",r,n);const o={};return this.qi(o,s,i),this.Ki(t,r,o,n).then((t=>(T("RestConnection","Received: ",t),t)),(e=>{throw E("RestConnection",`${t} failed with error: `,e,"url: ",r,"request:",n),e}))}ji(t,e,n,s,i){return this.Bi(t,e,n,s,i)}qi(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+m,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}Ui(t,e){const n=_i[t];return`${this.Fi}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}Ki(t,e,n,s){return new Promise(((i,r)=>{const o=new l.g;o.listenOnce(l.c.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case l.a.NO_ERROR:const e=o.getResponseJson();T("Connection","XHR received:",JSON.stringify(e)),i(e);break;case l.a.TIMEOUT:T("Connection",'RPC "'+t+'" timed out'),r(new C(k.DEADLINE_EXCEEDED,"Request time out"));break;case l.a.HTTP_ERROR:const n=o.getStatus();if(T("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(k).indexOf(e)>=0?e:k.UNKNOWN}(t.status);r(new C(e,t.message))}else r(new C(k.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new C(k.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{T("Connection",'RPC "'+t+'" completed.')}}));const c=JSON.stringify(s);o.send(e,"POST",c,n,15)}))}Qi(t,e,n){const s=[this.Fi,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Object(l.h)(),r=Object(l.i)(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new l.d({})),this.qi(o.initMessageHeaders,e,n),Object(h.p)()||Object(h.q)()||Object(h.m)()||Object(h.n)()||Object(h.s)()||Object(h.l)()||(o.httpHeadersOverwriteParam="$httpHeaders");const c=s.join("");T("Connection","Creating WebChannel: "+c,o);const a=i.createWebChannel(c,o);let u=!1,d=!1;const f=new Si({Vi:t=>{d?T("Connection","Not sending because WebChannel is closed:",t):(u||(T("Connection","Opening WebChannel transport."),a.open(),u=!0),T("Connection","WebChannel sending:",t),a.send(t))},Si:()=>a.close()}),m=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return m(a,l.f.EventType.OPEN,(()=>{d||T("Connection","WebChannel transport opened.")})),m(a,l.f.EventType.CLOSE,(()=>{d||(d=!0,T("Connection","WebChannel transport closed"),f.Oi())})),m(a,l.f.EventType.ERROR,(t=>{d||(d=!0,E("Connection","WebChannel transport errored:",t),f.Oi(new C(k.UNAVAILABLE,"The operation could not be completed")))})),m(a,l.f.EventType.MESSAGE,(t=>{var e;if(!d){const n=t.data[0];A(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){T("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=He[t];if(void 0!==e)return Xe(e)}(t),n=i.message;void 0===e&&(e=k.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),d=!0,f.Oi(new C(e,n)),a.close()}else T("Connection","WebChannel received:",n),f.Mi(n)}})),m(r,l.b.STAT_EVENT,(t=>{t.stat===l.e.PROXY?T("Connection","Detected buffering proxy"):t.stat===l.e.NOPROXY&&T("Connection","Detected no buffering proxy")})),setTimeout((()=>{f.$i()}),0),f}}function Di(){return"undefined"!=typeof window?window:null}function ki(){return"undefined"!=typeof document?document:null}function Ci(t){return new Sn(t,!0)}class Ni{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Me=t,this.timerId=e,this.Wi=n,this.Gi=s,this.zi=i,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(t){this.cancel();const e=Math.floor(this.Hi+this.tr()),n=Math.max(0,Date.now()-this.Yi),s=Math.max(0,e-n);s>0&&T("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Hi} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Ji=this.Me.enqueueAfterDelay(this.timerId,s,(()=>(this.Yi=Date.now(),t()))),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class xi{constructor(t,e,n,s,i,r,o,c){this.Me=t,this.nr=n,this.sr=s,this.ir=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=c,this.state=0,this.rr=0,this.cr=null,this.ar=null,this.stream=null,this.ur=new Ni(t,e)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}async stop(){this.hr()&&await this.close(0)}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.cr&&(this.cr=this.Me.enqueueAfterDelay(this.nr,6e4,(()=>this.mr())))}gr(t){this.yr(),this.stream.send(t)}async mr(){if(this.lr())return this.close(0)}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}pr(){this.ar&&(this.ar.cancel(),this.ar=null)}async close(t,e){this.yr(),this.pr(),this.ur.cancel(),this.rr++,4!==t?this.ur.reset():e&&e.code===k.RESOURCE_EXHAUSTED?(I(e.toString()),I("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):e&&e.code===k.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Tr(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Ni(e)}Tr(){}auth(){this.state=1;const t=this.Er(this.rr),e=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.rr===e&&this.Ir(t,n)}),(e=>{t((()=>{const t=new C(k.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Ar(t)}))}))}Ir(t,e){const n=this.Er(this.rr);this.stream=this.Rr(t,e),this.stream.Di((()=>{n((()=>(this.state=2,this.ar=this.Me.enqueueAfterDelay(this.sr,1e4,(()=>(this.lr()&&(this.state=3),Promise.resolve()))),this.listener.Di())))})),this.stream.Ni((t=>{n((()=>this.Ar(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}dr(){this.state=5,this.ur.Zi((async()=>{this.state=0,this.start()}))}Ar(t){return T("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Er(t){return e=>{this.Me.enqueueAndForget((()=>this.rr===t?e():(T("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ri extends xi{constructor(t,e,n,s,i,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,r),this.k=i}Rr(t,e){return this.ir.Qi("Listen",t,e)}onMessage(t){this.ur.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:S()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.C?(A(void 0===e||"string"==typeof e),et.fromBase64String(e||"")):(A(void 0===e||e instanceof Uint8Array),et.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(t){const e=void 0===t.code?k.UNKNOWN:Xe(t.code);return new C(e,t.message||"")}(o);n=new wn(s,i,r,c||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=On(t,s.document.name),r=Cn(s.document.updateTime),o=new Ct({mapValue:{fields:s.document.fields}}),c=xt.newFoundDocument(i,r,o),a=s.targetIds||[],u=s.removedTargetIds||[];n=new pn(a,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=On(t,s.document),r=s.readTime?Cn(s.readTime):z.min(),o=xt.newNoDocument(i,r),c=s.removedTargetIds||[];n=new pn([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=On(t,s.document),r=s.removedTargetIds||[];n=new pn([],r,i,null)}else{if(!("filter"in e))return S();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new Qe(s),r=t.targetId;n=new yn(r,i)}}return n}(this.k,t),n=function(t){if(!("targetChange"in t))return z.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?z.min():e.readTime?Cn(e.readTime):z.min()}(t);return this.listener.br(e,n)}Pr(t){const e={};e.database=Pn(this.k),e.addTarget=function(t,e){let n;const s=e.target;return n=Pt(s)?{documents:Bn(t,s)}:{query:Kn(t,s)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Dn(t,e.resumeToken):e.snapshotVersion.compareTo(z.min())>0&&(n.readTime=An(t,e.snapshotVersion.toTimestamp())),n}(this.k,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return S()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.k,t);n&&(e.labels=n),this.gr(e)}vr(t){const e={};e.database=Pn(this.k),e.removeTarget=t,this.gr(e)}}class Oi extends xi{constructor(t,e,n,s,i,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,r),this.k=i,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(t,e){return this.ir.Qi("Write",t,e)}onMessage(t){if(A(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Vr){this.ur.reset();const e=function(t,e){return t&&t.length>0?(A(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Cn(t.updateTime):Cn(e);return n.isEqual(z.min())&&(n=Cn(e)),new xe(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Cn(t.commitTime);return this.listener.Cr(n,e)}return A(!t.writeResults||0===t.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const t={};t.database=Pn(this.k),this.gr(t)}Dr(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>jn(this.k,t)))};this.gr(e)}}class Li extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.ir=n,this.k=s,this.$r=!1}Or(){if(this.$r)throw new C(k.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(t,e,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.ir.Bi(t,e,n,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new C(k.UNKNOWN,t.toString())}))}ji(t,e,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.ir.ji(t,e,n,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new C(k.UNKNOWN,t.toString())}))}terminate(){this.$r=!0}}class Mi{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.Mr=0,this.Fr=null,this.Lr=!0}Br(){0===this.Mr&&(this.Ur("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.Fr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve()))))}Kr(t){"Online"===this.state?this.Ur("Unknown"):(this.Mr++,this.Mr>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.Ur("Offline")))}set(t){this.jr(),this.Mr=0,"Online"===t&&(this.Lr=!1),this.Ur(t)}Ur(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}qr(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(I(e),this.Lr=!1):T("OnlineStateTracker",e)}jr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class Pi{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=i,this.Hr.Ei((t=>{n.enqueueAndForget((async()=>{Gi(this)&&(T("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=D(t);e.Gr.add(4),await Vi(e),e.Jr.set("Unknown"),e.Gr.delete(4),await Fi(e)}(this))}))})),this.Jr=new Mi(n,s)}}async function Fi(t){if(Gi(t))for(const e of t.zr)await e(!0)}async function Vi(t){for(const e of t.zr)await e(!1)}function qi(t,e){const n=D(t);n.Wr.has(e.targetId)||(n.Wr.set(e.targetId,e),$i(n)?Ki(n):co(n).lr()&&Ui(n,e))}function ji(t,e){const n=D(t),s=co(n);n.Wr.delete(e),s.lr()&&Bi(n,e),0===n.Wr.size&&(s.lr()?s._r():Gi(n)&&n.Jr.set("Unknown"))}function Ui(t,e){t.Yr.X(e.targetId),co(t).Pr(e)}function Bi(t,e){t.Yr.X(e),co(t).vr(e)}function Ki(t){t.Yr=new bn({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.Wr.get(e)||null}),co(t).start(),t.Jr.Br()}function $i(t){return Gi(t)&&!co(t).hr()&&t.Wr.size>0}function Gi(t){return 0===D(t).Gr.size}function zi(t){t.Yr=void 0}async function Qi(t){t.Wr.forEach(((e,n)=>{Ui(t,e)}))}async function Hi(t,e){zi(t),$i(t)?(t.Jr.Kr(e),Ki(t)):t.Jr.set("Unknown")}async function Wi(t,e,n){if(t.Jr.set("Online"),e instanceof wn&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.Wr.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.Wr.delete(s),t.Yr.removeTarget(s))}(t,e)}catch(n){T("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Yi(t,n)}else if(e instanceof pn?t.Yr.ot(e):e instanceof yn?t.Yr.dt(e):t.Yr.ut(e),!n.isEqual(z.min()))try{const e=await zs(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Yr.gt(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.Wr.get(s);i&&t.Wr.set(s,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.Wr.get(e);if(!n)return;t.Wr.set(e,n.withResumeToken(et.EMPTY_BYTE_STRING,n.snapshotVersion)),Bi(t,e);const s=new Br(n.target,e,1,n.sequenceNumber);Ui(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){T("RemoteStore","Failed to raise snapshot:",e),await Yi(t,e)}}async function Yi(t,e,n){if(!Or(e))throw e;t.Gr.add(1),await Vi(t),t.Jr.set("Offline"),n||(n=()=>zs(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{T("RemoteStore","Retrying IndexedDB access"),await n(),t.Gr.delete(1),await Fi(t)}))}function Xi(t,e){return e().catch((n=>Yi(t,n,e)))}async function Ji(t){const e=D(t),n=uo(e);let s=e.Qr.length>0?e.Qr[e.Qr.length-1].batchId:-1;for(;Zi(e);)try{const t=await Hs(e.localStore,s);if(null===t){0===e.Qr.length&&n._r();break}s=t.batchId,to(e,t)}catch(t){await Yi(e,t)}eo(e)&&no(e)}function Zi(t){return Gi(t)&&t.Qr.length<10}function to(t,e){t.Qr.push(e);const n=uo(t);n.lr()&&n.Sr&&n.Dr(e.mutations)}function eo(t){return Gi(t)&&!uo(t).hr()&&t.Qr.length>0}function no(t){uo(t).start()}async function ro(t){uo(t).kr()}async function so(t){const e=uo(t);for(const n of t.Qr)e.Dr(n.mutations)}async function io(t,e,n){const s=t.Qr.shift(),i=Ur.from(s,e,n);await Xi(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await Ji(t)}async function oo(t,e){e&&uo(t).Sr&&await async function(t,e){if(Ye(n=e.code)&&n!==k.ABORTED){const n=t.Qr.shift();uo(t).wr(),await Xi(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Ji(t)}var n}(t,e),eo(t)&&no(t)}async function ao(t,e){const n=D(t);e?(n.Gr.delete(2),await Fi(n)):e||(n.Gr.add(2),await Vi(n),n.Jr.set("Unknown"))}function co(t){return t.Xr||(t.Xr=function(t,e,n){const s=D(t);return s.Or(),new Ri(e,s.ir,s.authCredentials,s.appCheckCredentials,s.k,n)}(t.datastore,t.asyncQueue,{Di:Qi.bind(null,t),Ni:Hi.bind(null,t),br:Wi.bind(null,t)}),t.zr.push((async e=>{e?(t.Xr.wr(),$i(t)?Ki(t):t.Jr.set("Unknown")):(await t.Xr.stop(),zi(t))}))),t.Xr}function uo(t){return t.Zr||(t.Zr=function(t,e,n){const s=D(t);return s.Or(),new Oi(e,s.ir,s.authCredentials,s.appCheckCredentials,s.k,n)}(t.datastore,t.asyncQueue,{Di:ro.bind(null,t),Ni:oo.bind(null,t),Nr:so.bind(null,t),Cr:io.bind(null,t)}),t.zr.push((async e=>{e?(t.Zr.wr(),await Ji(t)):(await t.Zr.stop(),t.Qr.length>0&&(T("RemoteStore",`Stopping write stream with ${t.Qr.length} pending writes`),t.Qr=[]))}))),t.Zr}class ho{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new N,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n,o=new ho(t,e,r,s,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(k.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function lo(t,e){if(I("AsyncQueue",`${e}: ${t}`),Or(t))return new C(k.UNAVAILABLE,`${e}: ${t}`);throw t}class fo{constructor(t){this.comparator=t?(e,n)=>t(e,n)||gt.comparator(e.key,n.key):(t,e)=>gt.comparator(t.key,e.key),this.keyedMap=an(),this.sortedSet=new Je(this.comparator)}static emptySet(t){return new fo(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof fo))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new fo;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class go{constructor(){this.eo=new Je(gt.comparator)}track(t){const e=t.doc.key,n=this.eo.get(e);n?0!==t.type&&3===n.type?this.eo=this.eo.insert(e,t):3===t.type&&1!==n.type?this.eo=this.eo.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.eo=this.eo.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.eo=this.eo.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.eo=this.eo.remove(e):1===t.type&&2===n.type?this.eo=this.eo.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.eo=this.eo.insert(e,{type:2,doc:t.doc}):S():this.eo=this.eo.insert(e,t)}no(){const t=[];return this.eo.inorderTraversal(((e,n)=>{t.push(n)})),t}}class mo{constructor(t,e,n,s,i,r,o,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=c}static fromInitialDocuments(t,e,n,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new mo(t,e,fo.emptySet(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ue(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class po{constructor(){this.so=void 0,this.listeners=[]}}class yo{constructor(){this.queries=new Ds((t=>he(t)),ue),this.onlineState="Unknown",this.io=new Set}}async function wo(t,e){const n=D(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new po),i)try{r.so=await n.onListen(s)}catch(t){const n=lo(t,`Initialization of query '${le(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.listeners.push(e),e.ro(n.onlineState),r.so&&e.oo(r.so)&&Io(n)}async function vo(t,e){const n=D(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.onUnlisten(s)}function bo(t,e){const n=D(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.oo(t)&&(s=!0);i.so=t}}s&&Io(n)}function To(t,e,n){const s=D(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}function Io(t){t.io.forEach((t=>{t.next()}))}class Eo{constructor(t,e,n){this.query=t,this.co=e,this.ao=!1,this.uo=null,this.onlineState="Unknown",this.options=n||{}}oo(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new mo(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.ao?this.ho(t)&&(this.co.next(t),e=!0):this.lo(t,this.onlineState)&&(this.fo(t),e=!0),this.uo=t,e}onError(t){this.co.error(t)}ro(t){this.onlineState=t;let e=!1;return this.uo&&!this.ao&&this.lo(this.uo,t)&&(this.fo(this.uo),e=!0),e}lo(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.wo&&n||t.docs.isEmpty()&&"Offline"!==e)}ho(t){if(t.docChanges.length>0)return!0;const e=this.uo&&this.uo.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}fo(t){t=mo.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.ao=!0,this.co.next(t)}}class _o{constructor(t,e){this.payload=t,this.byteLength=e}_o(){return"metadata"in this.payload}}class So{constructor(t){this.k=t}Hn(t){return On(this.k,t)}Jn(t){return t.metadata.exists?qn(this.k,t.document,!1):xt.newNoDocument(this.Hn(t.metadata.name),this.Yn(t.metadata.readTime))}Yn(t){return Cn(t)}}class Ao{constructor(t,e,n){this.mo=t,this.localStore=e,this.k=n,this.queries=[],this.documents=[],this.progress=Do(t)}yo(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}po(t){const e=new Map,n=new So(this.k);for(const s of t)if(s.metadata.queries){const t=n.Hn(s.metadata.name);for(const n of s.metadata.queries){const s=(e.get(n)||ln()).add(t);e.set(n,s)}}return e}async complete(){const t=await async function(t,e,n,s){const i=D(t);let r=ln(),o=sn(),c=un();for(const t of n){const n=e.Hn(t.metadata.name);t.document&&(r=r.add(n)),o=o.insert(n,e.Jn(t)),c=c.insert(n,e.Yn(t.metadata.readTime))}const a=i.Qn.newChangeBuffer({trackRemovals:!0}),u=await Ws(i,function(t){return ae(te(Y.fromString(`__bundle__/docs/${t}`)))}(s));return i.persistence.runTransaction("Apply bundle documents","readwrite",(t=>Qs(t,a,o,z.min(),c).next((e=>(a.apply(t),e))).next((e=>i.He.removeMatchingKeysForTargetId(t,u.targetId).next((()=>i.He.addMatchingKeys(t,r,u.targetId))).next((()=>i.Wn.Vn(t,e))).next((()=>e))))))}(this.localStore,new So(this.k),this.documents,this.mo.id),e=this.po(this.documents);for(const t of this.queries)await ti(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",new js(Object.assign({},this.progress),t)}}function Do(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class ko{constructor(t){this.key=t}}class Co{constructor(t){this.key=t}}class No{constructor(t,e){this.query=t,this.To=e,this.Eo=null,this.current=!1,this.Io=ln(),this.mutatedKeys=ln(),this.Ao=fe(t),this.Ro=new fo(this.Ao)}get bo(){return this.To}Po(t,e){const n=e?e.vo:new go,s=e?e.Ro:this.Ro;let i=e?e.mutatedKeys:this.mutatedKeys,r=s,o=!1;const c=ee(this.query)&&s.size===this.query.limit?s.last():null,a=ne(this.query)&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const u=s.get(t),h=de(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Vo(u,h)||(n.track({type:2,doc:h}),f=!0,(c&&this.Ao(h,c)>0||a&&this.Ao(h,a)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(c||a)&&(o=!0)),f&&(h?(r=r.add(h),i=d?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))})),ee(this.query)||ne(this.query))for(;r.size>this.query.limit;){const t=ee(this.query)?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Ro:r,vo:n,Bn:o,mutatedKeys:i}}Vo(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const s=this.Ro;this.Ro=t.Ro,this.mutatedKeys=t.mutatedKeys;const i=t.vo.no();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return n(t)-n(e)}(t.type,e.type)||this.Ao(t.doc,e.doc))),this.So(n);const r=e?this.Do():[],o=0===this.Io.size&&this.current?1:0,c=o!==this.Eo;return this.Eo=o,0!==i.length||c?{snapshot:new mo(this.query,t.Ro,s,i,t.mutatedKeys,0===o,c,!1),Co:r}:{Co:r}}ro(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new go,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(t){return!this.To.has(t)&&!!this.Ro.has(t)&&!this.Ro.get(t).hasLocalMutations}So(t){t&&(t.addedDocuments.forEach((t=>this.To=this.To.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.To=this.To.delete(t))),this.current=t.current)}Do(){if(!this.current)return[];const t=this.Io;this.Io=ln(),this.Ro.forEach((t=>{this.No(t.key)&&(this.Io=this.Io.add(t.key))}));const e=[];return t.forEach((t=>{this.Io.has(t)||e.push(new Co(t))})),this.Io.forEach((n=>{t.has(n)||e.push(new ko(n))})),e}ko(t){this.To=t.zn,this.Io=ln();const e=this.Po(t.documents);return this.applyChanges(e,!0)}xo(){return mo.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class xo{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Ro{constructor(t){this.key=t,this.$o=!1}}class Oo{constructor(t,e,n,s,i,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.Oo={},this.Mo=new Ds((t=>he(t)),ue),this.Fo=new Map,this.Lo=new Set,this.Bo=new Je(gt.comparator),this.Uo=new Map,this.qo=new ni,this.Ko={},this.jo=new Map,this.Qo=ms.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}async function Lo(t,e){const n=oa(t);let s,i;const r=n.Mo.get(e);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.xo();else{const t=await Ws(n.localStore,ae(e)),r=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,i=await Mo(n,e,s,"current"===r),n.isPrimaryClient&&qi(n.remoteStore,t)}return i}async function Mo(t,e,n,s){t.Go=(e,n,s)=>async function(t,e,n,s){let i=e.view.Po(n);i.Bn&&(i=await Xs(t.localStore,e.query,!1).then((({documents:t})=>e.view.Po(t,i))));const r=s&&s.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,r);return zo(t,e.targetId,o.Co),o.snapshot}(t,e,n,s);const i=await Xs(t.localStore,e,!0),r=new No(e,i.zn),o=r.Po(i.documents),c=mn.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState),a=r.applyChanges(o,t.isPrimaryClient,c);zo(t,n,a.Co);const u=new xo(e,n,r);return t.Mo.set(e,u),t.Fo.has(n)?t.Fo.get(n).push(e):t.Fo.set(n,[e]),a.snapshot}async function Po(t,e){const n=D(t),s=n.Mo.get(e),i=n.Fo.get(s.targetId);if(i.length>1)return n.Fo.set(s.targetId,i.filter((t=>!ue(t,e)))),void n.Mo.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Ys(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),ji(n.remoteStore,s.targetId),$o(n,s.targetId)})).catch(bs)):($o(n,s.targetId),await Ys(n.localStore,s.targetId,!0))}async function Fo(t,e){const n=D(t);try{const t=await function(t,e){const n=D(t),s=e.snapshotVersion;let i=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.qn;const o=[];e.targetChanges.forEach(((r,c)=>{const a=i.get(c);if(!a)return;o.push(n.He.removeMatchingKeys(t,r.removedDocuments,c).next((()=>n.He.addMatchingKeys(t,r.addedDocuments,c))));let u=a.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(c)?u=u.withResumeToken(et.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):r.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(r.resumeToken,s)),i=i.insert(c,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,r)&&o.push(n.He.updateTargetData(t,u))}));let c=sn();if(e.documentUpdates.forEach(((s,i)=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(Qs(t,r,e.documentUpdates,s,void 0).next((t=>{c=t}))),!s.isEqual(z.min())){const e=n.He.getLastRemoteSnapshotVersion(t).next((e=>n.He.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return kr.waitFor(o).next((()=>r.apply(t))).next((()=>n.Wn.Vn(t,c))).next((()=>c))})).then((t=>(n.qn=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.Uo.get(e);s&&(A(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.$o=!0:t.modifiedDocuments.size>0?A(s.$o):t.removedDocuments.size>0&&(A(s.$o),s.$o=!1))})),await Wo(n,t,e)}catch(t){await bs(t)}}function Vo(t,e,n){const s=D(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.Mo.forEach(((n,s)=>{const i=s.view.ro(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=D(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.ro(e)&&(s=!0)})),s&&Io(n)}(s.eventManager,e),t.length&&s.Oo.br(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function qo(t,e,n){const s=D(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.Uo.get(e),r=i&&i.key;if(r){let t=new Je(gt.comparator);t=t.insert(r,xt.newNoDocument(r,z.min()));const n=ln().add(r),i=new gn(z.min(),new Map,new en(rt),t,n);await Fo(s,i),s.Bo=s.Bo.remove(r),s.Uo.delete(e),Ho(s)}else await Ys(s.localStore,e,!1).then((()=>$o(s,e,n))).catch(bs)}async function jo(t,e){const n=D(t),s=e.batch.batchId;try{const t=await function(t,e){const n=D(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const s=e.batch.keys(),i=n.Qn.newChangeBuffer({trackRemovals:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=kr.resolve();return r.forEach((t=>{o=o.next((()=>s.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);A(null!==r),e.version.compareTo(r)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&s.addEntry(e,n.commitVersion))}))})),o.next((()=>t.An.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.An.performConsistencyCheck(t))).next((()=>n.Wn.vn(t,s)))}))}(n.localStore,e);Ko(n,s,null),Bo(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Wo(n,t)}catch(t){await bs(t)}}async function Uo(t,e,n){const s=D(t);try{const t=await function(t,e){const n=D(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let s;return n.An.lookupMutationBatch(t,e).next((e=>(A(null!==e),s=e.keys(),n.An.removeMutationBatch(t,e)))).next((()=>n.An.performConsistencyCheck(t))).next((()=>n.Wn.vn(t,s)))}))}(s.localStore,e);Ko(s,e,n),Bo(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await Wo(s,t)}catch(n){await bs(n)}}function Bo(t,e){(t.jo.get(e)||[]).forEach((t=>{t.resolve()})),t.jo.delete(e)}function Ko(t,e,n){const s=D(t);let i=s.Ko[s.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.Ko[s.currentUser.toKey()]=i}}function $o(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.Fo.get(e))t.Mo.delete(s),n&&t.Oo.zo(s,n);t.Fo.delete(e),t.isPrimaryClient&&t.qo.us(e).forEach((e=>{t.qo.containsKey(e)||Go(t,e)}))}function Go(t,e){t.Lo.delete(e.path.canonicalString());const n=t.Bo.get(e);null!==n&&(ji(t.remoteStore,n),t.Bo=t.Bo.remove(e),t.Uo.delete(n),Ho(t))}function zo(t,e,n){for(const s of n)s instanceof ko?(t.qo.addReference(s.key,e),Qo(t,s)):s instanceof Co?(T("SyncEngine","Document no longer in limbo: "+s.key),t.qo.removeReference(s.key,e),t.qo.containsKey(s.key)||Go(t,s.key)):S()}function Qo(t,e){const n=e.key,s=n.path.canonicalString();t.Bo.get(n)||t.Lo.has(s)||(T("SyncEngine","New document in limbo: "+n),t.Lo.add(s),Ho(t))}function Ho(t){for(;t.Lo.size>0&&t.Bo.size<t.maxConcurrentLimboResolutions;){const e=t.Lo.values().next().value;t.Lo.delete(e);const n=new gt(Y.fromString(e)),s=t.Qo.next();t.Uo.set(s,new Ro(n)),t.Bo=t.Bo.insert(n,s),qi(t.remoteStore,new Br(ae(te(n.path)),s,2,j.I))}}async function Wo(t,e,n){const s=D(t),i=[],r=[],o=[];s.Mo.isEmpty()||(s.Mo.forEach(((t,c)=>{o.push(s.Go(c,e,n).then((t=>{if(t){s.isPrimaryClient&&s.sharedClientState.updateQueryState(c.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=hr.$n(c.targetId,t);r.push(e)}})))})),await Promise.all(o),s.Oo.br(i),await async function(t,e){const n=D(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>kr.forEach(e,(e=>kr.forEach(e.kn,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>kr.forEach(e.xn,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!Or(t))throw t;T("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.qn.get(e),s=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(s);n.qn=n.qn.insert(e,i)}}}(s.localStore,r))}async function Yo(t,e){const n=D(t);if(!n.currentUser.isEqual(e)){T("SyncEngine","User change. New user:",e.toKey());const t=await Gs(n.localStore,e);n.currentUser=e,function(t,e){t.jo.forEach((t=>{t.forEach((t=>{t.reject(new C(k.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.jo.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Wo(n,t.Gn)}}function Xo(t,e){const n=D(t),s=n.Uo.get(e);if(s&&s.$o)return ln().add(s.key);{let t=ln();const s=n.Fo.get(e);if(!s)return t;for(const e of s){const s=n.Mo.get(e);t=t.unionWith(s.view.bo)}return t}}async function Jo(t,e){const n=D(t),s=await Xs(n.localStore,e.query,!0),i=e.view.ko(s);return n.isPrimaryClient&&zo(n,e.targetId,i.Co),i}async function Zo(t){const e=D(t);return Zs(e.localStore).then((t=>Wo(e,t)))}async function ta(t,e,n,s){const i=D(t),r=await function(t,e){const n=D(t),s=D(n.An);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>s.Zt(t,e).next((e=>e?n.Wn.vn(t,e):kr.resolve(null)))))}(i.localStore,e);null!==r?("pending"===n?await Ji(i.remoteStore):"acknowledged"===n||"rejected"===n?(Ko(i,e,s||null),Bo(i,e),function(t,e){D(D(t).An).ee(e)}(i.localStore,e)):S(),await Wo(i,r)):T("SyncEngine","Cannot apply mutation batch with id: "+e)}async function ea(t,e,n){const s=D(t),i=[],r=[];for(const t of e){let e;const n=s.Fo.get(t);if(n&&0!==n.length){e=await Ws(s.localStore,ae(n[0]));for(const t of n){const e=s.Mo.get(t),n=await Jo(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await Js(s.localStore,t);e=await Ws(s.localStore,n),await Mo(s,na(n),t,!1)}i.push(e)}return s.Oo.br(r),i}function na(t){return Zt(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function ra(t){const e=D(t);return D(D(e.localStore).persistence).Tn()}async function sa(t,e,n,s){const i=D(t);if(i.Wo)T("SyncEngine","Ignoring unexpected query state notification.");else if(i.Fo.has(e))switch(n){case"current":case"not-current":{const t=await Zs(i.localStore),s=gn.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);await Wo(i,t,s);break}case"rejected":await Ys(i.localStore,e,!0),$o(i,e,s);break;default:S()}}async function ia(t,e,n){const s=oa(t);if(s.Wo){for(const t of e){if(s.Fo.has(t)){T("SyncEngine","Adding an already active target "+t);continue}const e=await Js(s.localStore,t),n=await Ws(s.localStore,e);await Mo(s,na(e),n.targetId,!1),qi(s.remoteStore,n)}for(const t of n)s.Fo.has(t)&&await Ys(s.localStore,t,!1).then((()=>{ji(s.remoteStore,t),$o(s,t)})).catch(bs)}}function oa(t){const e=D(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Fo.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Xo.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=qo.bind(null,e),e.Oo.br=bo.bind(null,e.eventManager),e.Oo.zo=To.bind(null,e.eventManager),e}function aa(t){const e=D(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=jo.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Uo.bind(null,e),e}class ca{constructor(){this.synchronizeTabs=!1}async initialize(t){this.k=Ci(t.databaseInfo.databaseId),this.sharedClientState=this.Jo(t),this.persistence=this.Yo(t),await this.persistence.start(),this.gcScheduler=this.Xo(t),this.localStore=this.Zo(t)}Xo(t){return null}Zo(t){return $s(this.persistence,new Bs,t.initialUser,this.k)}Yo(t){return new ci(hi.ks,this.k)}Jo(t){return new Ti}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class ua extends ca{constructor(t,e,n){super(),this.tc=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=D(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",(t=>function(t){const e=Rs(t);let n=z.min();return e.jt({index:mr.readTimeIndex,reverse:!0},((t,e,s)=>{e.readTime&&(n=zr(e.readTime)),s.done()})).next((()=>n))}(t))).then((t=>{e.jn=t}))}(this.localStore),await this.tc.initialize(this,t),await aa(this.tc.syncEngine),await Ji(this.tc.remoteStore),await this.persistence.sn((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve())))}Zo(t){return $s(this.persistence,new Bs,t.initialUser,this.k)}Xo(t){const e=this.persistence.referenceDelegate.garbageCollector;return new Es(e,t.asyncQueue)}Yo(t){const e=qs(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?as.withCacheSize(this.cacheSizeBytes):as.DEFAULT;return new Ps(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Di(),ki(),this.k,this.sharedClientState,!!this.forceOwnership)}Jo(t){return new Ti}}class ha extends ua{constructor(t,e){super(t,e,!1),this.tc=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.tc.syncEngine;this.sharedClientState instanceof bi&&(this.sharedClientState.syncEngine={mi:ta.bind(null,e),gi:sa.bind(null,e),yi:ia.bind(null,e),Tn:ra.bind(null,e),_i:Zo.bind(null,e)},await this.sharedClientState.start()),await this.persistence.sn((async t=>{await async function(t,e){const n=D(t);if(oa(n),aa(n),!0===e&&!0!==n.Wo){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await ea(n,t.toArray());n.Wo=!0,await ao(n.remoteStore,!0);for(const t of e)qi(n.remoteStore,t)}else if(!1===e&&!1!==n.Wo){const t=[];let e=Promise.resolve();n.Fo.forEach(((s,i)=>{n.sharedClientState.isLocalQueryTarget(i)?t.push(i):e=e.then((()=>($o(n,i),Ys(n.localStore,i,!0)))),ji(n.remoteStore,i)})),await e,await ea(n,t),function(t){const e=D(t);e.Uo.forEach(((t,n)=>{ji(e.remoteStore,n)})),e.qo.hs(),e.Uo=new Map,e.Bo=new Je(gt.comparator)}(n),n.Wo=!1,await ao(n.remoteStore,!1)}}(this.tc.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop())}))}Jo(t){const e=Di();if(!bi.Pt(e))throw new C(k.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=qs(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new bi(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class la{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Vo(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Yo.bind(null,this.syncEngine),await ao(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new yo}createDatastore(t){const e=Ci(t.databaseInfo.databaseId),n=(s=t.databaseInfo,new Ai(s));var s;return function(t,e,n,s){return new Li(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,s=t.asyncQueue,i=t=>Vo(this.syncEngine,t,0),r=Ei.Pt()?new Ei:new Ii,new Pi(e,n,s,i,r);var e,n,s,i,r}createSyncEngine(t,e){return function(t,e,n,s,i,r,o){const c=new Oo(t,e,n,s,i,r);return o&&(c.Wo=!0),c}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=D(t);T("RemoteStore","RemoteStore shutting down."),e.Gr.add(5),await Vi(e),e.Hr.shutdown(),e.Jr.set("Unknown")}(this.remoteStore)}}function da(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const s={value:t.slice(n,n+e),done:!1};return n+=e,s}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class fa{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.ec(this.observer.next,t)}error(t){this.observer.error?this.ec(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}nc(){this.muted=!0}ec(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class ga{constructor(t,e){this.sc=t,this.k=e,this.metadata=new N,this.buffer=new Uint8Array,this.ic=new TextDecoder("utf-8"),this.rc().then((t=>{t&&t._o()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))}),(t=>this.metadata.reject(t)))}close(){return this.sc.cancel()}async getMetadata(){return this.metadata.promise}async Ho(){return await this.getMetadata(),this.rc()}async rc(){const t=await this.oc();if(null===t)return null;const e=this.ic.decode(t),n=Number(e);isNaN(n)&&this.cc(`length string (${e}) is not valid number`);const s=await this.ac(n);return new _o(JSON.parse(s),t.length+n)}uc(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async oc(){for(;this.uc()<0&&!await this.hc(););if(0===this.buffer.length)return null;const t=this.uc();t<0&&this.cc("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async ac(t){for(;this.buffer.length<t;)await this.hc()&&this.cc("Reached the end of bundle when more is expected.");const e=this.ic.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}cc(t){throw this.sc.cancel(),new Error(`Invalid bundle format: ${t}`)}async hc(){const t=await this.sc.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class ma{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new C(k.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=D(t),s=Pn(n.k)+"/documents",i={documents:e.map((t=>Rn(n.k,t)))},r=await n.ji("BatchGetDocuments",s,i),o=new Map;r.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){A(!!e.found),e.found.name,e.found.updateTime;const n=On(t,e.found.name),s=Cn(e.found.updateTime),i=new Ct({mapValue:{fields:e.found.fields}});return xt.newFoundDocument(n,s,i)}(t,e):"missing"in e?function(t,e){A(!!e.missing),A(!!e.readTime);const n=On(t,e.missing),s=Cn(e.readTime);return xt.newNoDocument(n,s)}(t,e):S()}(n.k,t);o.set(e.key.toString(),e)}));const c=[];return e.forEach((t=>{const e=o.get(t.toString());A(!!e),c.push(e)})),c}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new Ge(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=gt.fromPath(e);this.mutations.push(new ze(n,this.precondition(n)))})),await async function(t,e){const n=D(t),s=Pn(n.k)+"/documents",i={writes:e.map((t=>jn(n.k,t)))};await n.Bi("Commit",s,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw S();e=z.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new C(k.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Re.updateTime(e):Re.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(z.min()))throw new C(k.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Re.updateTime(e)}return Re.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class pa{constructor(t,e,n,s){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=s,this.lc=5,this.ur=new Ni(this.asyncQueue,"transaction_retry")}run(){this.lc-=1,this.fc()}fc(){this.ur.Zi((async()=>{const t=new ma(this.datastore),e=this.dc(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.wc(t)}))))})).catch((t=>{this.wc(t)}))}))}dc(t){try{const e=this.updateFunction(t);return!ht(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}wc(t){this.lc>0&&this._c(t)?(this.lc-=1,this.asyncQueue.enqueueAndForget((()=>(this.fc(),Promise.resolve())))):this.deferred.reject(t)}_c(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!Ye(e)}return!1}}class ya{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=f.UNAUTHENTICATED,this.clientId=B.A(),this.authCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{T("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(()=>Promise.resolve()))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new C(k.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new N;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=lo(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function wa(t,e){t.asyncQueue.verifyOperationInProgress(),T("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await Gs(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function va(t,e){t.asyncQueue.verifyOperationInProgress();const n=await ba(t);T("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener((t=>async function(t,e){const n=D(t);n.asyncQueue.verifyOperationInProgress(),T("RemoteStore","RemoteStore received new credentials");const s=Gi(n);n.Gr.add(3),await Vi(n),s&&n.Jr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Gr.delete(3),await Fi(n)}(e.remoteStore,t))),t.onlineComponents=e}async function ba(t){return t.offlineComponents||(T("FirestoreClient","Using default OfflineComponentProvider"),await wa(t,new ca)),t.offlineComponents}async function Ta(t){return t.onlineComponents||(T("FirestoreClient","Using default OnlineComponentProvider"),await va(t,new la)),t.onlineComponents}function Ia(t){return ba(t).then((t=>t.persistence))}function Ea(t){return ba(t).then((t=>t.localStore))}function _a(t){return Ta(t).then((t=>t.remoteStore))}function Sa(t){return Ta(t).then((t=>t.syncEngine))}async function Aa(t){const e=await Ta(t),n=e.eventManager;return n.onListen=Lo.bind(null,e.syncEngine),n.onUnlisten=Po.bind(null,e.syncEngine),n}function Da(t,e,n={}){const s=new N;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new fa({next:r=>{e.enqueueAndForget((()=>vo(t,o)));const c=r.docs.has(n);!c&&r.fromCache?i.reject(new C(k.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&r.fromCache&&s&&"server"===s.source?i.reject(new C(k.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new Eo(te(n.path),r,{includeMetadataChanges:!0,wo:!0});return wo(t,o)}(await Aa(t),t.asyncQueue,e,n,s))),s.promise}function ka(t,e,n={}){const s=new N;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new fa({next:n=>{e.enqueueAndForget((()=>vo(t,o))),n.fromCache&&"server"===s.source?i.reject(new C(k.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Eo(n,r,{includeMetadataChanges:!0,wo:!0});return wo(t,o)}(await Aa(t),t.asyncQueue,e,n,s))),s.promise}function Ca(t,e,n,s){const i=function(t,e){let n;return n="string"==typeof t?(new TextEncoder).encode(t):t,function(t,e){return new ga(t,e)}(function(t,e){if(t instanceof Uint8Array)return da(t,e);if(t instanceof ArrayBuffer)return da(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,Ci(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const s=D(t);(async function(t,e,n){try{const s=await e.getMetadata();if(await function(t,e){const n=D(t),s=Cn(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.Ye.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(s)>=0))}(t.localStore,s))return await e.close(),void n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(s));n._updateProgress(Do(s));const i=new Ao(s,t.localStore,e.k);let r=await e.Ho();for(;r;){const t=await i.yo(r);t&&n._updateProgress(t),r=await e.Ho()}const o=await i.complete();await Wo(t,o.In,void 0),await function(t,e){const n=D(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.Ye.saveBundleMetadata(t,e)))}(t.localStore,s),n._completeWith(o.progress)}catch(t){E("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t)}})(s,e,n).then((()=>{s.sharedClientState.notifyBundleLoaded()}))}(await Sa(t),i,s)}))}class Na{constructor(t,e,n,s,i,r,o,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=c}}class xa{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof xa&&t.projectId===this.projectId&&t.database===this.database}}const Ra=new Map;function Oa(t,e,n){if(!n)throw new C(k.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function La(t,e,n,s){if(!0===e&&!0===s)throw new C(k.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Ma(t){if(!gt.isDocumentKey(t))throw new C(k.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Pa(t){if(gt.isDocumentKey(t))throw new C(k.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Fa(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":S()}function Va(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new C(k.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Fa(t);throw new C(k.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function qa(t,e){if(e<=0)throw new C(k.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class ja{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new C(k.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new C(k.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,La("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Ua{constructor(t,e,n){this._authCredentials=e,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ja({}),this._settingsFrozen=!1,t instanceof xa?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new C(k.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xa(t.options.projectId)}(t))}get app(){if(!this._app)throw new C(k.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new C(k.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ja(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new R;switch(t.type){case"gapi":const e=t.client;return A(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new P(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new C(k.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Ra.get(t);e&&(T("ComponentProvider","Removing Datastore"),Ra.delete(t),e.terminate())}(this),Promise.resolve()}}function Ba(t,e,n,s={}){var i;const r=(t=Va(t,Ua))._getSettings();if("firestore.googleapis.com"!==r.host&&r.host!==e&&E("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:`${e}:${n}`,ssl:!1})),s.mockUserToken){let e,n;if("string"==typeof s.mockUserToken)e=s.mockUserToken,n=f.MOCK_USER;else{e=Object(h.e)(s.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new C(k.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new f(r)}t._authCredentials=new O(new x(e,n))}}class Ka{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ga(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Ka(this.firestore,t,this._key)}}class $a{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new $a(this.firestore,t,this._query)}}class Ga extends $a{constructor(t,e,n){super(t,e,te(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Ka(this.firestore,null,new gt(t))}withConverter(t){return new Ga(this.firestore,t,this._path)}}function za(t,e,...n){if(t=Object(h.i)(t),Oa("collection","path",e),t instanceof Ua){const s=Y.fromString(e,...n);return Pa(s),new Ga(t,null,s)}{if(!(t instanceof Ka||t instanceof Ga))throw new C(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Y.fromString(e,...n));return Pa(s),new Ga(t.firestore,null,s)}}function Qa(t,e){if(t=Va(t,Ua),Oa("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new C(k.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new $a(t,null,function(t){return new Jt(Y.emptyPath(),t)}(e))}function Ha(t,e,...n){if(t=Object(h.i)(t),1===arguments.length&&(e=B.A()),Oa("doc","path",e),t instanceof Ua){const s=Y.fromString(e,...n);return Ma(s),new Ka(t,null,new gt(s))}{if(!(t instanceof Ka||t instanceof Ga))throw new C(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Y.fromString(e,...n));return Ma(s),new Ka(t.firestore,t instanceof Ga?t.converter:null,new gt(s))}}function Wa(t,e){return t=Object(h.i)(t),e=Object(h.i)(e),(t instanceof Ka||t instanceof Ga)&&(e instanceof Ka||e instanceof Ga)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Ya(t,e){return t=Object(h.i)(t),e=Object(h.i)(e),t instanceof $a&&e instanceof $a&&t.firestore===e.firestore&&ue(t._query,e._query)&&t.converter===e.converter}class Xa{constructor(){this.mc=Promise.resolve(),this.gc=[],this.yc=!1,this.Tc=[],this.Ec=null,this.Ic=!1,this.Ac=!1,this.Rc=[],this.ur=new Ni(this,"async_queue_retry"),this.bc=()=>{const t=ki();t&&T("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ur.er()};const t=ki();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.bc)}get isShuttingDown(){return this.yc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pc(),this.vc(t)}enterRestrictedMode(t){if(!this.yc){this.yc=!0,this.Ac=t||!1;const e=ki();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.bc)}}enqueue(t){if(this.Pc(),this.yc)return new Promise((()=>{}));const e=new N;return this.vc((()=>this.yc&&this.Ac?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.gc.push(t),this.Vc())))}async Vc(){if(0!==this.gc.length){try{await this.gc[0](),this.gc.shift(),this.ur.reset()}catch(t){if(!Or(t))throw t;T("AsyncQueue","Operation failed with retryable error: "+t)}this.gc.length>0&&this.ur.Zi((()=>this.Vc()))}}vc(t){const e=this.mc.then((()=>(this.Ic=!0,t().catch((t=>{this.Ec=t,this.Ic=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw I("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Ic=!1,t))))));return this.mc=e,e}enqueueAfterDelay(t,e,n){this.Pc(),this.Rc.indexOf(t)>-1&&(e=0);const s=ho.createAndSchedule(this,t,e,n,(t=>this.Sc(t)));return this.Tc.push(s),s}Pc(){this.Ec&&S()}verifyOperationInProgress(){}async Dc(){let t;do{t=this.mc,await t}while(t!==this.mc)}Cc(t){for(const e of this.Tc)if(e.timerId===t)return!0;return!1}Nc(t){return this.Dc().then((()=>{this.Tc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.Tc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Dc()}))}kc(t){this.Rc.push(t)}Sc(t){const e=this.Tc.indexOf(t);this.Tc.splice(e,1)}}function Ja(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Za{constructor(){this._progressObserver={},this._taskCompletionResolver=new N,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const tc=-1;class ec extends Ua{constructor(t,e,n){super(t,e,n),this.type="firestore",this._queue=new Xa,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||rc(this),this._firestoreClient.terminate()}}function nc(t){return t._firestoreClient||rc(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function rc(t){var e;const n=t._freezeSettings(),s=function(t,e,n,s){return new Na(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new ya(t._authCredentials,t._appCheckCredentials,t._queue,s)}function sc(t,e){fc(t=Va(t,ec));const n=nc(t),s=t._freezeSettings(),i=new la;return oc(n,i,new ua(i,s.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function ic(t){fc(t=Va(t,ec));const e=nc(t),n=t._freezeSettings(),s=new la;return oc(e,s,new ha(s,n.cacheSizeBytes))}function oc(t,e,n){const s=new N;return t.asyncQueue.enqueue((async()=>{try{await wa(t,n),await va(t,e),s.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===k.FAILED_PRECONDITION||t.code===k.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),s.reject(t)}})).then((()=>s.promise))}function ac(t){if(t._initialized&&!t._terminated)throw new C(k.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new N;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!Nr.Pt())return Promise.resolve();const e=t+"main";await Nr.delete(e)}(qs(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function cc(t){return function(t){const e=new N;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=D(t);Gi(n.remoteStore)||T("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=D(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e.An.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const s=n.jo.get(t)||[];s.push(e),n.jo.set(t,s)}catch(t){const n=lo(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await Sa(t),e))),e.promise}(nc(t=Va(t,ec)))}function uc(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await Ia(t),n=await _a(t);return e.setNetworkEnabled(!0),function(t){const e=D(t);return e.Gr.delete(0),Fi(e)}(n)}))}(nc(t=Va(t,ec)))}function hc(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await Ia(t),n=await _a(t);return e.setNetworkEnabled(!1),async function(t){const e=D(t);e.Gr.add(0),await Vi(e),e.Jr.set("Offline")}(n)}))}(nc(t=Va(t,ec)))}function lc(t,e){const n=nc(t=Va(t,ec)),s=new Za;return Ca(n,t._databaseId,e,s),s}function dc(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=D(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.Ye.getNamedQuery(t,e)))}(await Ea(t),e)))}(nc(t=Va(t,ec)),e).then((e=>e?new $a(t,null,e.query):null))}function fc(t){if(t._initialized||t._terminated)throw new C(k.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class gc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new C(k.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new J(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class mc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new mc(et.fromBase64String(t))}catch(t){throw new C(k.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new mc(et.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class pc{constructor(t){this._methodName=t}}class yc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new C(k.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new C(k.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return rt(this._lat,t._lat)||rt(this._long,t._long)}}const wc=/^__.*__$/;class vc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Ue(t,this.data,this.fieldMask,e,this.fieldTransforms):new je(t,this.data,e,this.fieldTransforms)}}class bc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Ue(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Tc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}class Ic{constructor(t,e,n,s,i,r){this.settings=t,this.databaseId=e,this.k=n,this.ignoreUndefinedProperties=s,void 0===i&&this.xc(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get $c(){return this.settings.$c}Oc(t){return new Ic(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Oc({path:n,Fc:!1});return s.Lc(t),s}Bc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Oc({path:n,Fc:!1});return s.xc(),s}Uc(t){return this.Oc({path:void 0,Fc:!0})}qc(t){return Bc(t,this.settings.methodName,this.settings.Kc||!1,this.path,this.settings.jc)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}xc(){if(this.path)for(let t=0;t<this.path.length;t++)this.Lc(this.path.get(t))}Lc(t){if(0===t.length)throw this.qc("Document fields must not be empty");if(Tc(this.$c)&&wc.test(t))throw this.qc('Document fields cannot begin and end with "__"')}}class Ec{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.k=n||Ci(t)}Qc(t,e,n,s=!1){return new Ic({$c:t,methodName:e,jc:n,path:J.emptyPath(),Fc:!1,Kc:s},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function _c(t){const e=t._freezeSettings(),n=Ci(t._databaseId);return new Ec(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Sc(t,e,n,s,i,r={}){const o=t.Qc(r.merge||r.mergeFields?2:0,e,n,i);Vc("Data must be an object, but it was:",o,s);const c=Pc(s,o);let a,u;if(r.merge)a=new Z(o.fieldMask),u=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=qc(e,s,n);if(!o.contains(i))throw new C(k.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Kc(t,i)||t.push(i)}a=new Z(t),u=o.fieldTransforms.filter((t=>a.covers(t.field)))}else a=null,u=o.fieldTransforms;return new vc(new Ct(c),a,u)}class Ac extends pc{_toFieldTransform(t){if(2!==t.$c)throw 1===t.$c?t.qc(`${this._methodName}() can only appear at the top level of your update data`):t.qc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Ac}}function Dc(t,e,n){return new Ic({$c:3,jc:e.settings.jc,methodName:t._methodName,Fc:n},e.databaseId,e.k,e.ignoreUndefinedProperties)}class kc extends pc{_toFieldTransform(t){return new Ne(t.path,new Ie)}isEqual(t){return t instanceof kc}}class Cc extends pc{constructor(t,e){super(t),this.Wc=e}_toFieldTransform(t){const e=Dc(this,t,!0),n=this.Wc.map((t=>Mc(t,e))),s=new Ee(n);return new Ne(t.path,s)}isEqual(t){return this===t}}class Nc extends pc{constructor(t,e){super(t),this.Wc=e}_toFieldTransform(t){const e=Dc(this,t,!0),n=this.Wc.map((t=>Mc(t,e))),s=new Se(n);return new Ne(t.path,s)}isEqual(t){return this===t}}class xc extends pc{constructor(t,e){super(t),this.Gc=e}_toFieldTransform(t){const e=new De(t.k,ye(t.k,this.Gc));return new Ne(t.path,e)}isEqual(t){return this===t}}function Rc(t,e,n,s){const i=t.Qc(1,e,n);Vc("Data must be an object, but it was:",i,s);const r=[],o=Ct.empty();H(s,((t,s)=>{const c=Uc(e,t,n);s=Object(h.i)(s);const a=i.Bc(c);if(s instanceof Ac)r.push(c);else{const t=Mc(s,a);null!=t&&(r.push(c),o.set(c,t))}}));const c=new Z(r);return new bc(o,c,i.fieldTransforms)}function Oc(t,e,n,s,i,r){const o=t.Qc(1,e,n),c=[qc(e,s,n)],a=[i];if(r.length%2!=0)throw new C(k.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)c.push(qc(e,r[t])),a.push(r[t+1]);const u=[],l=Ct.empty();for(let t=c.length-1;t>=0;--t)if(!Kc(u,c[t])){const e=c[t];let n=a[t];n=Object(h.i)(n);const s=o.Bc(e);if(n instanceof Ac)u.push(e);else{const t=Mc(n,s);null!=t&&(u.push(e),l.set(e,t))}}const d=new Z(u);return new bc(l,d,o.fieldTransforms)}function Lc(t,e,n,s=!1){return Mc(n,t.Qc(s?4:3,e))}function Mc(t,e){if(Fc(t=Object(h.i)(t)))return Vc("Unsupported field value:",e,t),Pc(t,e);if(t instanceof pc)return function(t,e){if(!Tc(e.$c))throw e.qc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.qc(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.$c)throw e.qc("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=Mc(i,e.Uc(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(h.i)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ye(e.k,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=G.fromDate(t);return{timestampValue:An(e.k,n)}}if(t instanceof G){const n=new G(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:An(e.k,n)}}if(t instanceof yc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof mc)return{bytesValue:Dn(e.k,t._byteString)};if(t instanceof Ka){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e.qc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Nn(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.qc(`Unsupported field value: ${Fa(t)}`)}(t,e)}function Pc(t,e){const n={};return W(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):H(t,((t,s)=>{const i=Mc(s,e.Mc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Fc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof G||t instanceof yc||t instanceof mc||t instanceof Ka||t instanceof pc)}function Vc(t,e,n){if(!Fc(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=Fa(n);throw"an object"===s?e.qc(t+" a custom object"):e.qc(t+" "+s)}}function qc(t,e,n){if((e=Object(h.i)(e))instanceof gc)return e._internalPath;if("string"==typeof e)return Uc(t,e);throw Bc("Field path arguments must be of type string or ",t,!1,void 0,n)}const jc=new RegExp("[~\\*/\\[\\]]");function Uc(t,e,n){if(e.search(jc)>=0)throw Bc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new gc(...e.split("."))._internalPath}catch(r){throw Bc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Bc(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let c=`Function ${e}() called with invalid data`;n&&(c+=" (via `toFirestore()`)"),c+=". ";let a="";return(r||o)&&(a+=" (found",r&&(a+=` in field ${s}`),o&&(a+=` in document ${i}`),a+=")"),new C(k.INVALID_ARGUMENT,c+t+a)}function Kc(t,e){return t.some((t=>t.isEqual(e)))}class $c{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ka(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Gc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(zc("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Gc extends $c{data(){return super.data()}}function zc(t,e){return"string"==typeof e?Uc(t,e):e instanceof gc?e._internalPath:e._delegate._internalPath}class Qc{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Hc extends $c{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Wc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(zc("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Wc extends Hc{data(t={}){return super.data(t)}}class Yc{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Qc(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Wc(this._firestore,this._userDataWriter,n.key,n,new Qc(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new C(k.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new Wc(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Qc(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new Wc(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Qc(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:Xc(e.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Xc(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function Jc(t,e){return t instanceof Hc&&e instanceof Hc?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Yc&&e instanceof Yc&&t._firestore===e._firestore&&Ya(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Zc(t){if(ne(t)&&0===t.explicitOrderBy.length)throw new C(k.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class tu{}function eu(t,...e){for(const n of e)t=n._apply(t);return t}class nu extends tu{constructor(t,e,n){super(),this.zc=t,this.Hc=e,this.Jc=n,this.type="where"}_apply(t){const e=_c(t.firestore),n=function(t,e,n,s,i,r,o){let c;if(i.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new C(k.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){pu(o,r);const e=[];for(const n of o)e.push(mu(s,t,n));c={arrayValue:{values:e}}}else c=mu(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||pu(o,r),c=Lc(n,"where",o,"in"===r||"not-in"===r);const a=Ft.create(i,r,c);return function(t,e){if(e.V()){const n=se(t);if(null!==n&&!n.isEqual(e.field))throw new C(k.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=re(t);null!==s&&yu(t,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new C(k.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new C(k.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,a),a}(t._query,0,e,t.firestore._databaseId,this.zc,this.Hc,this.Jc);return new $a(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new Jt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}function ru(t,e,n){const s=e,i=zc("where",t);return new nu(i,s,n)}class su extends tu{constructor(t,e){super(),this.zc=t,this.Yc=e,this.type="orderBy"}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new C(k.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new C(k.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new Ht(e,n);return function(t,e){if(null===re(t)){const n=se(t);null!==n&&yu(t,n,e.field)}}(t,s),s}(t._query,this.zc,this.Yc);return new $a(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Jt(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function iu(t,e="asc"){const n=e,s=zc("orderBy",t);return new su(s,n)}class ou extends tu{constructor(t,e,n){super(),this.type=t,this.Xc=e,this.Zc=n}_apply(t){return new $a(t.firestore,t.converter,ce(t._query,this.Xc,this.Zc))}}function au(t){return qa("limit",t),new ou("limit",t,"F")}function cu(t){return qa("limitToLast",t),new ou("limitToLast",t,"L")}class uu extends tu{constructor(t,e,n){super(),this.type=t,this.ta=e,this.ea=n}_apply(t){const e=gu(t,this.type,this.ta,this.ea);return new $a(t.firestore,t.converter,function(t,e){return new Jt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function hu(...t){return new uu("startAt",t,!0)}function lu(...t){return new uu("startAfter",t,!1)}class du extends tu{constructor(t,e,n){super(),this.type=t,this.ta=e,this.ea=n}_apply(t){const e=gu(t,this.type,this.ta,this.ea);return new $a(t.firestore,t.converter,function(t,e){return new Jt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function th(...t){return new du("endBefore",t,!0)}function fu(...t){return new du("endAt",t,!1)}function gu(t,e,n,s){if(n[0]=Object(h.i)(n[0]),n[0]instanceof $c)return function(t,e,n,s,i){if(!s)throw new C(k.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const r=[];for(const n of oe(t))if(n.field.isKeyField())r.push(It(e,s.key));else{const t=s.data.field(n.field);if(at(t))throw new C(k.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new C(k.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new zt(r,i)}(t._query,t.firestore._databaseId,e,n[0]._document,s);{const i=_c(t.firestore);return function(t,e,n,s,i,r){const o=t.explicitOrderBy;if(i.length>o.length)throw new C(k.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const c=[];for(let r=0;r<i.length;r++){const a=i[r];if(o[r].field.isKeyField()){if("string"!=typeof a)throw new C(k.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof a}`);if(!ie(t)&&-1!==a.indexOf("/"))throw new C(k.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${a}' contains a slash.`);const n=t.path.child(Y.fromString(a));if(!gt.isDocumentKey(n))throw new C(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new gt(n);c.push(It(e,i))}else{const t=Lc(n,s,a);c.push(t)}}return new zt(c,r)}(t._query,t.firestore._databaseId,i,e,n,s)}}function mu(t,e,n){if("string"==typeof(n=Object(h.i)(n))){if(""===n)throw new C(k.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ie(e)&&-1!==n.indexOf("/"))throw new C(k.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Y.fromString(n));if(!gt.isDocumentKey(s))throw new C(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return It(t,new gt(s))}if(n instanceof Ka)return It(t,n._key);throw new C(k.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Fa(n)}.`)}function pu(t,e){if(!Array.isArray(t)||0===t.length)throw new C(k.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new C(k.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function yu(t,e,n){if(!n.isEqual(e))throw new C(k.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class wu{convertValue(t,e="none"){switch(mt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return it(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ot(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw S()}}convertObject(t,e){const n={};return H(t.fields,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new yc(it(t.latitude),it(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=ct(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ut(t));default:return null}}convertTimestamp(t){const e=st(t);return new G(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Y.fromString(t);A(nr(n));const s=new xa(n.get(1),n.get(3)),i=new gt(n.popFirst(5));return s.isEqual(e)||I(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}function vu(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}class bu extends wu{constructor(t){super(),this.firestore=t}convertBytes(t){return new mc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ka(this.firestore,null,e)}}class Tu{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=_c(t)}set(t,e,n){this._verifyNotCommitted();const s=Iu(t,this._firestore),i=vu(s.converter,e,n),r=Sc(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,n);return this._mutations.push(r.toMutation(s._key,Re.none())),this}update(t,e,n,...s){this._verifyNotCommitted();const i=Iu(t,this._firestore);let r;return r="string"==typeof(e=Object(h.i)(e))||e instanceof gc?Oc(this._dataReader,"WriteBatch.update",i._key,e,n,s):Rc(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(r.toMutation(i._key,Re.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=Iu(t,this._firestore);return this._mutations=this._mutations.concat(new Ge(e._key,Re.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(k.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Iu(t,e){if((t=Object(h.i)(t)).firestore!==e)throw new C(k.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Eu(t){t=Va(t,Ka);const e=Va(t.firestore,ec);return Da(nc(e),t._key).then((n=>Fu(e,t,n)))}class _u extends wu{constructor(t){super(),this.firestore=t}convertBytes(t){return new mc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ka(this.firestore,null,e)}}function Su(t){t=Va(t,Ka);const e=Va(t.firestore,ec),n=nc(e),s=new _u(e);return function(t,e){const n=new N;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await function(t,e){const n=D(t);return n.persistence.runTransaction("read document","readonly",(t=>n.Wn.Rn(t,e)))}(t,e);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new C(k.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=lo(t,`Failed to get document '${e} from cache`);n.reject(s)}}(await Ea(t),e,n))),n.promise}(n,t._key).then((n=>new Hc(e,s,t._key,n,new Qc(null!==n&&n.hasLocalMutations,!0),t.converter)))}function Au(t){t=Va(t,Ka);const e=Va(t.firestore,ec);return Da(nc(e),t._key,{source:"server"}).then((n=>Fu(e,t,n)))}function Du(t){t=Va(t,$a);const e=Va(t.firestore,ec),n=nc(e),s=new _u(e);return Zc(t._query),ka(n,t._query).then((n=>new Yc(e,s,t,n)))}function ku(t){t=Va(t,$a);const e=Va(t.firestore,ec),n=nc(e),s=new _u(e);return function(t,e){const n=new N;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await Xs(t,e,!0),i=new No(e,s.zn),r=i.Po(s.documents),o=i.applyChanges(r,!1);n.resolve(o.snapshot)}catch(t){const s=lo(t,`Failed to execute query '${e} against cache`);n.reject(s)}}(await Ea(t),e,n))),n.promise}(n,t._query).then((n=>new Yc(e,s,t,n)))}function Cu(t){t=Va(t,$a);const e=Va(t.firestore,ec),n=nc(e),s=new _u(e);return ka(n,t._query,{source:"server"}).then((n=>new Yc(e,s,t,n)))}function Nu(t,e,n){t=Va(t,Ka);const s=Va(t.firestore,ec),i=vu(t.converter,e,n);return Pu(s,[Sc(_c(s),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Re.none())])}function xu(t,e,n,...s){t=Va(t,Ka);const i=Va(t.firestore,ec),r=_c(i);let o;return o="string"==typeof(e=Object(h.i)(e))||e instanceof gc?Oc(r,"updateDoc",t._key,e,n,s):Rc(r,"updateDoc",t._key,e),Pu(i,[o.toMutation(t._key,Re.exists(!0))])}function Ru(t){return Pu(Va(t.firestore,ec),[new Ge(t._key,Re.none())])}function Ou(t,e){const n=Va(t.firestore,ec),s=Ha(t),i=vu(t.converter,e);return Pu(n,[Sc(_c(t.firestore),"addDoc",s._key,i,null!==t.converter,{}).toMutation(s._key,Re.exists(!1))]).then((()=>s))}function Lu(t,...e){var n,s,i;t=Object(h.i)(t);let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Ja(e[o])||(r=e[o],o++);const c={includeMetadataChanges:r.includeMetadataChanges};if(Ja(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let a,u,l;if(t instanceof Ka)u=Va(t.firestore,ec),l=te(t._key.path),a={next:n=>{e[o]&&e[o](Fu(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Va(t,$a);u=Va(n.firestore,ec),l=n._query;const s=new _u(u);a={next:t=>{e[o]&&e[o](new Yc(u,s,n,t))},error:e[o+1],complete:e[o+2]},Zc(t._query)}return function(t,e,n,s){const i=new fa(s),r=new Eo(e,i,n);return t.asyncQueue.enqueueAndForget((async()=>wo(await Aa(t),r))),()=>{i.nc(),t.asyncQueue.enqueueAndForget((async()=>vo(await Aa(t),r)))}}(nc(u),l,c,a)}function Mu(t,e){return function(t,e){const n=new fa(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){D(t).io.add(e),e.next()}(await Aa(t),n))),()=>{n.nc(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){D(t).io.delete(e)}(await Aa(t),n)))}}(nc(t=Va(t,ec)),Ja(e)?e:{next:e})}function Pu(t,e){return function(t,e){const n=new N;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const s=aa(t);try{const t=await function(t,e){const n=D(t),s=G.now(),i=e.reduce(((t,e)=>t.add(e.key)),ln());let r;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>n.Wn.vn(t,i).next((i=>{r=i;const o=[];for(const t of e){const e=Fe(t,r.get(t.key));null!=e&&o.push(new Ue(t.key,e,Nt(e.value.mapValue),Re.exists(!0)))}return n.An.addMutationBatch(t,s,o,e)})))).then((t=>(t.applyToLocalDocumentSet(r),{batchId:t.batchId,changes:r})))}(s.localStore,e);s.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let s=t.Ko[t.currentUser.toKey()];s||(s=new Je(rt)),s=s.insert(e,n),t.Ko[t.currentUser.toKey()]=s}(s,t.batchId,n),await Wo(s,t.changes),await Ji(s.remoteStore)}catch(t){const e=lo(t,"Failed to persist write");n.reject(e)}}(await Sa(t),e,n))),n.promise}(nc(t),e)}function Fu(t,e,n){const s=n.docs.get(e._key),i=new _u(t);return new Hc(t,i,e._key,s,new Qc(n.hasPendingWrites,n.fromCache),e.converter)}class Vu extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=_c(t)}get(t){const e=Iu(t,this._firestore),n=new bu(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return S();const s=t[0];if(s.isFoundDocument())return new $c(this._firestore,n,s.key,s,e.converter);if(s.isNoDocument())return new $c(this._firestore,n,e._key,null,e.converter);throw S()}))}set(t,e,n){const s=Iu(t,this._firestore),i=vu(s.converter,e,n),r=Sc(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,n);return this._transaction.set(s._key,r),this}update(t,e,n,...s){const i=Iu(t,this._firestore);let r;return r="string"==typeof(e=Object(h.i)(e))||e instanceof gc?Oc(this._dataReader,"Transaction.update",i._key,e,n,s):Rc(this._dataReader,"Transaction.update",i._key,e),this._transaction.update(i._key,r),this}delete(t){const e=Iu(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=Iu(t,this._firestore),n=new _u(this._firestore);return super.get(t).then((t=>new Hc(this._firestore,n,e._key,t._document,new Qc(!1,!1),e.converter)))}}function qu(t,e){return function(t,e){const n=new N;return t.asyncQueue.enqueueAndForget((async()=>{const s=await function(t){return Ta(t).then((t=>t.datastore))}(t);new pa(t.asyncQueue,s,e,n).run()})),n.promise}(nc(t=Va(t,ec)),(n=>e(new Vu(t,n))))}function ju(){return new Ac("deleteField")}function Uu(){return new kc("serverTimestamp")}function Bu(...t){return new Cc("arrayUnion",t)}function Ku(...t){return new Nc("arrayRemove",t)}function $u(t){return new xc("increment",t)}!function(t,e=!0){!function(t){m=t}(r.SDK_VERSION),Object(r._registerComponent)(new o.a("firestore",((t,{options:n})=>{const s=t.getProvider("app").getImmediate(),i=new ec(s,new L(t.getProvider("auth-internal")),new V(t.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:e},n),i._setSettings(n),i}),"PUBLIC")),Object(r.registerVersion)(d,"3.4.3",t),Object(r.registerVersion)(d,"3.4.3","esm2017")}()}).call(this,n(132))},277:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return mr})),n.d(e,"b",(function(){return yr})),n.d(e,"c",(function(){return pr})),n.d(e,"d",(function(){return vr})),n.d(e,"e",(function(){return wr})),n.d(e,"f",(function(){return Tr})),n.d(e,"g",(function(){return Ir})),n.d(e,"h",(function(){return fr})),n.d(e,"i",(function(){return gr}));var r,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},c={},h=h||{},l=o||self;function d(){}function f(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var m="closure_uid_"+(1e9*Math.random()>>>0),y=0;function w(a,b,t){return a.call.apply(a.bind,arguments)}function v(a,b,t){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,e),a.apply(b,t)}}return function(){return a.apply(b,arguments)}}function q(a,b,t){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:v).apply(null,arguments)}function T(a,b){var t=Array.prototype.slice.call(arguments,1);return function(){var e=t.slice();return e.push.apply(e,arguments),a.apply(this,e)}}function I(a,b){function t(){}t.prototype=b.prototype,a.Z=b.prototype,a.prototype=new t,a.prototype.constructor=a,a.Vb=function(t,e,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return b.prototype[e].apply(t,r)}}function E(){this.s=this.s,this.o=this.o}var _={};E.prototype.s=!1,E.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var a=function(a){return Object.prototype.hasOwnProperty.call(a,m)&&a[m]||(a[m]=++y)}(this);delete _[a]}},E.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const S=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(let t=0;t<a.length;t++)if(t in a&&a[t]===b)return t;return-1},A=Array.prototype.forEach?function(a,b,t){Array.prototype.forEach.call(a,b,t)}:function(a,b,t){const e=a.length,n="string"==typeof a?a.split(""):a;for(let r=0;r<e;r++)r in n&&b.call(t,n[r],r,a)};function D(a){return Array.prototype.concat.apply([],arguments)}function k(a){const b=a.length;if(0<b){const t=Array(b);for(let e=0;e<b;e++)t[e]=a[e];return t}return[]}function C(a){return/^[\s\xa0]*$/.test(a)}var N,x=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function R(a,b){return-1!=a.indexOf(b)}function O(a,b){return a<b?-1:a>b?1:0}t:{var L=l.navigator;if(L){var M=L.userAgent;if(M){N=M;break t}}N=""}function P(a,b,t){for(const e in a)b.call(t,a[e],e,a)}function F(a){const b={};for(const t in a)b[t]=a[t];return b}var V="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(a,b){let t,e;for(let n=1;n<arguments.length;n++){for(t in e=arguments[n],e)a[t]=e[t];for(let n=0;n<V.length;n++)t=V[n],Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}}function U(a){return U[" "](a),a}U[" "]=d;var B,a,K=R(N,"Opera"),$=R(N,"Trident")||R(N,"MSIE"),G=R(N,"Edge"),z=G||$,Q=R(N,"Gecko")&&!(R(N.toLowerCase(),"webkit")&&!R(N,"Edge"))&&!(R(N,"Trident")||R(N,"MSIE"))&&!R(N,"Edge"),H=R(N.toLowerCase(),"webkit")&&!R(N,"Edge");function W(){var a=l.document;return a?a.documentMode:void 0}t:{var Y="",X=(a=N,Q?/rv:([^\);]+)(\)|;)/.exec(a):G?/Edge\/([\d\.]+)/.exec(a):$?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):H?/WebKit\/(\S+)/.exec(a):K?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(X&&(Y=X?X[1]:""),$){var J=W();if(null!=J&&J>parseFloat(Y)){B=String(J);break t}}B=Y}var Z,tt={};function et(){return function(a){var b=tt;return Object.prototype.hasOwnProperty.call(b,9)?b[9]:b[9]=a(9)}((function(){let a=0;const b=x(String(B)).split("."),t=x("9").split("."),e=Math.max(b.length,t.length);for(let o=0;0==a&&o<e;o++){var n=b[o]||"",r=t[o]||"";do{if(n=/(\d*)(\D*)(.*)/.exec(n)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==n[0].length&&0==r[0].length)break;a=O(0==n[1].length?0:parseInt(n[1],10),0==r[1].length?0:parseInt(r[1],10))||O(0==n[2].length,0==r[2].length)||O(n[2],r[2]),n=n[3],r=r[3]}while(0==a)}return 0<=a}))}if(l.document&&$){var nt=W();Z=nt||(parseInt(B,10)||void 0)}else Z=void 0;var st=Z,it=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{l.addEventListener("test",d,b),l.removeEventListener("test",d,b)}catch(t){}return a}();function ot(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}function at(a,b){if(ot.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var t=this.type=a.type,e=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=b,b=a.relatedTarget){if(Q){t:{try{U(b.nodeName);var n=!0;break t}catch(t){}n=!1}n||(b=null)}}else"mouseover"==t?b=a.fromElement:"mouseout"==t&&(b=a.toElement);this.relatedTarget=b,e?(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:ct[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&at.Z.h.call(this)}}ot.prototype.h=function(){this.defaultPrevented=!0},I(at,ot);var ct={2:"touch",3:"pen",4:"mouse"};at.prototype.h=function(){at.Z.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var ut="closure_listenable_"+(1e6*Math.random()|0),ht=0;function lt(a,b,t,e,n){this.listener=a,this.proxy=null,this.src=b,this.type=t,this.capture=!!e,this.ia=n,this.key=++ht,this.ca=this.fa=!1}function ft(a){a.ca=!0,a.listener=null,a.proxy=null,a.src=null,a.ia=null}function gt(a){this.src=a,this.g={},this.h=0}function mt(a,b){var t=b.type;if(t in a.g){var e,n=a.g[t],r=S(n,b);(e=0<=r)&&Array.prototype.splice.call(n,r,1),e&&(ft(b),0==a.g[t].length&&(delete a.g[t],a.h--))}}function pt(a,b,t,e){for(var n=0;n<a.length;++n){var r=a[n];if(!r.ca&&r.listener==b&&r.capture==!!t&&r.ia==e)return n}return-1}gt.prototype.add=function(a,b,t,e,n){var r=a.toString();(a=this.g[r])||(a=this.g[r]=[],this.h++);var o=pt(a,b,e,n);return-1<o?(b=a[o],t||(b.fa=!1)):((b=new lt(b,this.src,r,!!e,n)).fa=t,a.push(b)),b};var yt="closure_lm_"+(1e6*Math.random()|0),wt={};function vt(a,b,t,e,n){if(e&&e.once)return Tt(a,b,t,e,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)vt(a,b[r],t,e,n);return null}return t=kt(t),a&&a[ut]?a.N(b,t,p(e)?!!e.capture:!!e,n):bt(a,b,t,!1,e,n)}function bt(a,b,t,e,n,r){if(!b)throw Error("Invalid event type");var o=p(n)?!!n.capture:!!n,c=At(a);if(c||(a[yt]=c=new gt(a)),(t=c.add(b,t,e,o,r)).proxy)return t;if(e=function(){function a(t){return b.call(a.src,a.listener,t)}var b=St;return a}(),t.proxy=e,e.src=a,e.listener=t,a.addEventListener)it||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),e,n);else if(a.attachEvent)a.attachEvent(_t(b.toString()),e);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(e)}return t}function Tt(a,b,t,e,n){if(Array.isArray(b)){for(var r=0;r<b.length;r++)Tt(a,b[r],t,e,n);return null}return t=kt(t),a&&a[ut]?a.O(b,t,p(e)?!!e.capture:!!e,n):bt(a,b,t,!0,e,n)}function It(a,b,t,e,n){if(Array.isArray(b))for(var r=0;r<b.length;r++)It(a,b[r],t,e,n);else e=p(e)?!!e.capture:!!e,t=kt(t),a&&a[ut]?(a=a.i,(b=String(b).toString())in a.g&&(-1<(t=pt(r=a.g[b],t,e,n))&&(ft(r[t]),Array.prototype.splice.call(r,t,1),0==r.length&&(delete a.g[b],a.h--)))):a&&(a=At(a))&&(b=a.g[b.toString()],a=-1,b&&(a=pt(b,t,e,n)),(t=-1<a?b[a]:null)&&Et(t))}function Et(a){if("number"!=typeof a&&a&&!a.ca){var b=a.src;if(b&&b[ut])mt(b.i,a);else{var t=a.type,e=a.proxy;b.removeEventListener?b.removeEventListener(t,e,a.capture):b.detachEvent?b.detachEvent(_t(t),e):b.addListener&&b.removeListener&&b.removeListener(e),(t=At(b))?(mt(t,a),0==t.h&&(t.src=null,b[yt]=null)):ft(a)}}}function _t(a){return a in wt?wt[a]:wt[a]="on"+a}function St(a,b){if(a.ca)a=!0;else{b=new at(b,this);var t=a.listener,e=a.ia||a.src;a.fa&&Et(a),a=t.call(e,b)}return a}function At(a){return(a=a[yt])instanceof gt?a:null}var Dt="__closure_events_fn_"+(1e9*Math.random()>>>0);function kt(a){return"function"==typeof a?a:(a[Dt]||(a[Dt]=function(b){return a.handleEvent(b)}),a[Dt])}function Ct(){E.call(this),this.i=new gt(this),this.P=this,this.I=null}function Nt(a,b){var t,e=a.I;if(e)for(t=[];e;e=e.I)t.push(e);if(a=a.P,e=b.type||b,"string"==typeof b)b=new ot(b,a);else if(b instanceof ot)b.target=b.target||a;else{var n=b;j(b=new ot(e,a),n)}if(n=!0,t)for(var r=t.length-1;0<=r;r--){var o=b.g=t[r];n=xt(o,e,!0,b)&&n}if(n=xt(o=b.g=a,e,!0,b)&&n,n=xt(o,e,!1,b)&&n,t)for(r=0;r<t.length;r++)n=xt(o=b.g=t[r],e,!1,b)&&n}function xt(a,b,t,e){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.ca&&o.capture==t){var c=o.listener,u=o.ia||o.src;o.fa&&mt(a.i,o),n=!1!==c.call(u,e)&&n}}return n&&!e.defaultPrevented}I(Ct,E),Ct.prototype[ut]=!0,Ct.prototype.removeEventListener=function(a,b,t,e){It(this,a,b,t,e)},Ct.prototype.M=function(){if(Ct.Z.M.call(this),this.i){var t,a=this.i;for(t in a.g){for(var e=a.g[t],n=0;n<e.length;n++)ft(e[n]);delete a.g[t],a.h--}}this.I=null},Ct.prototype.N=function(a,b,t,e){return this.i.add(String(a),b,!1,t,e)},Ct.prototype.O=function(a,b,t,e){return this.i.add(String(a),b,!0,t,e)};var Rt=l.JSON.stringify;function Ot(){var a=jt;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var Lt,Mt=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}((()=>new Pt),(a=>a.reset()));class Pt{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}function Ft(a){l.setTimeout((()=>{throw a}),0)}function Vt(a,b){Lt||function(){var a=l.Promise.resolve(void 0);Lt=function(){a.then(Ut)}}(),qt||(Lt(),qt=!0),jt.add(a,b)}var qt=!1,jt=new class{constructor(){this.h=this.g=null}add(a,b){const t=Mt.get();t.set(a,b),this.h?this.h.next=t:this.g=t,this.h=t}};function Ut(){for(var a;a=Ot();){try{a.h.call(a.g)}catch(t){Ft(t)}var b=Mt;b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}qt=!1}function Bt(a,b){Ct.call(this),this.h=a||1,this.g=b||l,this.j=q(this.kb,this),this.l=Date.now()}function Kt(a){a.da=!1,a.S&&(a.g.clearTimeout(a.S),a.S=null)}function $t(a,b,t){if("function"==typeof a)t&&(a=q(a,t));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=q(a.handleEvent,a)}return 2147483647<Number(b)?-1:l.setTimeout(a,b||0)}function Gt(a){a.g=$t((()=>{a.g=null,a.i&&(a.i=!1,Gt(a))}),a.j);const b=a.h;a.h=null,a.m.apply(null,b)}I(Bt,Ct),(r=Bt.prototype).da=!1,r.S=null,r.kb=function(){if(this.da){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-a):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Nt(this,"tick"),this.da&&(Kt(this),this.start()))}},r.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Bt.Z.M.call(this),Kt(this),delete this.g};class zt extends E{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:Gt(this)}M(){super.M(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qt(a){E.call(this),this.h=a,this.g={}}I(Qt,E);var Ht=[];function Wt(a,b,t,e){Array.isArray(t)||(t&&(Ht[0]=t.toString()),t=Ht);for(var n=0;n<t.length;n++){var r=vt(b,t[n],e||a.handleEvent,!1,a.h||a);if(!r)break;a.g[r.key]=r}}function Yt(a){P(a.g,(function(b,t){this.g.hasOwnProperty(t)&&Et(b)}),a),a.g={}}function Xt(){this.g=!0}function Jt(a,b,t,e){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.g)return b;if(!b)return null;try{var t=JSON.parse(b);if(t)for(a=0;a<t.length;a++)if(Array.isArray(t[a])){var e=t[a];if(!(2>e.length)){var n=e[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return Rt(t)}catch(t){return b}}(a,t)+(e?" "+e:"")}))}Qt.prototype.M=function(){Qt.Z.M.call(this),Yt(this)},Qt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Xt.prototype.Aa=function(){this.g=!1},Xt.prototype.info=function(){};var Zt={},te=null;function ee(){return te=te||new Ct}function ne(a){ot.call(this,Zt.Ma,a)}function re(a){const b=ee();Nt(b,new ne(b,a))}function se(a,b){ot.call(this,Zt.STAT_EVENT,a),this.stat=b}function ie(a){const b=ee();Nt(b,new se(b,a))}function oe(a,b){ot.call(this,Zt.Na,a),this.size=b}function ae(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){a()}),b)}Zt.Ma="serverreachability",I(ne,ot),Zt.STAT_EVENT="statevent",I(se,ot),Zt.Na="timingevent",I(oe,ot);var ce={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ue={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function he(){}function le(a){return a.h||(a.h=a.i())}function de(){}he.prototype.h=null;var fe,ge={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function me(){ot.call(this,"d")}function pe(){ot.call(this,"c")}function ye(){}function we(a,b,t,e){this.l=a,this.j=b,this.m=t,this.X=e||1,this.V=new Qt(this),this.P=be,a=z?125:void 0,this.W=new Bt(a),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ve}function ve(){this.i=null,this.g="",this.h=!1}I(me,ot),I(pe,ot),I(ye,he),ye.prototype.g=function(){return new XMLHttpRequest},ye.prototype.i=function(){return{}},fe=new ye;var be=45e3,Te={},Ie={};function Ee(a,b,t){a.K=1,a.v=ze(je(b)),a.s=t,a.U=!0,_e(a,null)}function _e(a,b){a.F=Date.now(),ke(a),a.A=je(a.v);var t=a.A,e=a.X;Array.isArray(e)||(e=[String(e)]),sn(t.h,"t",e),a.C=0,t=a.l.H,a.h=new ve,a.g=ir(a.l,t?b:null,!a.s),0<a.O&&(a.L=new zt(q(a.Ia,a,a.g),a.O)),Wt(a.V,a.g,"readystatechange",a.gb),b=a.H?F(a.H):{},a.s?(a.u||(a.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.s,b)):(a.u="GET",a.g.ea(a.A,a.u,null,b)),re(1),function(a,b,t,e,n,r){a.info((function(){if(a.g)if(r)for(var o="",c=r.split("&"),u=0;u<c.length;u++){var h=c[u].split("=");if(1<h.length){var l=h[0];h=h[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+h+"&":o+(l+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+e+") [attempt "+n+"]: "+b+"\n"+t+"\n"+o}))}(a.j,a.u,a.A,a.m,a.X,a.s)}function Se(a){return!!a.g&&("GET"==a.u&&2!=a.K&&a.l.Ba)}function Ae(a,b,t){let e,n=!0;for(;!a.I&&a.C<t.length;){if(e=De(a,t),e==Ie){4==b&&(a.o=4,ie(14),n=!1),Jt(a.j,a.m,null,"[Incomplete Response]");break}if(e==Te){a.o=4,ie(15),Jt(a.j,a.m,t,"[Invalid Chunk]"),n=!1;break}Jt(a.j,a.m,e,null),Oe(a,e)}Se(a)&&e!=Ie&&e!=Te&&(a.h.g="",a.C=0),4!=b||0!=t.length||a.h.h||(a.o=1,ie(16),n=!1),a.i=a.i&&n,n?0<t.length&&!a.aa&&(a.aa=!0,(b=a.l).g==a&&b.$&&!b.L&&(b.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),Yn(b),b.L=!0,ie(11))):(Jt(a.j,a.m,t,"[Invalid Chunked Response]"),Re(a),xe(a))}function De(a,b){var t=a.C,e=b.indexOf("\n",t);return-1==e?Ie:(t=Number(b.substring(t,e)),isNaN(t)?Te:(e+=1)+t>b.length?Ie:(b=b.substr(e,t),a.C=e+t,b))}function ke(a){a.Y=Date.now()+a.P,Ce(a,a.P)}function Ce(a,b){if(null!=a.B)throw Error("WatchDog timer not null");a.B=ae(q(a.eb,a),b)}function Ne(a){a.B&&(l.clearTimeout(a.B),a.B=null)}function xe(a){0==a.l.G||a.I||Zn(a.l,a)}function Re(a){Ne(a);var b=a.L;b&&"function"==typeof b.na&&b.na(),a.L=null,Kt(a.W),Yt(a.V),a.g&&(b=a.g,a.g=null,b.abort(),b.na())}function Oe(a,b){try{var t=a.l;if(0!=t.G&&(t.g==a||ln(t.i,a)))if(t.I=a.N,!a.J&&ln(t.i,a)&&3==t.G){try{var e=t.Ca.g.parse(b)}catch(t){e=null}if(Array.isArray(e)&&3==e.length){var n=e;if(0==n[0]){t:if(!t.u){if(t.g){if(!(t.g.F+3e3<a.F))break t;Jn(t),Un(t)}Wn(t),ie(18)}}else t.ta=n[1],0<t.ta-t.U&&37500>n[2]&&t.N&&0==t.A&&!t.v&&(t.v=ae(q(t.ab,t),6e3));if(1>=hn(t.i)&&t.ka){try{t.ka()}catch(t){}t.ka=void 0}}else nr(t,11)}else if((a.J||t.g==a)&&Jn(t),!C(b))for(n=t.Ca.g.parse(b),b=0;b<n.length;b++){let h=n[b];if(t.U=h[0],h=h[1],2==t.G)if("c"==h[0]){t.J=h[1],t.la=h[2];const n=h[3];null!=n&&(t.ma=n,t.h.info("VER="+t.ma));const l=h[4];null!=l&&(t.za=l,t.h.info("SVER="+t.za));const d=h[5];null!=d&&"number"==typeof d&&0<d&&(e=1.5*d,t.K=e,t.h.info("backChannelRequestTimeoutMs_="+e)),e=t;const f=a.g;if(f){const t=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=e.i;!r.g&&(R(t,"spdy")||R(t,"quic")||R(t,"h2"))&&(r.j=r.l,r.g=new Set,r.h&&(dn(r,r.h),r.h=null))}if(e.D){const t=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(e.sa=t,Ge(e.F,e.D,t))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-a.F,t.h.info("Handshake RTT: "+t.O+"ms"));var o=a;if((e=t).oa=sr(e,e.H?e.la:null,e.W),o.J){fn(e.i,o);var c=o,u=e.K;u&&c.setTimeout(u),c.B&&(Ne(c),ke(c)),e.g=o}else Hn(e);0<t.l.length&&$n(t)}else"stop"!=h[0]&&"close"!=h[0]||nr(t,7);else 3==t.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?nr(t,7):jn(t):"noop"!=h[0]&&t.j&&t.j.wa(h),t.A=0)}re(4)}catch(t){}}function Le(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(f(a)||"string"==typeof a)A(a,b,void 0);else{if(a.T&&"function"==typeof a.T)var t=a.T();else if(a.R&&"function"==typeof a.R)t=void 0;else if(f(a)||"string"==typeof a){t=[];for(var e=a.length,n=0;n<e;n++)t.push(n)}else for(n in t=[],e=0,a)t[e++]=n;e=function(a){if(a.R&&"function"==typeof a.R)return a.R();if("string"==typeof a)return a.split("");if(f(a)){for(var b=[],t=a.length,e=0;e<t;e++)b.push(a[e]);return b}for(e in b=[],t=0,a)b[t++]=a[e];return b}(a),n=e.length;for(var r=0;r<n;r++)b.call(void 0,e[r],t&&t[r],a)}}function Me(a,b){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var e=0;e<t;e+=2)this.set(arguments[e],arguments[e+1])}else if(a)if(a instanceof Me)for(t=a.T(),e=0;e<t.length;e++)this.set(t[e],a.get(t[e]));else for(e in a)this.set(e,a[e])}function Pe(a){if(a.i!=a.g.length){for(var b=0,t=0;b<a.g.length;){var e=a.g[b];Fe(a.h,e)&&(a.g[t++]=e),b++}a.g.length=t}if(a.i!=a.g.length){var n={};for(t=b=0;b<a.g.length;)Fe(n,e=a.g[b])||(a.g[t++]=e,n[e]=1),b++;a.g.length=t}}function Fe(a,b){return Object.prototype.hasOwnProperty.call(a,b)}(r=we.prototype).setTimeout=function(a){this.P=a},r.gb=function(a){a=a.target;const b=this.L;b&&3==Mn(a)?b.l():this.Ia(a)},r.Ia=function(a){try{if(a==this.g)t:{const d=Mn(this.g);var b=this.g.Da();const f=this.g.ba();if(!(3>d)&&(3!=d||z||this.g&&(this.h.h||this.g.ga()||Pn(this.g)))){this.I||4!=d||7==b||re(8==b||0>=f?3:2),Ne(this);var t=this.g.ba();this.N=t;e:if(Se(this)){var e=Pn(this.g);a="";var n=e.length,r=4==Mn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Re(this),xe(this);var o="";break e}this.h.i=new l.TextDecoder}for(b=0;b<n;b++)this.h.h=!0,a+=this.h.i.decode(e[b],{stream:r&&b==n-1});e.splice(0,n),this.h.g+=a,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==t,function(a,b,t,e,n,r,o){a.info((function(){return"XMLHTTP RESP ("+e+") [ attempt "+n+"]: "+b+"\n"+t+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.X,d,t),this.i){if(this.$&&!this.J){e:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(c)){var h=c;break e}}h=null}if(!(t=h)){this.i=!1,this.o=3,ie(12),Re(this),xe(this);break t}Jt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Oe(this,t)}this.U?(Ae(this,d,o),z&&this.i&&3==d&&(Wt(this.V,this.W,"tick",this.fb),this.W.start())):(Jt(this.j,this.m,o,null),Oe(this,o)),4==d&&Re(this),this.i&&!this.I&&(4==d?Zn(this.l,this):(this.i=!1,ke(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,ie(12)):(this.o=0,ie(13)),Re(this),xe(this)}}}catch(t){}},r.fb=function(){if(this.g){var a=Mn(this.g),b=this.g.ga();this.C<b.length&&(Ne(this),Ae(this,a,b),this.i&&4!=a&&ke(this))}},r.cancel=function(){this.I=!0,Re(this)},r.eb=function(){this.B=null;const a=Date.now();0<=a-this.Y?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.j,this.A),2!=this.K&&(re(3),ie(17)),Re(this),this.o=2,xe(this)):Ce(this,this.Y-a)},(r=Me.prototype).R=function(){Pe(this);for(var a=[],b=0;b<this.g.length;b++)a.push(this.h[this.g[b]]);return a},r.T=function(){return Pe(this),this.g.concat()},r.get=function(a,b){return Fe(this.h,a)?this.h[a]:b},r.set=function(a,b){Fe(this.h,a)||(this.i++,this.g.push(a)),this.h[a]=b},r.forEach=function(a,b){for(var t=this.T(),e=0;e<t.length;e++){var n=t[e],r=this.get(n);a.call(b,r,n,this)}};var Ve=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function qe(a,b){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,a instanceof qe){this.g=void 0!==b?b:a.g,Ue(this,a.j),this.s=a.s,Be(this,a.i),Ke(this,a.m),this.l=a.l,b=a.h;var t=new en;t.i=b.i,b.g&&(t.g=new Me(b.g),t.h=b.h),$e(this,t),this.o=a.o}else a&&(t=String(a).match(Ve))?(this.g=!!b,Ue(this,t[1]||"",!0),this.s=Qe(t[2]||""),Be(this,t[3]||"",!0),Ke(this,t[4]),this.l=Qe(t[5]||"",!0),$e(this,t[6]||"",!0),this.o=Qe(t[7]||"")):(this.g=!!b,this.h=new en(null,this.g))}function je(a){return new qe(a)}function Ue(a,b,t){a.j=t?Qe(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function Be(a,b,t){a.i=t?Qe(b,!0):b}function Ke(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function $e(a,b,t){b instanceof en?(a.h=b,function(a,b){b&&!a.j&&(nn(a),a.i=null,a.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(dd(this,e),sn(this,n,t))}),a)),a.j=b}(a.h,a.g)):(t||(b=He(b,Ze)),a.h=new en(b,a.g))}function Ge(a,b,t){a.h.set(b,t)}function ze(a){return Ge(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Qe(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function He(a,b,t){return"string"==typeof a?(a=encodeURI(a).replace(b,We),t&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function We(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}qe.prototype.toString=function(){var a=[],b=this.j;b&&a.push(He(b,Ye,!0),":");var t=this.i;return(t||"file"==b)&&(a.push("//"),(b=this.s)&&a.push(He(b,Ye,!0),"@"),a.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&a.push(":",String(t))),(t=this.l)&&(this.i&&"/"!=t.charAt(0)&&a.push("/"),a.push(He(t,"/"==t.charAt(0)?Je:Xe,!0))),(t=this.h.toString())&&a.push("?",t),(t=this.o)&&a.push("#",He(t,tn)),a.join("")};var Ye=/[#\/\?@]/g,Xe=/[#\?:]/g,Je=/[#\?]/g,Ze=/[#\?@]/g,tn=/#/g;function en(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function nn(a){a.g||(a.g=new Me,a.h=0,a.i&&function(a,b){if(a){a=a.split("&");for(var t=0;t<a.length;t++){var e=a[t].indexOf("="),n=null;if(0<=e){var r=a[t].substring(0,e);n=a[t].substring(e+1)}else r=a[t];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.i,(function(b,t){a.add(decodeURIComponent(b.replace(/\+/g," ")),t)})))}function dd(a,b){nn(a),b=on(a,b),Fe(a.g.h,b)&&(a.i=null,a.h-=a.g.get(b).length,Fe((a=a.g).h,b)&&(delete a.h[b],a.i--,a.g.length>2*a.i&&Pe(a)))}function rn(a,b){return nn(a),b=on(a,b),Fe(a.g.h,b)}function sn(a,b,t){dd(a,b),0<t.length&&(a.i=null,a.g.set(on(a,b),k(t)),a.h+=t.length)}function on(a,b){return b=String(b),a.j&&(b=b.toLowerCase()),b}(r=en.prototype).add=function(a,b){nn(this),this.i=null,a=on(this,a);var t=this.g.get(a);return t||this.g.set(a,t=[]),t.push(b),this.h+=1,this},r.forEach=function(a,b){nn(this),this.g.forEach((function(t,e){A(t,(function(t){a.call(b,t,e,this)}),this)}),this)},r.T=function(){nn(this);for(var a=this.g.R(),b=this.g.T(),t=[],e=0;e<b.length;e++)for(var n=a[e],r=0;r<n.length;r++)t.push(b[e]);return t},r.R=function(a){nn(this);var b=[];if("string"==typeof a)rn(this,a)&&(b=D(b,this.g.get(on(this,a))));else{a=this.g.R();for(var t=0;t<a.length;t++)b=D(b,a[t])}return b},r.set=function(a,b){return nn(this),this.i=null,rn(this,a=on(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},r.get=function(a,b){return a&&0<(a=this.R(a)).length?String(a[0]):b},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var a=[],b=this.g.T(),t=0;t<b.length;t++){var e=b[t],n=encodeURIComponent(String(e));e=this.R(e);for(var r=0;r<e.length;r++){var o=n;""!==e[r]&&(o+="="+encodeURIComponent(String(e[r]))),a.push(o)}}return this.i=a.join("&")};function an(a){this.l=a||cn,l.PerformanceNavigationTiming?a=0<(a=l.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(l.g&&l.g.Ea&&l.g.Ea()&&l.g.Ea().Zb),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var cn=10;function un(a){return!!a.h||!!a.g&&a.g.size>=a.j}function hn(a){return a.h?1:a.g?a.g.size:0}function ln(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function dn(a,b){a.g?a.g.add(b):a.h=b}function fn(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}function gn(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const t of a.g.values())b=b.concat(t.D);return b}return k(a.i)}function mn(){}function pn(){this.g=new mn}function yn(a,b,t){const e=t||"";try{Le(a,(function(t,n){let r=t;p(t)&&(r=Rt(t)),b.push(e+n+"="+encodeURIComponent(r))}))}catch(t){throw b.push(e+"type="+encodeURIComponent("_badmap")),t}}function wn(a,b,t,e,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(e)}catch(t){}}function vn(a){this.l=a.$b||null,this.j=a.ib||!1}function bn(a,b){Ct.call(this),this.D=a,this.u=b,this.m=void 0,this.readyState=Tn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}an.prototype.cancel=function(){if(this.i=gn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}},mn.prototype.stringify=function(a){return l.JSON.stringify(a,void 0)},mn.prototype.parse=function(a){return l.JSON.parse(a,void 0)},I(vn,he),vn.prototype.g=function(){return new bn(this.l,this.j)},vn.prototype.i=function(a){return function(){return a}}({}),I(bn,Ct);var Tn=0;function In(a){a.j.read().then(a.Sa.bind(a)).catch(a.ha.bind(a))}function td(a){a.readyState=4,a.l=null,a.j=null,a.A=null,En(a)}function En(a){a.onreadystatechange&&a.onreadystatechange.call(a)}(r=bn.prototype).open=function(a,b){if(this.readyState!=Tn)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,En(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.D||l).fetch(new Request(this.B,b)).then(this.Va.bind(this),this.ha.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,td(this)),this.readyState=Tn},r.Va=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,En(this)),this.g&&(this.readyState=3,En(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==l.ReadableStream&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;In(this)}else a.text().then(this.Ua.bind(this),this.ha.bind(this))},r.Sa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?td(this):En(this),3==this.readyState&&In(this)}},r.Ua=function(a){this.g&&(this.response=this.responseText=a,td(this))},r.Ta=function(a){this.g&&(this.response=a,td(this))},r.ha=function(){this.g&&td(this)},r.setRequestHeader=function(a,b){this.v.append(a,b)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var t=b.next();!t.done;)t=t.value,a.push(t[0]+": "+t[1]),t=b.next();return a.join("\r\n")},Object.defineProperty(bn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}});var _n=l.JSON.parse;function Sn(a){Ct.call(this),this.headers=new Me,this.u=a||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=An,this.K=this.L=!1}I(Sn,Ct);var An="",Dn=/^https?$/i,kn=["POST","PUT"];function Cn(a){return"content-type"==a.toLowerCase()}function Nn(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,xn(a),On(a)}function xn(a){a.D||(a.D=!0,Nt(a,"complete"),Nt(a,"error"))}function Rn(a){if(a.h&&void 0!==h&&(!a.C[1]||4!=Mn(a)||2!=a.ba()))if(a.v&&4==Mn(a))$t(a.Fa,0,a);else if(Nt(a,"readystatechange"),4==Mn(a)){a.h=!1;try{const c=a.ba();t:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break t;default:b=!1}var t;if(!(t=b)){var e;if(e=0===c){var n=String(a.H).match(Ve)[1]||null;if(!n&&l.self&&l.self.location){var r=l.self.location.protocol;n=r.substr(0,r.length-1)}e=!Dn.test(n?n.toLowerCase():"")}t=e}if(t)Nt(a,"complete"),Nt(a,"success");else{a.m=6;try{var o=2<Mn(a)?a.g.statusText:""}catch(t){o=""}a.j=o+" ["+a.ba()+"]",xn(a)}}finally{On(a)}}}function On(a,b){if(a.g){Ln(a);const t=a.g,e=a.C[0]?d:null;a.g=null,a.C=null,b||Nt(a,"ready");try{t.onreadystatechange=e}catch(t){}}}function Ln(a){a.g&&a.K&&(a.g.ontimeout=null),a.A&&(l.clearTimeout(a.A),a.A=null)}function Mn(a){return a.g?a.g.readyState:0}function Pn(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.J){case An:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Fn(a,b,t){t:{for(e in t){var e=!1;break t}e=!0}e||(t=function(a){let b="";return P(a,(function(t,e){b+=e,b+=":",b+=t,b+="\r\n"})),b}(t),"string"==typeof a?null!=t&&encodeURIComponent(String(t)):Ge(a,b,t))}function Vn(a,b,t){return t&&t.internalChannelParams&&t.internalChannelParams[a]||b}function qn(a){this.za=0,this.l=[],this.h=new Xt,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Vn("failFast",!1,a),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Vn("baseRetryDelayMs",5e3,a),this.$a=Vn("retryDelaySeedMs",1e4,a),this.Ya=Vn("forwardChannelMaxRetries",2,a),this.ra=Vn("forwardChannelRequestTimeoutMs",2e4,a),this.qa=a&&a.xmlHttpFactory||void 0,this.Ba=a&&a.Yb||!1,this.K=void 0,this.H=a&&a.supportsCrossDomainXhr||!1,this.J="",this.i=new an(a&&a.concurrentRequestLimit),this.Ca=new pn,this.ja=a&&a.fastHandshake||!1,this.Ra=a&&a.Wb||!1,a&&a.Aa&&this.h.Aa(),a&&a.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&a&&a.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!a||!1!==a.Xb}function jn(a){if(Bn(a),3==a.G){var b=a.V++,t=je(a.F);Ge(t,"SID",a.J),Ge(t,"RID",b),Ge(t,"TYPE","terminate"),zn(a,t),(b=new we(a,a.h,b,void 0)).K=2,b.v=ze(je(t)),t=!1,l.navigator&&l.navigator.sendBeacon&&(t=l.navigator.sendBeacon(b.v.toString(),"")),!t&&l.Image&&((new Image).src=b.v,t=!0),t||(b.g=ir(b.l,null),b.g.ea(b.v)),b.F=Date.now(),ke(b)}rr(a)}function Un(a){a.g&&(Yn(a),a.g.cancel(),a.g=null)}function Bn(a){Un(a),a.u&&(l.clearTimeout(a.u),a.u=null),Jn(a),a.i.cancel(),a.m&&("number"==typeof a.m&&l.clearTimeout(a.m),a.m=null)}function Kn(a,b){a.l.push(new class{constructor(a,b){this.h=a,this.g=b}}(a.Za++,b)),3==a.G&&$n(a)}function $n(a){un(a.i)||a.m||(a.m=!0,Vt(a.Ha,a),a.C=0)}function Gn(a,b){var t;t=b?b.m:a.V++;const e=je(a.F);Ge(e,"SID",a.J),Ge(e,"RID",t),Ge(e,"AID",a.U),zn(a,e),a.o&&a.s&&Fn(e,a.o,a.s),t=new we(a,a.h,t,a.C+1),null===a.o&&(t.H=a.s),b&&(a.l=b.D.concat(a.l)),b=Qn(a,t,1e3),t.setTimeout(Math.round(.5*a.ra)+Math.round(.5*a.ra*Math.random())),dn(a.i,t),Ee(t,e,b)}function zn(a,b){a.j&&Le({},(function(t,e){Ge(b,e,t)}))}function Qn(a,b,t){t=Math.min(a.l.length,t);var e=a.j?q(a.j.Oa,a.j,a):null;t:{var n=a.l;let r=-1;for(;;){const o=["count="+t];-1==r?0<t?(r=n[0].h,o.push("ofs="+r)):r=0:o.push("ofs="+r);let c=!0;for(let u=0;u<t;u++){let t=n[u].h;const h=n[u].g;if(t-=r,0>t)r=Math.max(0,n[u].h-100),c=!1;else try{yn(h,o,"req"+t+"_")}catch(t){e&&e(h)}}if(c){e=o.join("&");break t}}}return a=a.l.splice(0,t),b.D=a,e}function Hn(a){a.g||a.u||(a.Y=1,Vt(a.Ga,a),a.A=0)}function Wn(a){return!(a.g||a.u||3<=a.A)&&(a.Y++,a.u=ae(q(a.Ga,a),er(a,a.A)),a.A++,!0)}function Yn(a){null!=a.B&&(l.clearTimeout(a.B),a.B=null)}function Xn(a){a.g=new we(a,a.h,"rpc",a.Y),null===a.o&&(a.g.H=a.s),a.g.O=0;var b=je(a.oa);Ge(b,"RID","rpc"),Ge(b,"SID",a.J),Ge(b,"CI",a.N?"0":"1"),Ge(b,"AID",a.U),zn(a,b),Ge(b,"TYPE","xmlhttp"),a.o&&a.s&&Fn(b,a.o,a.s),a.K&&a.g.setTimeout(a.K);var t=a.g;a=a.la,t.K=1,t.v=ze(je(b)),t.s=null,t.U=!0,_e(t,a)}function Jn(a){null!=a.v&&(l.clearTimeout(a.v),a.v=null)}function Zn(a,b){var t=null;if(a.g==b){Jn(a),Yn(a),a.g=null;var e=2}else{if(!ln(a.i,b))return;t=b.D,fn(a.i,b),e=1}if(a.I=b.N,0!=a.G)if(b.i)if(1==e){t=b.s?b.s.length:0,b=Date.now()-b.F;var n=a.C;Nt(e=ee(),new oe(e,t,b,n)),$n(a)}else Hn(a);else if(3==(n=b.o)||0==n&&0<a.I||!(1==e&&function(a,b){return!(hn(a.i)>=a.i.j-(a.m?1:0)||(a.m?(a.l=b.D.concat(a.l),0):1==a.G||2==a.G||a.C>=(a.Xa?0:a.Ya)||(a.m=ae(q(a.Ha,a,b),er(a,a.C)),a.C++,0)))}(a,b)||2==e&&Wn(a)))switch(t&&0<t.length&&(b=a.i,b.i=b.i.concat(t)),n){case 1:nr(a,5);break;case 4:nr(a,10);break;case 3:nr(a,6);break;default:nr(a,2)}}function er(a,b){let t=a.Pa+Math.floor(Math.random()*a.$a);return a.j||(t*=2),t*b}function nr(a,b){if(a.h.info("Error code "+b),2==b){var t=null;a.j&&(t=null);var e=q(a.jb,a);t||(t=new qe("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Ue(t,"https"),ze(t)),function(a,b){const t=new Xt;if(l.Image){const e=new Image;e.onload=T(wn,t,e,"TestLoadImage: loaded",!0,b),e.onerror=T(wn,t,e,"TestLoadImage: error",!1,b),e.onabort=T(wn,t,e,"TestLoadImage: abort",!1,b),e.ontimeout=T(wn,t,e,"TestLoadImage: timeout",!1,b),l.setTimeout((function(){e.ontimeout&&e.ontimeout()}),1e4),e.src=a}else b(!1)}(t.toString(),e)}else ie(2);a.G=0,a.j&&a.j.va(b),rr(a),Bn(a)}function rr(a){a.G=0,a.I=-1,a.j&&(0==gn(a.i).length&&0==a.l.length||(a.i.i.length=0,k(a.l),a.l.length=0),a.j.ua())}function sr(a,b,t){let e=function(a){return a instanceof qe?je(a):new qe(a,void 0)}(t);if(""!=e.i)b&&Be(e,b+"."+e.i),Ke(e,e.m);else{const n=l.location;e=function(a,b,t,e){var n=new qe(null,void 0);return a&&Ue(n,a),b&&Be(n,b),t&&Ke(n,t),e&&(n.l=e),n}(n.protocol,b?b+"."+n.hostname:n.hostname,+n.port,t)}return a.aa&&P(a.aa,(function(t,n){Ge(e,n,t)})),b=a.D,t=a.sa,b&&t&&Ge(e,b,t),Ge(e,"VER",a.ma),zn(a,e),e}function ir(a,b,t){if(b&&!a.H)throw Error("Can't create secondary domain capable XhrIo object.");return(b=t&&a.Ba&&!a.qa?new Sn(new vn({ib:!0})):new Sn(a.qa)).L=a.H,b}function or(){}function ar(){if($&&!(10<=Number(st)))throw Error("Environmental error: no available transport.")}function cr(a,b){Ct.call(this),this.g=new qn(b),this.l=a,this.h=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.s=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.ya&&(a?a["X-WebChannel-Client-Profile"]=b.ya:a={"X-WebChannel-Client-Profile":b.ya}),this.g.P=a,(a=b&&b.httpHeadersOverwriteParam)&&!C(a)&&(this.g.o=a),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!C(b)&&(this.g.D=b,null!==(a=this.h)&&b in a&&(b in(a=this.h)&&delete a[b])),this.j=new dr(this)}function ur(a){me.call(this);var b=a.__sm__;if(b){t:{for(const t in b){a=t;break t}a=void 0}(this.i=a)&&(a=this.i,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function lr(){pe.call(this),this.status=1}function dr(a){this.g=a}(r=Sn.prototype).ea=function(a,b,t,e){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+a);b=b?b.toUpperCase():"GET",this.H=a,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():fe.g(),this.C=this.u?le(this.u):le(fe),this.g.onreadystatechange=q(this.Fa,this);try{this.F=!0,this.g.open(b,String(a),!0),this.F=!1}catch(t){return void Nn(this,t)}a=t||"";const n=new Me(this.headers);e&&Le(e,(function(t,e){n.set(e,t)})),e=function(a){t:{var b=Cn;const t=a.length,e="string"==typeof a?a.split(""):a;for(let n=0;n<t;n++)if(n in e&&b.call(void 0,e[n],n,a)){b=n;break t}b=-1}return 0>b?null:"string"==typeof a?a.charAt(b):a[b]}(n.T()),t=l.FormData&&a instanceof l.FormData,!(0<=S(kn,b))||e||t||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Ln(this),0<this.B&&((this.K=function(a){return $&&et()&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.pa,this)):this.A=$t(this.pa,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(t){Nn(this,t)}},r.pa=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Nt(this,"timeout"),this.abort(8))},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,Nt(this,"complete"),Nt(this,"abort"),On(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),On(this,!0)),Sn.Z.M.call(this)},r.Fa=function(){this.s||(this.F||this.v||this.l?Rn(this):this.cb())},r.cb=function(){Rn(this)},r.ba=function(){try{return 2<Mn(this)?this.g.status:-1}catch(t){return-1}},r.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},r.Qa=function(a){if(this.g){var b=this.g.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),_n(b)}},r.Da=function(){return this.m},r.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=qn.prototype).ma=8,r.G=1,r.hb=function(a){try{this.h.info("Origin Trials invoked: "+a)}catch(t){}},r.Ha=function(a){if(this.m)if(this.m=null,1==this.G){if(!a){this.V=Math.floor(1e5*Math.random()),a=this.V++;const n=new we(this,this.h,a,void 0);let r=this.s;if(this.P&&(r?(r=F(r),j(r,this.P)):r=this.P),null===this.o&&(n.H=r),this.ja)t:{for(var b=0,t=0;t<this.l.length;t++){var e=this.l[t];if(void 0===(e="__data__"in e.g&&"string"==typeof(e=e.g.__data__)?e.length:void 0))break;if(4096<(b+=e)){b=t;break t}if(4096===b||t===this.l.length-1){b=t+1;break t}}b=1e3}else b=1e3;b=Qn(this,n,b),Ge(t=je(this.F),"RID",a),Ge(t,"CVER",22),this.D&&Ge(t,"X-HTTP-Session-Id",this.D),zn(this,t),this.o&&r&&Fn(t,this.o,r),dn(this.i,n),this.Ra&&Ge(t,"TYPE","init"),this.ja?(Ge(t,"$req",b),Ge(t,"SID","null"),n.$=!0,Ee(n,t,null)):Ee(n,t,b),this.G=2}}else 3==this.G&&(a?Gn(this,a):0==this.l.length||un(this.i)||Gn(this))},r.Ga=function(){if(this.u=null,Xn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var a=2*this.O;this.h.info("BP detection timer enabled: "+a),this.B=ae(q(this.bb,this),a)}},r.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ie(10),Un(this),Xn(this))},r.ab=function(){null!=this.v&&(this.v=null,Un(this),Wn(this),ie(19))},r.jb=function(a){a?(this.h.info("Successfully pinged google.com"),ie(2)):(this.h.info("Failed to ping google.com"),ie(1))},(r=or.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Oa=function(){},ar.prototype.g=function(a,b){return new cr(a,b)},I(cr,Ct),cr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var a=this.g,b=this.l,t=this.h||void 0;a.Wa&&(a.h.info("Origin Trials enabled."),Vt(q(a.hb,a,b))),ie(0),a.W=b,a.aa=t||{},a.N=a.X,a.F=sr(a,null,a.W),$n(a)},cr.prototype.close=function(){jn(this.g)},cr.prototype.u=function(a){if("string"==typeof a){var b={};b.__data__=a,Kn(this.g,b)}else this.v?((b={}).__data__=Rt(a),Kn(this.g,b)):Kn(this.g,a)},cr.prototype.M=function(){this.g.j=null,delete this.j,jn(this.g),delete this.g,cr.Z.M.call(this)},I(ur,me),I(lr,pe),I(dr,or),dr.prototype.xa=function(){Nt(this.g,"a")},dr.prototype.wa=function(a){Nt(this.g,new ur(a))},dr.prototype.va=function(a){Nt(this.g,new lr(a))},dr.prototype.ua=function(){Nt(this.g,"b")},ar.prototype.createWebChannel=ar.prototype.g,cr.prototype.send=cr.prototype.u,cr.prototype.open=cr.prototype.m,cr.prototype.close=cr.prototype.close,ce.NO_ERROR=0,ce.TIMEOUT=8,ce.HTTP_ERROR=6,ue.COMPLETE="complete",de.EventType=ge,ge.OPEN="a",ge.CLOSE="b",ge.ERROR="c",ge.MESSAGE="d",Ct.prototype.listen=Ct.prototype.N,Sn.prototype.listenOnce=Sn.prototype.O,Sn.prototype.getLastError=Sn.prototype.La,Sn.prototype.getLastErrorCode=Sn.prototype.Da,Sn.prototype.getStatus=Sn.prototype.ba,Sn.prototype.getResponseJson=Sn.prototype.Qa,Sn.prototype.getResponseText=Sn.prototype.ga,Sn.prototype.send=Sn.prototype.ea;var fr=c.createWebChannelTransport=function(){return new ar},gr=c.getStatEventTarget=function(){return ee()},mr=c.ErrorCode=ce,pr=c.EventType=ue,yr=c.Event=Zt,wr=c.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},vr=c.FetchXmlHttpFactory=vn,Tr=c.WebChannel=de,Ir=c.XhrIo=Sn}).call(this,n(41))},285:function(t,e,n){"use strict";n.r(e);var r=n(268),o=n(276),c=n(267),h=n(269);function l(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new o.g("invalid-argument",`Invalid options passed to function ${t}(): You cannot specify both "merge" and "mergeFields".`);return e}function d(){if("undefined"==typeof Uint8Array)throw new o.g("unimplemented","Uint8Arrays are not available in this environment.")}function f(){if(!Object(o.r)())throw new o.g("unimplemented","Blobs are unavailable in Firestore in this environment.")}class m{constructor(t){this._delegate=t}static fromBase64String(t){return f(),new m(o.b.fromBase64String(t))}static fromUint8Array(t){return d(),new m(o.b.fromUint8Array(t))}toBase64(){return f(),this._delegate.toBase64()}toUint8Array(){return d(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function y(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const object=t;for(const t of e)if(t in object&&"function"==typeof object[t])return!0;return!1}(t,["next","error","complete"])}class w{enableIndexedDbPersistence(t,e){return Object(o.F)(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return Object(o.G)(t._delegate)}clearIndexedDbPersistence(t){return Object(o.x)(t._delegate)}}class v{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof o.m||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){const e=this._delegate._getSettings();t.merge||e.host===t.host||Object(o.s)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)}useEmulator(t,e,n={}){Object(o.A)(this._delegate,t,e,n)}enableNetwork(){return Object(o.H)(this._delegate)}disableNetwork(){return Object(o.D)(this._delegate)}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,Object(o.t)("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Object(o.lb)(this._delegate)}onSnapshotsInSync(t){return Object(o.Y)(this._delegate,t)}get app(){if(!this._appCompat)throw new o.g("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new L(this,Object(o.y)(this._delegate,t))}catch(t){throw A(t,"collection()","Firestore.collection()")}}doc(t){try{return new S(this,Object(o.E)(this._delegate,t))}catch(t){throw A(t,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new x(this,Object(o.z)(this._delegate,t))}catch(t){throw A(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Object(o.db)(this._delegate,(e=>t(new I(this,e))))}batch(){return Object(o.K)(this._delegate),new E(new o.l(this._delegate,(t=>Object(o.L)(this._delegate,t))))}loadBundle(t){return Object(o.V)(this._delegate,t)}namedQuery(t){return Object(o.W)(this._delegate,t).then((t=>t?new x(this,t):null))}}class T extends o.a{constructor(t){super(),this.firestore=t}convertBytes(t){return new m(new o.b(t))}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return S.forKey(e,this.firestore,null)}}class I{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new T(t)}get(t){const e=M(t);return this._delegate.get(e).then((t=>new C(this._firestore,new o.e(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,e.converter))))}set(t,data,e){const n=M(t);return e?(l("Transaction.set",e),this._delegate.set(n,data,e)):this._delegate.set(n,data),this}update(t,e,n,...r){const o=M(t);return 2===arguments.length?this._delegate.update(o,e):this._delegate.update(o,e,n,...r),this}delete(t){const e=M(t);return this._delegate.delete(e),this}}class E{constructor(t){this._delegate=t}set(t,data,e){const n=M(t);return e?(l("WriteBatch.set",e),this._delegate.set(n,data,e)):this._delegate.set(n,data),this}update(t,e,n,...r){const o=M(t);return 2===arguments.length?this._delegate.update(o,e):this._delegate.update(o,e,n,...r),this}delete(t){const e=M(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class _{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){const n=new o.i(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new N(this._firestore,n),null!=e?e:{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){const n=_.INSTANCES;let r=n.get(t);r||(r=new WeakMap,n.set(t,r));let o=r.get(e);return o||(o=new _(t,new T(t),e),r.set(e,o)),o}}_.INSTANCES=new WeakMap;class S{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new T(t)}static forPath(path,t,e){if(path.length%2!=0)throw new o.g("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${path.canonicalString()} has ${path.length}`);return new S(t,new o.d(t._delegate,e,new o.n(path)))}static forKey(t,e,n){return new S(e,new o.d(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new L(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new L(this.firestore,Object(o.y)(this._delegate,t))}catch(t){throw A(t,"collection()","DocumentReference.collection()")}}isEqual(t){return(t=Object(c.i)(t))instanceof o.d&&Object(o.cb)(this._delegate,t)}set(t,e){e=l("DocumentReference.set",e);try{return e?Object(o.fb)(this._delegate,t,e):Object(o.fb)(this._delegate,t)}catch(t){throw A(t,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return 1===arguments.length?Object(o.kb)(this._delegate,t):Object(o.kb)(this._delegate,t,e,...n)}catch(t){throw A(t,"updateDoc()","DocumentReference.update()")}}delete(){return Object(o.B)(this._delegate)}onSnapshot(...t){const e=D(t),n=k(t,(t=>new C(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))));return Object(o.X)(this._delegate,e,n)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Object(o.N)(this._delegate):"server"===(null==t?void 0:t.source)?Object(o.O)(this._delegate):Object(o.M)(this._delegate),e.then((t=>new C(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))))}withConverter(t){return new S(this.firestore,t?this._delegate.withConverter(_.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function A(t,e,n){return t.message=t.message.replace(e,n),t}function D(t){for(const e of t)if("object"==typeof e&&!y(e))return e;return{}}function k(t,e){var n,r;let o;return o=y(t[0])?t[0]:y(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]},{next:t=>{o.next&&o.next(e(t))},error:null===(n=o.error)||void 0===n?void 0:n.bind(o),complete:null===(r=o.complete)||void 0===r?void 0:r.bind(o)}}class C{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new S(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return Object(o.hb)(this._delegate,t._delegate)}}class N extends C{data(t){const data=this._delegate.data(t);return Object(o.q)(void 0!==data,"Document in a QueryDocumentSnapshot should exist"),data}}class x{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new T(t)}where(t,e,n){try{return new x(this.firestore,Object(o.ab)(this._delegate,Object(o.mb)(t,e,n)))}catch(t){throw A(t,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new x(this.firestore,Object(o.ab)(this._delegate,Object(o.Z)(t,e)))}catch(t){throw A(t,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new x(this.firestore,Object(o.ab)(this._delegate,Object(o.T)(t)))}catch(t){throw A(t,"limit()","Query.limit()")}}limitToLast(t){try{return new x(this.firestore,Object(o.ab)(this._delegate,Object(o.U)(t)))}catch(t){throw A(t,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new x(this.firestore,Object(o.ab)(this._delegate,Object(o.jb)(...t)))}catch(t){throw A(t,"startAt()","Query.startAt()")}}startAfter(...t){try{return new x(this.firestore,Object(o.ab)(this._delegate,Object(o.ib)(...t)))}catch(t){throw A(t,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new x(this.firestore,Object(o.ab)(this._delegate,Object(o.J)(...t)))}catch(t){throw A(t,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new x(this.firestore,Object(o.ab)(this._delegate,Object(o.I)(...t)))}catch(t){throw A(t,"endAt()","Query.endAt()")}}isEqual(t){return Object(o.bb)(this._delegate,t._delegate)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Object(o.Q)(this._delegate):"server"===(null==t?void 0:t.source)?Object(o.R)(this._delegate):Object(o.P)(this._delegate),e.then((t=>new O(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))))}onSnapshot(...t){const e=D(t),n=k(t,(t=>new O(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))));return Object(o.X)(this._delegate,e,n)}withConverter(t){return new x(this.firestore,t?this._delegate.withConverter(_.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}class R{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new N(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class O{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new x(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((t=>new N(this._firestore,t)))}docChanges(t){return this._delegate.docChanges(t).map((t=>new R(this._firestore,t)))}forEach(t,e){this._delegate.forEach((n=>{t.call(e,new N(this._firestore,n))}))}isEqual(t){return Object(o.hb)(this._delegate,t._delegate)}}class L extends x{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const t=this._delegate.parent;return t?new S(this.firestore,t):null}doc(t){try{return new S(this.firestore,void 0===t?Object(o.E)(this._delegate):Object(o.E)(this._delegate,t))}catch(t){throw A(t,"doc()","CollectionReference.doc()")}}add(data){return Object(o.u)(this._delegate,data).then((t=>new S(this.firestore,t)))}isEqual(t){return Object(o.cb)(this._delegate,t._delegate)}withConverter(t){return new L(this.firestore,t?this._delegate.withConverter(_.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function M(t){return Object(o.p)(t,o.d)}class P{constructor(...t){this._delegate=new o.f(...t)}static documentId(){return new P(o.o.keyField().canonicalString())}isEqual(t){return(t=Object(c.i)(t))instanceof o.f&&this._delegate._internalPath.isEqual(t._internalPath)}}class F{constructor(t){this._delegate=t}static serverTimestamp(){const t=Object(o.eb)();return t._methodName="FieldValue.serverTimestamp",new F(t)}static delete(){const t=Object(o.C)();return t._methodName="FieldValue.delete",new F(t)}static arrayUnion(...t){const e=Object(o.w)(...t);return e._methodName="FieldValue.arrayUnion",new F(e)}static arrayRemove(...t){const e=Object(o.v)(...t);return e._methodName="FieldValue.arrayRemove",new F(e)}static increment(t){const e=Object(o.S)(t);return e._methodName="FieldValue.increment",new F(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}}const V={Firestore:v,GeoPoint:o.h,Timestamp:o.k,Blob:m,Transaction:I,WriteBatch:E,DocumentReference:S,DocumentSnapshot:C,Query:x,QueryDocumentSnapshot:N,QuerySnapshot:O,CollectionReference:L,FieldPath:P,FieldValue:F,setLogLevel:function(t){Object(o.gb)(t)},CACHE_SIZE_UNLIMITED:o.c};var j,U;j=r.a,U=(t,e)=>new v(t,e,new w),j.INTERNAL.registerComponent(new h.a("firestore-compat",(t=>{const e=t.getProvider("app-compat").getImmediate(),n=t.getProvider("firestore").getImmediate();return U(e,n)}),"PUBLIC").setServiceProps(Object.assign({},V))),j.registerVersion("@firebase/firestore-compat","0.1.12")}}]);